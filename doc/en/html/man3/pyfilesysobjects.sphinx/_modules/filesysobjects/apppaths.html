<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>filesysobjects.apppaths &mdash; filesysobjects 0.1.34 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.34',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="filesysobjects 0.1.34 documentation" href="../../index.html" />
    <link rel="up" title="filesysobjects" href="../filesysobjects.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">filesysobjects 0.1.34 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../filesysobjects.html" accesskey="U">filesysobjects</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for filesysobjects.apppaths</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;The &#39;filesysobjects.apppaths&#39; module provides operations on static application resource paths.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">from</span> <span class="nn">pysourceinfo.fileinfo</span> <span class="k">import</span> <span class="n">getcaller_pathname</span><span class="p">,</span> <span class="n">getcaller_filepathname</span>
<span class="kn">from</span> <span class="nn">pysourceinfo.helper</span> <span class="k">import</span> <span class="n">getpythonpath_rel</span>

<span class="kn">from</span> <span class="nn">filesysobjects</span> <span class="k">import</span> <span class="n">FileSysObjectsError</span><span class="p">,</span> <span class="n">AppPathError</span><span class="p">,</span> <span class="n">PathError</span><span class="p">,</span> <span class="n">ISSTR</span><span class="p">,</span> \
    <span class="n">RTE</span><span class="p">,</span> <span class="n">RTE_POSIX</span><span class="p">,</span> <span class="n">RTE_WIN32</span><span class="p">,</span> <span class="n">RTE_GENERIC</span><span class="p">,</span> \
    <span class="n">RTE_SMB</span><span class="p">,</span> <span class="n">RTE_CNW</span><span class="p">,</span> <span class="n">RTE_CNP</span><span class="p">,</span> <span class="n">RTE_LOCAL</span><span class="p">,</span> \
    <span class="n">RTE_URI</span><span class="p">,</span> <span class="n">RTE_HTTP</span><span class="p">,</span> <span class="n">RTE_HTTPS</span><span class="p">,</span> <span class="n">RTE_FILEURI</span><span class="p">,</span> <span class="n">RTE_FILEURI0</span><span class="p">,</span> <span class="n">RTE_FILEURI4</span><span class="p">,</span> <span class="n">RTE_FILEURI5</span><span class="p">,</span> \
    <span class="n">num2rte</span>
<span class="kn">from</span> <span class="nn">filesysobjects.paths</span> <span class="k">import</span> <span class="n">normpathx</span><span class="p">,</span> <span class="n">escapepathx</span><span class="p">,</span> <span class="n">unescapepathx</span><span class="p">,</span> <span class="n">gettpf</span><span class="p">,</span> <span class="n">getspf</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Arno-Can Uestuensoez&#39;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;Artistic-License-2.0 + Forced-Fairplay-Constraints&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) 2010-2016 Arno-Can Uestuensoez&quot;</span> \
                <span class="s2">&quot;@Ingenieurbuero Arno-Can Uestuensoez&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.1.20&#39;</span>
<span class="n">__uuid__</span> <span class="o">=</span> <span class="s2">&quot;4135ab0f-fbb8-45a2-a6b1-80d96c164b72&quot;</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s2">&quot;restructuredtext en&quot;</span>

<span class="c1">#</span>
<span class="c1"># for test and development</span>
<span class="n">_mydebug</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1">#*</span>
<span class="c1"># *** static compiled strings ***</span>
<span class="c1">#*</span>

<span class="c1"># pathname seperator</span>
<span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
    <span class="n">OSSEP</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>  <span class="c1">#: os separator</span>
    <span class="n">OSSEPCLS</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="se">\\\\</span><span class="s1">]&#39;</span>  <span class="c1">#: character class os separator</span>
    <span class="n">OSSEPCLSN</span> <span class="o">=</span> <span class="s1">&#39;[^</span><span class="se">\\\\</span><span class="s1">]&#39;</span>  <span class="c1">#: character class without separator</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">OSSEP</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>  <span class="c1">#: os separator</span>
    <span class="n">OSSEPCLS</span> <span class="o">=</span> <span class="s1">&#39;[/]&#39;</span>  <span class="c1">#: character class os separator</span>
    <span class="n">OSSEPCLSN</span> <span class="o">=</span> <span class="s1">&#39;[^/]&#39;</span>  <span class="c1">#: character class without separator</span>

<span class="c1">#</span>
<span class="c1"># prohibited characters for optional validation - see strict options</span>
<span class="c1">#</span>

<span class="c1">#: windows: ::</span>
<span class="c1">#:</span>
<span class="c1">#:    r&#39;[:&lt;&gt;*?]&#39;</span>
<span class="n">INVALIDCHARSWIN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;[:&lt;&gt;*?]&#39;</span><span class="p">)</span>

<span class="c1">#: posix: ::</span>
<span class="c1">#:</span>
<span class="c1">#:    r&#39;\0&#39;</span>
<span class="n">INVALIDCHARSPOSIX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;\0&#39;</span><span class="p">)</span>

<span class="c1">#: posix + windows: ::</span>
<span class="c1">#:</span>
<span class="c1">#:    r&#39;[:&lt;&gt;*?\0]&#39;</span>
<span class="n">INVALIDCHARS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;[:&lt;&gt;*?\0]&#39;</span><span class="p">)</span>  <span class="c1">#: super position of both: r&#39;[:&lt;&gt;*?\0]&#39;</span>

<span class="c1">#: maps unambiguous escape characters to escape sequences</span>
<span class="n">ESC_CHAR_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;</span><span class="se">\a</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">a&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\b</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\f</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">f&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">r&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">t&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\v</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">v&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">#: maps escape characters for escape sequences to unescape</span>
<span class="n">UNESC_CHAR_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\a</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\f</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\v</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># pylint: disable-msg=W0105</span>

<span class="c1">#: Dummy for same group count for processing.</span>
<span class="n">_DUMMY</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;(()|())&quot;&quot;&quot;</span>

<span class="c1">#: The tail of a path atom including possible escaped os.pathsep as ordinary character</span>
<span class="n">_NOSEP_COL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;(</span>
<span class="s2">    ([&quot;]</span><span class="si">{3}</span><span class="s2">.*?[&quot;]</span><span class="si">{3}</span><span class="s2">|[&#39;]</span><span class="si">{3}</span><span class="s2">.*?[&#39;]</span><span class="si">{3}</span><span class="s2">|[^:&quot;&#39;]+|[&#39;&quot;])+</span>
<span class="s2">   |([&quot;]</span><span class="si">{3}</span><span class="s2">.*?[&quot;]</span><span class="si">{3}</span><span class="s2">|[&#39;]</span><span class="si">{3}</span><span class="s2">.*?[&#39;]</span><span class="si">{3}</span><span class="s2">|[^:&quot;&#39;]+|[&#39;&quot;])+</span>
<span class="s2">   )&quot;&quot;&quot;</span>

<span class="c1">#: The tail of a path atom including possible escaped os.pathsep as ordinary character</span>
<span class="n">_NOSEP_SEM</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;(</span>
<span class="s2">    ([&quot;]</span><span class="si">{3}</span><span class="s2">.*?[&quot;]</span><span class="si">{3}</span><span class="s2">|[&#39;]</span><span class="si">{3}</span><span class="s2">.*?[&#39;]</span><span class="si">{3}</span><span class="s2">|[^;&quot;&#39;]+|[&#39;&quot;])+</span>
<span class="s2">   |([&quot;]</span><span class="si">{3}</span><span class="s2">.*?[&quot;]</span><span class="si">{3}</span><span class="s2">|[&#39;]</span><span class="si">{3}</span><span class="s2">.*?[&#39;]</span><span class="si">{3}</span><span class="s2">|[^;&quot;&#39;]+|[&#39;&quot;])+</span>
<span class="s2">   )&quot;&quot;&quot;</span>


<span class="c1"># [MS-DTYP] - 2.2.57 - UNC definitions</span>
<span class="c1"># pchar = %x20-21 / %x23-29 / %x2D-2E / %x30-39 / %x40-5A / %x5E-7B / %x7D-FF</span>
<span class="c1"># pchar = r&#39;[\x20-\x21\x23-\x29\x2D-\x2E\x30-\x39\x40-\x5A\x5E-\x7B\x7D-\xFF]&#39;</span>
<span class="c1"># pchar=&quot;&quot;&quot;[^\x00-\x1f\x22\x2a-\x2c\x2f\x3a-\x3f\x5b-\x5d\x7c]&quot;&quot;&quot;</span>


<span class="c1">#: Scanner/Parser for colon based search path separator: ::</span>
<span class="c1">#:</span>
<span class="c1">#:    os.pathsep == &#39;:&#39;</span>
<span class="c1">#:</span>
<span class="c1">#: The applied rules are: ::</span>
<span class="c1">#:</span>
<span class="c1">#:     4: (&#39;file://[/]&#39; +2SEP | unc://)  +(host)  +1SEP  +(share)  +(object)  # [MS-DTYP] 2.2.57</span>
<span class="c1">#:    12: (&#39;file://&#39;)                    +()      +()    +(drive)  +(path)    # RFC8089 -</span>
<span class="c1">#:    20: (&#39;file://&#39;)                    +(auth)  +()    +()       +(path)    # RFC8089 - non-local files</span>
<span class="c1">#:    28: (&#39;file://|file:&#39;)              +()      +()    +()       +(path)    # RFC8089 - traditional</span>
<span class="c1">#:    36: (&#39;smb://&#39;|&#39;cifs://&#39;)  +(host)  +1SEP  +(share)  +(path)             # RFC-SMB</span>
<span class="c1">#:    44: (2SEP)                +(host)  +1SEP  +(share)  +(path)             # [MS-DTYP] 2.2.57 - a share present</span>
<span class="c1">#:    52: (scheme &#39;://&#39;)           +(auth)  +1SEP  +(path)   +&quot;?&quot; +(query-fragment)  # RFC3869</span>
<span class="c1">#:    60: ()                    +()      +()    +(drive)  +(path)             # MS-DOS / WIN</span>
<span class="c1">#:    68: ()                    +()      +()    +(drive)  +(path)             # MS-DOS / WIN</span>
<span class="c1">#:    76: ()                    +()      +()    +(drive)  +()                 # MS-DOS / WIN</span>
<span class="c1">#:    84: ()                    +()      +()    +()       +(path)             # general filesystems</span>
<span class="c1">#:    92: ()                    +()       +()   +()       +()</span>
<span class="c1">#:    94 os.pathsep</span>
<span class="n">APPPATHSCANNER_COL</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<span class="sd">r&quot;&quot;&quot;((</span>
<span class="sd">     ((file://[/]{0,1}[/\\\\]{2}|unc://)(.{0,1}[^/\\\\]+)[/\\\\]([^/\\\\]+)[/\\\\]*([/\\\\]&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_COL</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;)) #  4</span>
<span class="s2">    |((file:///{0,1}|file:)()([a-zA-Z]:)[/</span><span class="se">\\\\</span><span class="s2">]*?([/</span><span class="se">\\\\</span><span class="s2">]{0,1}&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_COL</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                               # 12</span>
<span class="s2">    |((file://)([^/</span><span class="se">\\\\</span><span class="s2">]+)()(&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_COL</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                                                                # 20</span>
<span class="s2">    |((file://|file:)()()(&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_COL</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                                                                   # 28</span>
<span class="s2">    |((smb://|cifs://)([^/]{0,1}[^/</span><span class="se">\\\\</span><span class="s2">]*)[/</span><span class="se">\\\\</span><span class="s2">]+([^/</span><span class="se">\\\\</span><span class="s2">]+)[/</span><span class="se">\\\\</span><span class="s2">]*([/</span><span class="se">\\\\</span><span class="s2">]&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_COL</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                # 36</span>
<span class="s2">    |(([</span><span class="se">\\\\</span><span class="s2">]</span><span class="si">{2}</span><span class="s2">|[/]</span><span class="si">{2}</span><span class="s2">)(?![:])([^/</span><span class="se">\\\\</span><span class="s2">]+)[/</span><span class="se">\\\\</span><span class="s2">]([^/</span><span class="se">\\\\</span><span class="s2">]+)[/</span><span class="se">\\\\</span><span class="s2">]*([/</span><span class="se">\\\\</span><span class="s2">]&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_COL</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                 # 44</span>
<span class="s2">    |(([^:/?#]{2,}://)([^/]{0,1}[^/</span><span class="se">\\\\</span><span class="s2">]*)[/</span><span class="se">\\\\</span><span class="s2">]*?([/]{0,1}[^?:;]+)([?]&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_COL</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;){0,1})                # 52</span>
<span class="s2">    |(()()([a-zA-Z]:)([/</span><span class="se">\\\\</span><span class="s2">]+?&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_COL</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                                                              # 60</span>
<span class="s2">    |(()()([a-zA-Z]:)(&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_COL</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                                                                       # 68</span>
<span class="s2">    |(()()([a-zA-Z]:)(&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_DUMMY</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                                                                           # 76</span>
<span class="s2">    |(()()()&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_COL</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;())                                                                                # 84</span>
<span class="s2">    |(()()()()&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_DUMMY</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;(?=[:]))                                                                             # 92</span>
<span class="s2">)[:]?)                                                                                                               # 94</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># @UndefinedVariable</span>

<span class="c1">#: Scanner/Parser for semicolon based search path separator. ::</span>
<span class="c1">#:</span>
<span class="c1">#:    os.pathsep == &#39;;&#39;</span>
<span class="c1">#:</span>
<span class="c1">#: The applied rules are corresponding to *APPPATHSCANNER_COL*.</span>
<span class="n">APPPATHSCANNER_SEM</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<span class="sd">r&quot;&quot;&quot;((</span>
<span class="sd">     ((file://[/]{0,1}[/\\\\]{2}|unc://)(.{0,1}[^/\\\\]+)[/\\\\]([^/\\\\]+)[/\\\\]*([/\\\\]&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_SEM</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;)) #  4</span>
<span class="s2">    |((file:///{0,1}|file:)()([a-zA-Z]:)[/</span><span class="se">\\\\</span><span class="s2">]*?([/</span><span class="se">\\\\</span><span class="s2">]{0,1}&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_SEM</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                               # 12</span>
<span class="s2">    |((file://)([^/</span><span class="se">\\\\</span><span class="s2">]+)()(&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_SEM</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                                                                # 20</span>
<span class="s2">    |((file://|file:)()()(&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_SEM</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                                                                   # 28</span>
<span class="s2">    |((smb://|cifs://)([^/]{0,1}[^/</span><span class="se">\\\\</span><span class="s2">]*)[/</span><span class="se">\\\\</span><span class="s2">]+([^/</span><span class="se">\\\\</span><span class="s2">]+)[/</span><span class="se">\\\\</span><span class="s2">]*([/</span><span class="se">\\\\</span><span class="s2">]&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_SEM</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                # 36</span>
<span class="s2">    |(([</span><span class="se">\\\\</span><span class="s2">]</span><span class="si">{2}</span><span class="s2">|[/]</span><span class="si">{2}</span><span class="s2">)(?![:])([^/</span><span class="se">\\\\</span><span class="s2">]+)[/</span><span class="se">\\\\</span><span class="s2">]([^/</span><span class="se">\\\\</span><span class="s2">]+)[/</span><span class="se">\\\\</span><span class="s2">]*([/</span><span class="se">\\\\</span><span class="s2">]&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_SEM</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                 # 44</span>
<span class="s2">    |(([^;/?#]{2,}://)([^/]{0,1}[^/</span><span class="se">\\\\</span><span class="s2">]*)[/</span><span class="se">\\\\</span><span class="s2">]*?([/]{0,1}[^?:;]+)([?]&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_SEM</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;){0,1})                # 52</span>
<span class="s2">    |(()()([a-zA-Z]:)([/</span><span class="se">\\\\</span><span class="s2">]+?&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_SEM</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                                                              # 60</span>
<span class="s2">    |(()()([a-zA-Z]:)(&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_SEM</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                                                                       # 68</span>
<span class="s2">    |(()()([a-zA-Z]:)(&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_DUMMY</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;))                                                                           # 76</span>
<span class="s2">    |(()()()&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_NOSEP_SEM</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;())                                                                                # 84</span>
<span class="s2">    |(()()()()&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">_DUMMY</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;(?=[;]))                                                                             # 92</span>
<span class="s2">)[;]?)                                                                                                    # 94</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># @UndefinedVariable</span>


<span class="c1">#: Helper with group indexes pointing onto the supported syntax terms of *APPPATHSCANNER*.</span>
<span class="n">APPPATHINDEX</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">4</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span>
    <span class="mi">28</span><span class="p">,</span>
    <span class="mi">36</span><span class="p">,</span>
    <span class="mi">44</span><span class="p">,</span>
    <span class="mi">52</span><span class="p">,</span>
    <span class="mi">60</span><span class="p">,</span>
    <span class="mi">68</span><span class="p">,</span>
    <span class="mi">76</span><span class="p">,</span>
    <span class="mi">84</span><span class="p">,</span>
    <span class="mi">92</span><span class="p">,</span> <span class="p">)</span>

<span class="c1">#: Helper with human readable enums for types of path variable elements of *APPPATHINDEX*.</span>
<span class="n">APPTYPES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;share&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ldsys&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rfsys&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lfsys&#39;</span><span class="p">,</span>
    <span class="s1">&#39;smb&#39;</span><span class="p">,</span>
    <span class="s1">&#39;share&#39;</span><span class="p">,</span>
    <span class="s1">&#39;uri&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ldsys&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ldsys&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ldsys&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lfsys&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="p">)</span>

<span class="c1">#: Helper with human readable enums for secondary level-2 types of *APPTYPES*.</span>
<span class="n">APPTYPES_L2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;http://&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">,),</span>
    <span class="s1">&#39;https://&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">,),</span>
    <span class="s1">&#39;smb://&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;smb&#39;</span><span class="p">,),</span>
    <span class="s1">&#39;cifs://&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;smb&#39;</span><span class="p">,),</span>  <span class="c1"># non-standard</span>
    <span class="s1">&#39;unc://&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;share&#39;</span><span class="p">,),</span>  <span class="c1"># non-standard</span>
    <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;share&#39;</span><span class="p">,),</span>
    <span class="s1">&#39;//&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;share&#39;</span><span class="p">,),</span>
<span class="p">}</span>

<span class="c1">#</span>
<span class="c1"># *** splits environment variables ***</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
    <span class="n">_ENV_SPLIT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>  <span class="c1">#: Split-out environment variables for substitution.</span>
       <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">       (</span>
<span class="sd">           (([^%]*?)([%][a-zA-Z0-9_]+[%]))           # 2: defined without brace</span>
<span class="sd">         | (([^%]*?)([%][a-zA-Z0-9_]+[^%]?))         # 5: ERROR:</span>
<span class="sd">         | ((.*)())                                  # 8: any</span>
<span class="sd">       )</span>
<span class="sd">       &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># @UndefinedVariable</span>

    <span class="n">_ENV_SPLITg</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1">#: Entry points into sub strings environment variables and literals.</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">,</span>
    <span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_ENV_SPLIT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>  <span class="c1">#: Split-out environment variables for substitution.</span>
       <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">       (</span>
<span class="sd">           (([^$]*?)([$][{][a-zA-Z0-9_]+[}]))        # 2: defined with brace</span>
<span class="sd">         | (([^$]*?)([$][a-zA-Z0-9_]+[;]?))          # 5: defined without brace</span>
<span class="sd">         | (([^$]*?)([$][{][a-zA-Z0-9_]+[^}]?))      # 8: ERROR:</span>
<span class="sd">         | ((.*)())                                  # 11: any</span>
<span class="sd">       )</span>
<span class="sd">       &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># @UndefinedVariable</span>

    <span class="n">_ENV_SPLITg</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1">#: Entry points into sub strings environment variables and literals.</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">,</span>
        <span class="mi">11</span><span class="p">,</span>
    <span class="p">]</span>

<span class="c1"># pylint: enable-msg=W0105</span>
<span class="n">_tpf_num</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="n">RTE</span><span class="p">,</span>
    <span class="s1">&#39;uri&#39;</span><span class="p">:</span> <span class="n">RTE_URI</span><span class="p">,</span>  <span class="c1"># TODO: replace by RTE_URI virtual platform bit</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="n">RTE_HTTP</span><span class="p">,</span>  <span class="c1"># TODO: replace by RTE_URI virtual platform bit</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="n">RTE_HTTPS</span><span class="p">,</span>  <span class="c1"># TODO: replace by RTE_URI virtual platform bit</span>
    <span class="s1">&#39;posix&#39;</span><span class="p">:</span> <span class="n">RTE_POSIX</span><span class="p">,</span>
    <span class="s1">&#39;win&#39;</span><span class="p">:</span> <span class="n">RTE_WIN32</span><span class="p">,</span>
    <span class="s1">&#39;win32&#39;</span><span class="p">:</span> <span class="n">RTE_WIN32</span><span class="p">,</span>
    <span class="s1">&#39;local&#39;</span><span class="p">:</span> <span class="n">RTE</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="addpath_to_searchpath"><a class="viewcode-back" href="../../apppaths.html#filesysobjects.apppaths.addpath_to_searchpath">[docs]</a><span class="k">def</span> <span class="nf">addpath_to_searchpath</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds a path to &#39;plist&#39;.</span>

<span class="sd">    In case of relative path searches in provided</span>
<span class="sd">    &#39;plist&#39;, or &#39;kargs[searchplist]&#39;a hook, when found</span>
<span class="sd">    verifies the existence within file system, in case</span>
<span class="sd">    of success adds the completed path to &#39;plist&#39; the list.</span>

<span class="sd">    In case of &#39;glob&#39; adds all entries.</span>

<span class="sd">    Args:</span>
<span class="sd">        **spath**:</span>
<span class="sd">            A path to be added to &#39;plist&#39;.</span>
<span class="sd">            See common options for details.</span>
<span class="sd">            Valid scope types:</span>

<span class="sd">                * literal : X</span>
<span class="sd">                * re      : -</span>
<span class="sd">                * blob    : -</span>

<span class="sd">            default := caller-file-position.</span>

<span class="sd">        **plist**:</span>

<span class="sd">            List to for the storage, and by default</span>
<span class="sd">            search list too.</span>
<span class="sd">            See common options for details.</span>

<span class="sd">            default := sys.path</span>

<span class="sd">        kargs:</span>
<span class="sd">            **append**:</span>
<span class="sd">                Append, this is equal to</span>
<span class="sd">                pos=len(plist).</span>

<span class="sd">            **checkreal**:</span>
<span class="sd">                Checks redundancy by resolving real path,</span>
<span class="sd">                else literally.</span>

<span class="sd">            **exist**:</span>
<span class="sd">                Checks whether exists, else nothing is done.</span>

<span class="sd">            **pos**:</span>
<span class="sd">                A specific position for insertion</span>
<span class="sd">                within range(0,len(plist)). ::</span>

<span class="sd">                  pos := #pos</span>

<span class="sd">            **prepend**:</span>
<span class="sd">                Prepend, this is equal to</span>
<span class="sd">                pos=0.</span>

<span class="sd">            **redundant**:</span>
<span class="sd">                Add relative, allow redundant when</span>
<span class="sd">                same is already present.</span>

<span class="sd">            **relative**:</span>
<span class="sd">                Add relative sub path to</span>
<span class="sd">                provided base. ::</span>

<span class="sd">                   relative := &lt;base&gt;:</span>

<span class="sd">            **searchplist**:</span>
<span class="sd">                Alternative list to search for checks.</span>

<span class="sd">            **spf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">            **tpf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to the API in the manual at :ref:`tpf &lt;OPTS_TPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.gettpf() &lt;paths.html#gettpf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">    Returns:</span>
<span class="sd">        When successful returns insertion position, else a &#39;value&lt;0&#39;.</span>
<span class="sd">        The insertion position in case of multiple items is the position</span>
<span class="sd">        of the last.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AppPathError</span>
<span class="sd">        passed through exceptions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>

    <span class="n">_spf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_tpf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">_splist</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;searchplist&#39;</span><span class="p">,</span> <span class="n">plist</span><span class="p">)</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">relative</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_exist</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_red</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_chkr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;prepend&#39;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;append&#39;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Digits required for &#39;pos&#39;*&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
                                       <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;relative&#39;</span><span class="p">:</span>
            <span class="n">relative</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;exists&#39;</span><span class="p">:</span>
            <span class="n">_exist</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;redundant&#39;</span><span class="p">:</span>
            <span class="n">_red</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;checkreal&#39;</span><span class="p">:</span>
            <span class="n">_chkr</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">_add</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">relative</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">getpythonpath_rel</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">relative</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_red</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_chkr</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sx</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">plist</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">sx</span><span class="p">:</span>
                        <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
                    <span class="k">return</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">plist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">plist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pos</span>

    <span class="c1"># normalize</span>
    <span class="n">_start_elems</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">spath</span> <span class="o">=</span> <span class="n">splitapppathx_getlocalpath</span><span class="p">(</span><span class="n">_start_elems</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_exist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">spath</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_add</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">spath</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_add</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">spath</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">_splist</span><span class="p">[:]:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">spath</span><span class="p">):</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">_add</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">spath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">spath</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_add</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">spath</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_add</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">spath</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">_splist</span><span class="p">[:]:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">spath</span><span class="p">):</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">_add</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">spath</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pos</span></div>


<div class="viewcode-block" id="delpath_from_searchpath"><a class="viewcode-back" href="../../apppaths.html#filesysobjects.apppaths.delpath_from_searchpath">[docs]</a><span class="k">def</span> <span class="nf">delpath_from_searchpath</span><span class="p">(</span><span class="n">dellist</span><span class="p">,</span> <span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Deletes a list of paths from &#39;plist&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        **dellist**:</span>
<span class="sd">            A list of paths to be deleted</span>
<span class="sd">            from &#39;plist&#39;. Valid scope types:</span>

<span class="sd">                * literal : X</span>
<span class="sd">                * re      : X</span>
<span class="sd">                * glob    : X</span>

<span class="sd">            see kargs[regexpr|glob].</span>

<span class="sd">            default := None</span>

<span class="sd">        **plist**:</span>
<span class="sd">            List of search paths.</span>

<span class="sd">            default := sys.path</span>

<span class="sd">        kargs:</span>
<span class="sd">            The following keys are additional before</span>
<span class="sd">            comparison, on &#39;dellist&#39; only when no</span>
<span class="sd">            match pattern is provided:</span>

<span class="sd">                **case**:</span>
<span class="sd">                    Calls on both: os.path.normcase</span>

<span class="sd">                **esc**:</span>
<span class="sd">                    Calls on both: escapepathx/unescapepathx</span>

<span class="sd">                **exist**:</span>
<span class="sd">                    Calls on both: os.path.exists</span>

<span class="sd">                **noexist**:</span>
<span class="sd">                    Calls on both: not os.path.exists</span>

<span class="sd">                **norm**:</span>
<span class="sd">                    Calls on both: normpathx</span>

<span class="sd">                **norm**:</span>
<span class="sd">                    Calls on both: os.path.normpath</span>

<span class="sd">                **real**:</span>
<span class="sd">                    Calls on both: os.path.realpath</span>

<span class="sd">            **regexpr|glob**:</span>
<span class="sd">                Input is a list of</span>

<span class="sd">                **regexpr**:</span>
<span class="sd">                    regular expressions,</span>
<span class="sd">                    just processed by</span>
<span class="sd">                        &#39;re.match(dl,pl)&#39;</span>

<span class="sd">                **glob**:</span>
<span class="sd">                    process glob, and check</span>
<span class="sd">                    containment in set</span>

<span class="sd">    Returns:</span>
<span class="sd">        When successful returns True, else False.</span>

<span class="sd">    Raises:</span>
<span class="sd">        passed through exceptions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dellist</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">_exists</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_rg</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_raw</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_real</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_norm</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_case</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="c1"># @UnusedVariable</span>

        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;exist&#39;</span><span class="p">:</span>
            <span class="n">_exist</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">_exists</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;noexist&#39;</span><span class="p">:</span>
            <span class="n">_exist</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">_exists</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;regexpr&#39;</span><span class="p">:</span>
            <span class="n">_reg</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">_glob</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">__rg</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;glob&#39;</span><span class="p">:</span>
            <span class="n">_reg</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">_glob</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">__rg</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># seems to be sure</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dellist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">dellist</span> <span class="o">=</span> <span class="p">[</span><span class="n">dellist</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">dl</span> <span class="ow">in</span> <span class="n">dellist</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">plist</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">_raw</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dl</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span> <span class="ow">and</span> <span class="n">dl</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;file://&#39;</span><span class="p">:</span>
                    <span class="n">dl</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">dl</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pl</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span> <span class="ow">and</span> <span class="n">pl</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;file://&#39;</span><span class="p">:</span>
                    <span class="n">pl</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">pl</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_real</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_rg</span><span class="p">:</span>
                    <span class="n">dl</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span>
                <span class="n">pl</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_norm</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_rg</span><span class="p">:</span>
                    <span class="n">dl</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span>
                <span class="n">pl</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_case</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_rg</span><span class="p">:</span>
                    <span class="n">dl</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span>
                <span class="n">pl</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_exists</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_exist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_rg</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dl</span><span class="p">):</span>
                            <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pl</span><span class="p">):</span>
                        <span class="k">continue</span>

            <span class="k">if</span> <span class="n">_rg</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_reg</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span> <span class="n">pl</span><span class="p">):</span>
                        <span class="n">plist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">plist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pl</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">_glob</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pl</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">dl</span><span class="p">):</span>
                        <span class="n">plist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">plist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pl</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dl</span> <span class="o">==</span> <span class="n">pl</span><span class="p">:</span>
                    <span class="n">plist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">plist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pl</span><span class="p">))</span>

    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="join_apppathx_entry"><a class="viewcode-back" href="../../apppaths.html#filesysobjects.apppaths.join_apppathx_entry">[docs]</a><span class="k">def</span> <span class="nf">join_apppathx_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assembles the components of an application path entry.</span>

<span class="sd">    Known standard applications are: ::</span>

<span class="sd">      cifs , file, ftp, http, https, smb, unc, uri</span>
<span class="sd">      &lt;unc-file-path&gt;, &lt;posix-app-file-path&gt;</span>

<span class="sd">    The path entry is not normalized again, thus</span>
<span class="sd">    has to be in the appropriate platform syntax.</span>

<span class="sd">    Args:</span>

<span class="sd">        **entry**:</span>
<span class="sd">            Application entry as provided by *splitapppathx()*.</span>


<span class="sd">        kw:</span>
<span class="sd">            **apppre**:</span>
<span class="sd">                Add application prefix.</span>

<span class="sd">            **tpf**:</span>
<span class="sd">                Target platform.</span>

<span class="sd">    Returns:</span>

<span class="sd">        Entry as a single stings.</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">apppre</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">_tpf</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_tpf</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># use the entry is not tpf provided</span>
        <span class="n">_tpf</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39;:.*$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">_tpf</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_tpf</span> <span class="o">&amp;</span> <span class="n">RTE_URI</span><span class="p">:</span>
            <span class="n">apppre</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">_tpf</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;uri&#39;</span><span class="p">:</span>
        <span class="c1"># use the entry is not tpf provided</span>
        <span class="n">_tpf</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39;:.*$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">_tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;rfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;ldsys&#39;</span><span class="p">,):</span>
            <span class="n">_tpf</span> <span class="o">=</span> <span class="s1">&#39;fileuri&#39;</span>
        <span class="n">apppre</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">_tpf</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;rfsys&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
            <span class="n">_tpf</span> <span class="o">=</span> <span class="s1">&#39;fileuri&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_tpf</span> <span class="o">=</span> <span class="s1">&#39;share&#39;</span>

    <span class="n">tsep</span><span class="p">,</span> <span class="n">pathsep</span><span class="p">,</span> <span class="n">tpf</span><span class="p">,</span> <span class="n">rte</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">_tpf</span><span class="p">,</span> <span class="n">apppre</span><span class="o">=</span><span class="n">apppre</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>

    <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>  <span class="c1"># URI scheme allways uses a slash</span>
        <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>

    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># URI/URL</span>
        <span class="k">if</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;posix&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;//&#39;</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ldsys&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">apppre</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://&#39;</span>
                <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ldsys&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">apppre</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;unc&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://///&#39;</span>
                <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tsep</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">rte</span> <span class="o">==</span> <span class="n">RTE_SMB</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s1">r&#39;smb://&#39;</span>
            <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;cifs&#39;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s1">r&#39;cifs://&#39;</span>
            <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">,</span> <span class="s1">&#39;http&#39;</span><span class="p">,):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">tpf</span> <span class="o">+</span> <span class="s1">&#39;://&#39;</span>
            <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># entry 2 is share padding for path position comaptibility</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;?&#39;</span><span class="p">:</span>
                        <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">res</span> <span class="o">+=</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;ftp&#39;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;ftp://&#39;</span>
            <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">rte</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI4</span><span class="p">,</span> <span class="n">RTE_FILEURI5</span><span class="p">,):</span>
            <span class="k">if</span> <span class="n">rte</span> <span class="o">==</span> <span class="n">RTE_FILEURI4</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file:////&#39;</span>
            <span class="k">elif</span> <span class="n">rte</span> <span class="o">==</span> <span class="n">RTE_FILEURI5</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://///&#39;</span>

            <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">rte</span> <span class="o">==</span> <span class="n">RTE_FILEURI0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file:&#39;</span>
            <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span>
                    <span class="s2">&quot;minimal representation does not support remote files systems&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;[a-zA-Z]:&#39;</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span>
                        <span class="s2">&quot;minimal representation does not shares: &quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="p">)</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://&#39;</span>
            <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>

            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>


        <span class="k">elif</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;share&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="mi">255</span> <span class="o">|</span> <span class="n">RTE_URI</span><span class="p">)</span> <span class="o">==</span> <span class="n">RTE_FILEURI0</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://&#39;</span>  <span class="c1"># minimal</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="mi">255</span> <span class="o">|</span> <span class="n">RTE_URI</span><span class="p">)</span> <span class="o">==</span> <span class="n">RTE_FILEURI4</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file:////&#39;</span>  <span class="c1"># traditional</span>
                <span class="c1">#elif rte &amp; 255 == RTE_FILEURI5 or rte &amp; 255 == RTE_FILEURI:</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://///&#39;</span>  <span class="c1"># extra slash</span>

                <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tsep</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;rfsys&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">r&#39;file://&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;win&#39;</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;//&#39;</span>

            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;ldsys&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="c1"># RFC8089.E.2: URIs of the form &quot;file:///c:/path/to/file&quot; are already</span>
                <span class="c1"># supported by the &quot;path-absolute&quot; rule.</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file:///&#39;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;lfsys&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://&#39;</span>
                <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;lfsys&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://&#39;</span>
                <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">tsep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="s2">&quot;local posix path requested: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ldsys&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="c1"># RFC8089.E.2: URIs of the form &quot;file:///c:/path/to/file&quot; are already</span>
                <span class="c1"># supported by the &quot;path-absolute&quot; rule.</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file:///&#39;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;share&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="mi">255</span> <span class="o">|</span> <span class="n">RTE_URI</span><span class="p">)</span> <span class="o">==</span> <span class="n">RTE_FILEURI0</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://&#39;</span>  <span class="c1"># minimal</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">rte</span> <span class="o">&amp;</span> <span class="mi">255</span> <span class="o">|</span> <span class="n">RTE_URI</span><span class="p">)</span> <span class="o">==</span> <span class="n">RTE_FILEURI4</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file:////&#39;</span>  <span class="c1"># traditional</span>
                <span class="c1">#elif rte &amp; 255 == RTE_FILEURI5 or rte &amp; 255 == RTE_FILEURI:</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;file://///&#39;</span>  <span class="c1"># extra slash</span>

                <span class="n">tsep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tsep</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;rfsys&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="s1">r&#39;file://&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tpf</span> <span class="o">==</span> <span class="s1">&#39;win&#39;</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;//&#39;</span>

            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># generic URI/URL</span>
            <span class="n">tsep</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">tpf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;://&quot;</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;?&#39;</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ret</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># s.th. else - generic local path</span>
        <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="normapppathx"><a class="viewcode-back" href="../../apppaths.html#filesysobjects.apppaths.normapppathx">[docs]</a><span class="k">def</span> <span class="nf">normapppathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generic extention of *normpathx()* by application schemes and search path syntax.</span>

<span class="sd">    Args:</span>
<span class="sd">        **spath**:</span>
<span class="sd">            Accepts path, or search-path.</span>

<span class="sd">        kargs:</span>
<span class="sd">            Supports the parameters of :ref:`splitapppathx() &lt;def_splitapppathx&gt;`</span>

<span class="sd">            **apppre**:</span>
<span class="sd">                Application scheme.</span>

<span class="sd">            **appsplit**:</span>
<span class="sd">                Split into scheme and components of an application path.</span>

<span class="sd">            **spf**:</span>
<span class="sd">                Source platform.</span>

<span class="sd">            **tpf**:</span>
<span class="sd">                Target platform.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Normalized path or search-path.</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through: see :ref:`splitapppathx() &lt;def_splitapppathx&gt;`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># is default: kargs[&#39;normpathx&#39;] = True</span>
    <span class="n">apppre</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;appsplit&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">apx</span> <span class="ow">in</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">apx</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">apx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join_apppathx_entry</span><span class="p">(</span><span class="n">apx</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">))</span>


    <span class="n">_tpf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_tpf</span><span class="p">:</span>
        <span class="n">_tsep</span><span class="p">,</span> <span class="n">_tpsep</span><span class="p">,</span> <span class="n">_tpf</span><span class="p">,</span> <span class="n">_t</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">_tpf</span><span class="p">,</span> <span class="n">apppre</span><span class="o">=</span><span class="n">apppre</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_tsep</span><span class="p">,</span> <span class="n">_tpsep</span><span class="p">,</span> <span class="n">_tpf</span><span class="p">,</span> <span class="n">_t</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">_tpf</span><span class="p">,</span> <span class="n">apppre</span><span class="o">=</span><span class="n">apppre</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_tpsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>

<div class="viewcode-block" id="set_uppertree_searchpath"><a class="viewcode-back" href="../../apppaths.html#filesysobjects.apppaths.set_uppertree_searchpath">[docs]</a><span class="k">def</span> <span class="nf">set_uppertree_searchpath</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prepends each directory path from from &#39;start&#39; on upward to &#39;top&#39;</span>
<span class="sd">    in-place into *plist*. For example: ::</span>

<span class="sd">       start :=  /my/top/a/b/c</span>
<span class="sd">       top   :=  /my/top</span>

<span class="sd">    results in: ::</span>

<span class="sd">       plist := [</span>
<span class="sd">          &#39;/my/top/a/b/c&#39;,</span>
<span class="sd">          &#39;/my/top/a/b&#39;,</span>
<span class="sd">          &#39;/my/top/a&#39;,</span>
<span class="sd">          &#39;/my/top&#39;,</span>
<span class="sd">       ]</span>

<span class="sd">    Args:</span>
<span class="sd">        **start**:</span>
<span class="sd">            Start components of a path string.</span>
<span class="sd">            See common options for details.</span>
<span class="sd">            Valid scope types:</span>

<span class="sd">                * literal : X</span>
<span class="sd">                * re      : -</span>
<span class="sd">                * blob    : -</span>

<span class="sd">            default := caller-file-position.</span>

<span class="sd">        **top**:</span>
<span class="sd">            End component of a path string.</span>
<span class="sd">            The node &#39;top&#39; is included.</span>
<span class="sd">            Valid scope types:</span>

<span class="sd">                * literal : X</span>
<span class="sd">                * re      : -</span>
<span class="sd">                * blob    : -</span>

<span class="sd">            default := &lt;same-as-start&gt;</span>

<span class="sd">        **plist**:</span>
<span class="sd">            List to for the storage.</span>
<span class="sd">            See common options for details.</span>

<span class="sd">            default := sys.path</span>

<span class="sd">        kargs:</span>
<span class="sd">            **append**:</span>
<span class="sd">                Appends the set of search paths.</span>

<span class="sd">            **matchidx**:</span>
<span class="sd">                Ignore matches &#39;&lt; #idx&#39;,</span>
<span class="sd">                adds match &#39;== #idx&#39; and returns.</span>

<span class="sd">                   matchidx := #idx</span>

<span class="sd">                default := 0 # all</span>

<span class="sd">            **matchcnt**:</span>
<span class="sd">                The maximal number of matches</span>
<span class="sd">                returned when multiple occur. ::</span>

<span class="sd">                   matchcnt=#num:</span>

<span class="sd">            **matchlvl**:</span>
<span class="sd">                Increment of match for top node when</span>
<span class="sd">                multiple are in the path. ::</span>

<span class="sd">                   matchlvl := #num:</span>

<span class="sd">                See common options for details.</span>

<span class="sd">            **matchlvlbackward**:</span>
<span class="sd">                Increment of match for top node when</span>
<span class="sd">                multiple are in the path. ::</span>

<span class="sd">                   matchlvlbackward := #num:</span>

<span class="sd">                See common options for details.</span>

<span class="sd">            **noTypeCheck**:</span>
<span class="sd">                Suppress required identical types of &#39;top&#39; and</span>
<span class="sd">                &#39;start&#39;. As a rule of thumb for current</span>
<span class="sd">                version, the search component has to be less</span>
<span class="sd">                restrictive typed than the searched.</span>
<span class="sd">                The default applicable type matches are::</span>

<span class="sd">                     top    ¦ start</span>
<span class="sd">                    --------+---------------------</span>
<span class="sd">                     lfsys  ¦ lfsys, ldsys, share</span>
<span class="sd">                            | smb, cifs,</span>
<span class="sd">                     ldsys  ¦ ldsys</span>
<span class="sd">                     share  ¦ share</span>
<span class="sd">                     smb    ¦ smb</span>
<span class="sd">                     cifs   ¦ cifs</span>
<span class="sd">                     http   ¦ http, https</span>
<span class="sd">                     https  ¦ https, http</span>

<span class="sd">                See common options for details.</span>

<span class="sd">            **prepend**:</span>
<span class="sd">                Prepends the set of search paths.</span>
<span class="sd">                This is default.</span>

<span class="sd">            **raw**:</span>
<span class="sd">                Suppress normalization by call of</span>
<span class="sd">                &#39;os.path.normpath&#39;.</span>

<span class="sd">            **relonly**:</span>
<span class="sd">                The paths are inserted relative to the</span>
<span class="sd">                top node only. This is mainly for test</span>
<span class="sd">                purposes. The intermix of relative and</span>
<span class="sd">                absolute path entries is not verified.</span>

<span class="sd">            **reverse**:</span>
<span class="sd">                This reverses the resulting search order</span>
<span class="sd">                 from bottom-up to top-down.</span>

<span class="sd">            **unique**:</span>
<span class="sd">                Insert non-present only, else present</span>
<span class="sd">                entries are not checked, thus the search order</span>
<span class="sd">                is changed in general for &#39;prepend&#39;, while</span>
<span class="sd">                for &#39;append&#39; the present still covers the new</span>
<span class="sd">                entry.</span>

<span class="sd">    Returns:</span>
<span class="sd">        When successful returns &#39;True&#39;, else returns either &#39;False&#39;,</span>
<span class="sd">        or raises an exception.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AppPathError</span>

<span class="sd">        pass-through</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>

    <span class="n">_relo</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_matchcnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_matchidx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">set_uppertree_searchpath</span><span class="o">.</span><span class="n">_matchcnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">set_uppertree_searchpath</span><span class="o">.</span><span class="n">_matchidx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">matchlvl</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">matchlvlbackward</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">reverse</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">prepend</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_tchk</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_raw</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_split</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_sitem</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;relonly&#39;</span><span class="p">:</span>
            <span class="n">_relo</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;matchcnt&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Digits only matchcnt:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="n">_matchcnt</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;matchidx&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Digits only matchidx:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="n">_matchidx</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;matchlvl&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Digits only matchlvl:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="n">matchlvl</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;matchlvlbackward&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Digits only matchlvlbackward:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="n">matchlvlbackward</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;reverse&#39;</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;unique&#39;</span><span class="p">:</span>
            <span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;append&#39;</span><span class="p">:</span>
            <span class="n">prepend</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;prepend&#39;</span><span class="p">:</span>
            <span class="n">prepend</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;raw&#39;</span><span class="p">:</span>
            <span class="n">_raw</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;splitItems&#39;</span><span class="p">:</span>
            <span class="n">_split</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;singleitem&#39;</span><span class="p">:</span>
            <span class="n">_sitem</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;noTypeCheck&#39;</span><span class="p">:</span>
            <span class="n">_tchk</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">matchlvl</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">matchlvlbackward</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Prepare search path list</span>
    <span class="c1"># if decided to normalize, and whether to ignore leading &#39;//&#39;</span>
    <span class="k">if</span> <span class="n">_raw</span><span class="p">:</span>  <span class="c1"># match basically literally</span>
        <span class="n">_plst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
            <span class="c1"># normalize</span>
            <span class="n">_elems</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_plst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitapppathx_getlocalpath</span><span class="p">(</span><span class="n">_elems</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># normalize for safer match conditions</span>
        <span class="n">_plst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
            <span class="c1"># normalize</span>
            <span class="n">_elems</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_plst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitapppathx_getlocalpath</span><span class="p">(</span><span class="n">_elems</span><span class="p">))</span>

    <span class="c1"># 0. prep start dir</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Empty start:&#39;&#39;&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">getcaller_filepathname</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># caller file</span>
    <span class="c1"># normalize</span>
    <span class="n">_start_elems</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">splitapppathx_getlocalpath</span><span class="p">(</span><span class="n">_start_elems</span><span class="p">)</span>
    <span class="c1"># try a literal</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">start</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">getcaller_pathname</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">start</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">start</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>  <span class="c1"># we need dir</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">start</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Missing start:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>

    <span class="c1"># 1. prep top dir</span>

    <span class="c1"># normalize</span>
    <span class="k">if</span> <span class="n">top</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Empty top:&#39;&#39;&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">top</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">getcaller_pathname</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># caller file</span>

    <span class="c1"># normalize</span>
    <span class="n">_top_elems</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">splitapppathx</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># ptype</span>
    <span class="k">if</span> <span class="n">_tchk</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_top_elems</span> <span class="ow">and</span> <span class="n">_start_elems</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_top_elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">_start_elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>

                <span class="c1"># TODO: still to enhance..</span>
                <span class="k">if</span> <span class="n">_top_elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="p">):</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">_top_elems</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
                        <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">_start_elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span>
                            <span class="s1">&#39;ldsys&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span>
                            <span class="s2">&quot;&#39;lfsys&#39; combined with &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_start_elems</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span>
                            <span class="s2">&quot; requires relative pathname for &#39;lfsys&#39;, given: &quot;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_top_elems</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span>
                        <span class="s2">&quot;This version requires compatible types: start(&quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">_start_elems</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;) =! top(&quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">_top_elems</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>

    <span class="n">top</span> <span class="o">=</span> <span class="n">splitapppathx_getlocalpath</span><span class="p">(</span><span class="n">_top_elems</span><span class="p">)</span>

    <span class="c1"># if absolute</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Top does not exist:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_addsub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pl</span><span class="o">=</span><span class="n">plist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;...same for all.&quot;&quot;&quot;</span>
        <span class="c1"># &gt;3: nonlocal _matchcnt</span>
        <span class="k">if</span> <span class="n">_matchcnt</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">_matchcnt</span> <span class="o">&lt;=</span> <span class="n">set_uppertree_searchpath</span><span class="o">.</span><span class="n">_matchcnt</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">_matchidx</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">_matchidx</span> <span class="o">!=</span> <span class="n">set_uppertree_searchpath</span><span class="o">.</span><span class="n">_matchidx</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">unique</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pl</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">set_uppertree_searchpath</span><span class="o">.</span><span class="n">_matchcnt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">pass</span>

    <span class="c1"># find top</span>
    <span class="k">if</span> <span class="n">top</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">top</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

        <span class="c1"># for now works with literal only</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">top</span>
        <span class="k">if</span> <span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="ow">and</span> <span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">stop</span>
        <span class="k">if</span> <span class="n">stop</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="ow">and</span> <span class="n">stop</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">start</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">top</span> <span class="o">!=</span> <span class="n">start</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span>
                <span class="s2">&quot;Top-node is not in search path:</span><span class="se">\n</span><span class="s2">  top   = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">  start = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">top</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">matchlvl</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>  <span class="c1"># check valid range</span>
            <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Match count out of range:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matchlvl</span><span class="p">)</span>
                                   <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
        <span class="c1"># check valid range</span>
        <span class="k">elif</span> <span class="n">matchlvlbackward</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">matchlvlbackward</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Match count out of range:&quot;</span> <span class="o">+</span>
                                   <span class="nb">str</span><span class="p">(</span><span class="n">matchlvlbackward</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">matchlvl</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Match count out of range:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matchlvl</span><span class="p">)</span>
                                   <span class="o">+</span> <span class="s2">&quot;&gt; 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matchlvlbackward</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Match count out of range:&quot;</span> <span class="o">+</span>
                                   <span class="nb">str</span><span class="p">(</span><span class="n">matchlvlbackward</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt; 0&quot;</span><span class="p">)</span>
        <span class="n">_addsub</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1">#</span>
    <span class="c1"># so we have actually at least one top within valid range and a remaining sub-path - let us start</span>
    <span class="c1">#</span>

    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>  <span class="c1"># top == start</span>
        <span class="k">if</span> <span class="n">matchlvl</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Match count out of range:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matchlvl</span><span class="p">)</span>
                                   <span class="o">+</span> <span class="s2">&quot;&gt; 0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matchlvlbackward</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Match count out of range:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matchlvl</span><span class="p">)</span>
                                   <span class="o">+</span> <span class="s2">&quot;&gt; 0&quot;</span><span class="p">)</span>
        <span class="n">_addsub</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">elif</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># top is prefix</span>
        <span class="n">_tpath</span> <span class="o">=</span> <span class="n">top</span>

        <span class="k">if</span> <span class="n">matchlvlbackward</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcnt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">matchlvlbackward</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mcnt</span> <span class="o">=</span> <span class="n">matchlvl</span>

        <span class="n">_spath</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">mcnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>  <span class="c1"># sub-path for search recursion</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="c1"># get index for requested number of ignored/contained matches</span>
        <span class="k">if</span> <span class="n">matchlvlbackward</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcnt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">matchlvlbackward</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mcnt</span> <span class="o">=</span> <span class="n">matchlvl</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># set matched prefix and postfix</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
            <span class="n">_tpath</span> <span class="o">=</span> <span class="n">top</span>
            <span class="c1"># sub-path for search recursion</span>
            <span class="n">_spath</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">top</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">mcnt</span><span class="p">:])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">a</span><span class="p">[</span><span class="n">mcnt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>  <span class="c1"># tail</span>
            <span class="n">_tpath</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">top</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="n">mcnt</span><span class="p">])</span>
            <span class="n">_spath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># top path as search hook</span>
            <span class="n">_tpath</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">top</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="n">mcnt</span><span class="p">])</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">top</span>
            <span class="c1"># sub-path for search recursion</span>
            <span class="n">_spath</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">top</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">mcnt</span><span class="p">:])</span>

    <span class="n">_tpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">_tpath</span><span class="p">)</span>
    <span class="n">_spath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">_spath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">_spath</span><span class="p">):</span>
        <span class="n">_spath</span> <span class="o">=</span> <span class="n">_spath</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">if</span> <span class="n">_relo</span><span class="p">:</span>  <span class="c1"># relative paths, mainly for test</span>
        <span class="n">curp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">curp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">_tpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">curp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>  <span class="c1"># insert top itself</span>
            <span class="n">_addsub</span><span class="p">(</span><span class="n">curp</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">_spath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prepend</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">curp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">curp</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">_addsub</span><span class="p">(</span><span class="n">curp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_buf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">curp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">curp</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">_addsub</span><span class="p">(</span><span class="n">curp</span><span class="p">,</span> <span class="n">_buf</span><span class="p">)</span>
        <span class="n">plist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_buf</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="splitapppathx"><a class="viewcode-back" href="../../apppaths.html#filesysobjects.apppaths.splitapppathx">[docs]</a><span class="k">def</span> <span class="nf">splitapppathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Splits PATH variables which may include URI type prefixes into</span>
<span class="sd">    a list of single path entries. The default behavior is to split</span>
<span class="sd">    a search path into a list of contained path entries. E.g::</span>

<span class="sd">       p = &#39;file:///a/b/c:/d/e::x/y:smb://host/share/q/w:http://host/a/b/:https://host/a?xy#123&#39;</span>

<span class="sd">    Is split into: ::</span>

<span class="sd">            px = [</span>
<span class="sd">                &#39;file:///a/b/c&#39;,</span>
<span class="sd">                &#39;file://host/a/b/c&#39;,</span>
<span class="sd">                &#39;file://///host/share/a/b/c&#39;,</span>
<span class="sd">                &#39;/d/e&#39;,</span>
<span class="sd">                &#39;&#39;,</span>
<span class="sd">                &#39;x/y&#39;,</span>
<span class="sd">                &#39;smb://host/share/q/w&#39;,</span>
<span class="sd">                &#39;//host/share/q/w&#39;,</span>
<span class="sd">                &#39;http://a/b/&#39;,</span>
<span class="sd">                &#39;https://host/a?xy#123&#39;,</span>
<span class="sd">            ]</span>

<span class="sd">    With parameter &#39;*appsplit*&#39; set the paths entries are sub-split into their schemes</span>
<span class="sd">    and type specific items ::</span>

<span class="sd">            px = [</span>
<span class="sd">                (&#39;lfsys&#39;,   &#39;&#39;,      &#39;&#39;,       &#39;/a/b/c&#39;),</span>
<span class="sd">                (&#39;rfsys&#39;,   &#39;host&#39;,  &#39;&#39;,       &#39;/a/b/c&#39;),</span>
<span class="sd">                (&#39;unc&#39;,     &#39;host&#39;,  &#39;share&#39;,  &#39;/a/b/c&#39;),</span>
<span class="sd">                (&#39;lfsys&#39;,   &#39;&#39;,      &#39;&#39;,       &#39;/d/e&#39;),</span>
<span class="sd">                (&#39;lfsys&#39;,   &#39;&#39;,      &#39;&#39;,       &#39;&#39;),</span>
<span class="sd">                (&#39;lfsys&#39;,   &#39;&#39;,      &#39;&#39;,       &#39;x/y&#39;),</span>
<span class="sd">                (&#39;smb&#39;,     &#39;host&#39;,  &#39;share&#39;,  &#39;q/w&#39;),</span>
<span class="sd">                (&#39;share&#39;,   &#39;host&#39;,  &#39;share&#39;,  &#39;q/w&#39;),</span>
<span class="sd">                (&#39;share&#39;,   &#39;host&#39;,  &#39;share&#39;,  &#39;q/w&#39;),</span>

<span class="sd">                (&#39;http&#39;,    &#39;host&#39;,   &#39;&#39;,      &#39;/a/b/&#39;,   &#39;&#39;),</span>
<span class="sd">                (&#39;https&#39;,   &#39;host&#39;,   &#39;&#39;,      &#39;/a&#39;,      &#39;xy#123&#39;),</span>
<span class="sd">            ]</span>

<span class="sd">    For reserved prefix keywords as parts of the name, these</span>
<span class="sd">    should be escaped.</span>

<span class="sd">    Args:</span>
<span class="sd">        **spath**:</span>
<span class="sd">            The search path to be split.</span>

<span class="sd">        kargs:</span>
<span class="sd">            The provided key-options are also transparently passed</span>
<span class="sd">            through to &#39;normpathx()&#39; `[see] &lt;paths.html#normpathx&gt;`_ - if not &#39;raw&#39;.</span>

<span class="sd">            **apppre**:</span>
<span class="sd">                Adds application prefix. ::</span>

<span class="sd">                    appsplit = (True|False)</span>

<span class="sd">                default := False</span>

<span class="sd">            **appsplit**:</span>
<span class="sd">                Splits into tuples of application entries. ::</span>

<span class="sd">                    appsplit = (True|False)</span>

<span class="sd">                default := False</span>

<span class="sd">                For example: ::</span>

<span class="sd">                   file:///my/path/a</span>

<span class="sd">                results for *True* in: ::</span>

<span class="sd">                   (lfsys, &#39;&#39;, &#39;&#39;, &#39;/my/path/a&#39;)</span>

<span class="sd">            **delnulpsep**:</span>
<span class="sd">                Delete empty search paths.</span>

<span class="sd">                default := True</span>

<span class="sd">            **escape**:</span>
<span class="sd">                Escapes backslash.</span>

<span class="sd">                default := False</span>

<span class="sd">            **keepsep**:</span>
<span class="sd">                Modifies the behavior of &#39;strip&#39; parameter.</span>
<span class="sd">                If &#39;False&#39;, the trailing separator is dropped. ::</span>

<span class="sd">                   splitapppathx(&#39;/a/b&#39;, keepsep=False)   =&gt; (&#39;&#39;, &#39;a&#39;, &#39;b&#39;)</span>
<span class="sd">                   splitapppathx(&#39;/a/b/&#39;, keepsep=False)  =&gt; (&#39;&#39;, &#39;a&#39;, &#39;b&#39;)</span>

<span class="sd">                for &#39;True&#39; trailing separators are kept as directory</span>
<span class="sd">                marker::</span>

<span class="sd">                   splitapppathx(&#39;/a/b&#39;, keepsep=True)    =&gt; (&#39;&#39;, &#39;a&#39;, &#39;b&#39;)</span>
<span class="sd">                   splitapppathx(&#39;/a/b/&#39;, keepsep=True)   =&gt; (&#39;&#39;, &#39;a&#39;, &#39;b&#39;, &#39;&#39;)</span>

<span class="sd">                default := False # for URIs except file://, smb://</span>
<span class="sd">                default := True  # for file path names</span>

<span class="sd">            **normpathx**:</span>
<span class="sd">                Calls *normapthx()* on path-part. ::</span>

<span class="sd">                   normpathx := (</span>
<span class="sd">                        True   # call normpathx</span>
<span class="sd">                      | False  # do not normalize</span>
<span class="sd">                   )</span>

<span class="sd">                default := True</span>


<span class="sd">            **pathsep**:</span>
<span class="sd">                Replaces path separator set by the *spf*, e.g. for a URI</span>
<span class="sd">                pathlist from an alternate platform. The resulting path</span>
<span class="sd">                separator selects the type of the scanner *APPPATHSCANNER*. ::</span>

<span class="sd">                    pathsep := (&#39;;&#39; | &#39;:&#39;)</span>

<span class="sd">            **raw**:</span>
<span class="sd">                Displays a list of unaltered split path items, superposes &#39;rpath&#39;</span>
<span class="sd">                and &#39;rtype&#39;. ::</span>

<span class="sd">                    raw = (True|False)</span>

<span class="sd">                default := False</span>

<span class="sd">            **rpath**:</span>
<span class="sd">                Displays the path as provided raw sub string.</span>

<span class="sd">                For further details refer to &#39;splitapppathx&#39;</span>
<span class="sd">                `[see] &lt;#split-appprefix&gt;`_. ::</span>

<span class="sd">                    rpath = (True|False)</span>

<span class="sd">            **rtype**:</span>
<span class="sd">                Displays the type prefix as provided raw sub string.</span>

<span class="sd">                For further details refer to &#39;splitapppathx&#39;</span>
<span class="sd">                `[see] &lt;#split-appprefix&gt;`_. ::</span>

<span class="sd">                    rtype = (True|False)</span>

<span class="sd">            **spf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">            **strict**:</span>
<span class="sd">                Validates for the target OS/FS, throws exception when invalid</span>
<span class="sd">                characters are contained.</span>

<span class="sd">            **strip**:</span>
<span class="sd">                Strips null-entries.</span>

<span class="sd">                default := True</span>

<span class="sd">            **tpf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to the API in the manual at :ref:`tpf &lt;OPTS_TPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.gettpf() &lt;paths.html#gettpf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">            **unescape**:</span>
<span class="sd">                Unescapes backslash.</span>

<span class="sd">                default := False</span>

<span class="sd">    Returns:</span>
<span class="sd">        When split successful returns a list of tuples: ::</span>

<span class="sd">            appsplit == False</span>

<span class="sd">                [</span>
<span class="sd">                    &lt;pathvar-item&gt;,</span>
<span class="sd">                    ...</span>
<span class="sd">                ]</span>

<span class="sd">            appsplit == True</span>

<span class="sd">                [</span>
<span class="sd">                    (TYPE, host-name, share-name, pathname),</span>
<span class="sd">                    ...</span>
<span class="sd">                ]</span>

<span class="sd">        The tuple contains: ::</span>

<span class="sd">            (TYPE, host-name, share-name, pathname)</span>

<span class="sd">              TYPE := (raw|cifs|smb|share|http|https|lfsys|rfsys|ldsys)</span>
<span class="sd">                 raw := (&lt;raw-pathvar-item&gt;)</span>
<span class="sd">                 cifs := (&#39;cifs://&#39;)</span>
<span class="sd">                 smb := (&#39;smb://&#39;)</span>
<span class="sd">                 share := (&#39;file:///&#39;+2SEP|&#39;file://&#39;+2SEP|2SEP)</span>
<span class="sd">                 rfsys := (&#39;file://&#39;)</span>
<span class="sd">                 lfsys := (&#39;file://&#39;|&#39;&#39;)</span>
<span class="sd">                 ldsys := [a-z]&#39;:&#39;</span>

<span class="sd">                 http := (&#39;http://&#39;)</span>
<span class="sd">                 https := (&#39;http://&#39;)</span>

<span class="sd">              host-name := (host-name|&#39;&#39;)</span>
<span class="sd">              share-name := (valid-share-name|&#39;&#39;)</span>
<span class="sd">              valid-share-name := (</span>
<span class="sd">                 smb-share-name</span>
<span class="sd">                 | cifs-share-name</span>
<span class="sd">                 | win-drive-share-name</span>
<span class="sd">                 | win-drive-os</span>
<span class="sd">                 | win-special-share-name</span>
<span class="sd">              )</span>
<span class="sd">              pathname := &quot;pathname on target&quot;</span>

<span class="sd">            specials:</span>

<span class="sd">               raw := (&#39;raw&#39;, &#39;&#39;, &#39;&#39;, raw-pathvar-item)</span>
<span class="sd">               rpath := (TYPE, host-name, share-name, raw-pathname)</span>
<span class="sd">               rtype := (raw-type, host-name, share-name, pathname)</span>
<span class="sd">               rtype + rpath := (raw-type, host-name, share-name, raw-pathname)</span>

<span class="sd">        For compatibility the URI for http/https adds one item</span>
<span class="sd">        &#39;query+fragment&#39;, while the share remains empty. ::</span>

<span class="sd">           (&#39;http&#39; | &#39;https&#39;) := (TYPE, host-name, &#39;&#39;, pathname, query+fragment)</span>

<span class="sd">        else: ::</span>

<span class="sd">           (&#39;lfsys&#39;, &#39;&#39;, &#39;&#39;, apstr)</span>

<span class="sd">        **REMARK**:</span>
<span class="sd">            The hostname may contain in current release</span>
<span class="sd">            any suboption, but is not tested with options at all.</span>

<span class="sd">    Raises:</span>
<span class="sd">        PathError</span>

<span class="sd">        passed-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_delnulpsep</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delnulpsep&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1">#: remove resulting empty entries</span>
    <span class="n">_normpathx</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;normpathx&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># : calls normapthx() on path-part</span>
    <span class="n">apppre</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">appsplit</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;appsplit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># : control application tuples, else ordinary path</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># : control raw</span>
    <span class="n">rpath</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rpath&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># : control RAW-PATH</span>
    <span class="n">rtype</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rtype&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># : control RAW-TYPE</span>
    <span class="n">strict</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># : validate and raise if not valid</span>

    <span class="c1"># platform path types</span>

    <span class="c1">#</span>
    <span class="c1"># the source platform - selects the type of the scanner - APPPATHSCANNER,</span>
    <span class="c1"># thus has to be defined here - independent from the actual input data</span>
    <span class="c1"># the inpur of platform independent types is handled correctly on each platform anyway, e.g. URI</span>
    <span class="n">spf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># : control input domain - has precedence for apppathx parser selection</span>
    <span class="n">ssep</span><span class="p">,</span> <span class="n">pathsep</span><span class="p">,</span> <span class="n">_spf</span><span class="p">,</span> <span class="n">_input</span> <span class="o">=</span> <span class="n">getspf</span><span class="p">(</span><span class="n">spf</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>
    <span class="n">pathsep</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pathsep&#39;</span><span class="p">,</span> <span class="n">pathsep</span><span class="p">)</span>  <span class="c1"># alter when provided</span>

    <span class="c1">#</span>
    <span class="c1"># the target platform - delayed for the default to keep the tpe of platform</span>


    <span class="n">_tpf_each</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#: set tpf for each in mixed search path</span>


    <span class="c1">#</span>
    <span class="c1"># set parser for apppathx - the pathsep is actually the only difference</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">pathsep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
        <span class="n">_appparser</span> <span class="o">=</span> <span class="n">APPPATHSCANNER_COL</span>

    <span class="k">elif</span> <span class="n">pathsep</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
        <span class="n">_appparser</span> <span class="o">=</span> <span class="n">APPPATHSCANNER_SEM</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># should never occur - for now going ahead...</span>
        <span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
            <span class="n">_appparser</span> <span class="o">=</span> <span class="n">APPPATHSCANNER_SEM</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_appparser</span> <span class="o">=</span> <span class="n">APPPATHSCANNER_COL</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># : collect result</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># : preserve for final analysis outside the loop</span>

    <span class="k">def</span> <span class="nf">getraw</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get raw string.</span>

<span class="sd">        Args:</span>
<span class="sd">            i: iterator</span>
<span class="sd">            g: current group</span>

<span class="sd">        Returns:</span>
<span class="sd">            (s,e): for sub string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get start string position without APP-PREFIX</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># get end string position</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">s</span><span class="p">,</span>
            <span class="n">e</span><span class="p">,</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="n">plst</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">plst</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_output</span> <span class="o">&amp;</span> <span class="n">RTE_POSIX</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">INVALIDCHARSPOSIX</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span>
                        <span class="sd">&quot;&quot;&quot;rte=%s - target-platform:RTE_POSIX(%s) - invalid tpf char(\\0) = &#39;%s&#39;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">num2rte</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RTE</span><span class="p">)),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">num2rte</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_output</span><span class="p">,</span> <span class="n">_output</span><span class="p">)),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                        <span class="p">)</span>
            <span class="k">elif</span> <span class="n">_output</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">INVALIDCHARSWIN</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span>
                        <span class="sd">&quot;&quot;&quot;rte=%s - target-platform:RTE_WIN32(%s) - invalid tpf char(:&lt;&gt;*?) = &#39;%s&#39;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">num2rte</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RTE</span><span class="p">)),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">num2rte</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_output</span><span class="p">,</span> <span class="n">_output</span><span class="p">)),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                        <span class="p">)</span>
            <span class="k">elif</span> <span class="n">_output</span> <span class="o">&amp;</span> <span class="n">RTE_GENERIC</span> <span class="ow">and</span> <span class="n">INVALIDCHARS</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;rte=%s - target-platform:RTE_GENERIC(%s) - invalid tpf char(:&lt;&gt;*?\\0) = &#39;%s&#39;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">num2rte</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RTE</span><span class="p">)),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">num2rte</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_output</span><span class="p">,</span> <span class="n">_output</span><span class="p">)),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                    <span class="p">)</span>

            <span class="c1"># else: let the OS decide...</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">spath</span><span class="p">:</span>  <span class="c1"># shortcut for empty _input - None and 0/length-string</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">appsplit</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">rtype</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rpath</span> <span class="ow">and</span> <span class="n">rtype</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)]</span>

    <span class="c1"># APPPATHSCANNER_COL APPPATHSCANNER_SEM</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_appparser</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">spath</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">APPPATHINDEX</span><span class="p">:</span>  <span class="c1"># do this for getting the syntax term</span>
            <span class="n">_cur</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># if there is a match at all</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">92</span><span class="p">:</span>  <span class="c1"># EMPTY: shortcut for empty group == empty path entry</span>
                <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>  <span class="c1"># raw prio higher</span>
                    <span class="n">_cur</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">rtype</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rpath</span> <span class="ow">and</span> <span class="n">rtype</span><span class="p">):</span>
                    <span class="n">_cur</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="c1"># elif rpath:</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_cur</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_cur</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>  <span class="c1"># 4:local file system / 0:uri or IEEE/UNC/SMB</span>
                <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                    <span class="c1"># _cur = (&#39;raw&#39;, &#39;&#39;, &#39;&#39;, pathvar[i.start(g):i.end(g + 3)])</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                <span class="n">spath</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">):</span><span class="n">i</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)]))</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">rtype</span> <span class="ow">and</span> <span class="n">rpath</span> <span class="ow">or</span> <span class="n">rtype</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">g</span> <span class="ow">is</span> <span class="mi">52</span><span class="p">:</span>
                        <span class="c1"># **uri**</span>

                        <span class="n">_cur</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)]</span>

                        <span class="c1">#check registered</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">_cur</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">APPTYPES_L2</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="c1"># non-registered</span>
                            <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;URI not supported: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)))</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_cur</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">3</span><span class="p">))</span>

                <span class="c1"># elif rpath:</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_cur</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)]</span>

                    <span class="k">if</span> <span class="n">g</span> <span class="ow">is</span> <span class="mi">36</span><span class="p">:</span>
                        <span class="c1"># **smb**</span>

                        <span class="n">_cur</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">APPTYPES_L2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">APPTYPES</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">g</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)])[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">elif</span> <span class="n">g</span> <span class="ow">is</span> <span class="mi">52</span><span class="p">:</span>
                        <span class="c1"># **uri**</span>

                        <span class="c1">#check registered</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">_cur</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">APPTYPES_L2</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="c1"># non-registered</span>
                            <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;URI not supported: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)))</span>

                        <span class="c1">#_cur[0] = re.sub(r&#39;:/*&#39;, &#39;&#39;, i.group(g))</span>

                        <span class="n">_cur</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># dummy-share for compatibility of path position, extends 1 field</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_cur</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">APPTYPES</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">g</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)]</span>

                    <span class="n">_cur</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_cur</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># 2:DOS-SC_DRIVE - only</span>
                <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                    <span class="c1"># _cur = (&#39;raw&#39;, &#39;&#39;, &#39;&#39;, pathvar[i.start(g):i.start(g + 3)])</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                <span class="n">spath</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">):</span><span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)]))</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">rtype</span> <span class="ow">and</span> <span class="n">rpath</span> <span class="ow">or</span> <span class="n">rtype</span><span class="p">:</span>
                    <span class="n">_cur</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">g</span> <span class="ow">is</span> <span class="mi">36</span><span class="p">:</span>
                        <span class="c1"># **smb**</span>
                        <span class="n">_a</span> <span class="o">=</span> <span class="n">APPTYPES_L2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">APPTYPES</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">g</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_a</span> <span class="o">=</span> <span class="n">APPTYPES</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">g</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)]</span>
                    <span class="n">_cur</span> <span class="o">=</span> <span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># here: 0,1,2,3 =&gt; empty group</span>
                <span class="n">_cur</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># should not occur, anyhow...</span>

            <span class="c1">#</span>
            <span class="c1"># post processing on prepared match - includes the processing of the path</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">_cur</span><span class="p">:</span>
                <span class="n">gsepback</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># look back</span>
                    <span class="n">gsepback</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">_input</span> <span class="o">&amp;</span> <span class="n">RTE_POSIX</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_input</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span> \
                        <span class="ow">and</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">76</span><span class="p">):</span>  <span class="c1"># DOSDRIVE</span>
                    <span class="c1"># Posix: ignore drives and uses &#39;colon&#39; as separator</span>

                    <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">_cur</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">_cur</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="k">elif</span> <span class="n">pathsep</span> <span class="o">==</span> <span class="s2">&quot;;&quot;</span><span class="p">:</span>
                        <span class="c1"># selected by option &#39;pathsep&#39;</span>
                        <span class="c1"># anyhow, posix does not know anything about drives</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">_cur</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">_cur</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># treat drive as path</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="c1"># treat path on drive still as path</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

                <span class="k">elif</span> <span class="n">_input</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">RTE_POSIX</span> <span class="o">|</span> <span class="n">RTE_WIN32</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">RTE_POSIX</span>
                                                          <span class="o">|</span> <span class="n">RTE_WIN32</span><span class="p">):</span>
                    <span class="c1"># both: Posix and Win, reserved sep and pathsep for both,</span>
                    <span class="c1"># app-tags are still valid</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_cur</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">_input</span> <span class="o">&amp;</span> <span class="n">RTE_GENERIC</span><span class="p">:</span>
                    <span class="c1"># simple character split, but keeps app-URIs</span>

                    <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">76</span><span class="p">):</span>  <span class="c1"># DOSDRIVE - ignores DOS drives</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">gsepback</span> <span class="ow">or</span> <span class="n">gsepback</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>  <span class="c1"># first or prefix-sep</span>
                            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>

                        <span class="k">elif</span> <span class="n">gsepback</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>  <span class="c1"># have s.th. to concat</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">gsepback</span> <span class="o">+</span> <span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

                        <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>
                            <span class="c1"># append path too</span>

                            <span class="c1"># TODO: speedup</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># treat path on drive still as path</span>
                            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_cur</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">gsepback</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">gsepback</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_cur</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">_cur</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;apppre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">apppre</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">gsepback</span> <span class="o">+</span> \
                                <span class="n">join_apppathx_entry</span><span class="p">(</span>
                                    <span class="n">_cur</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_cur</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>

                    <span class="c1">#</span>
                    <span class="c1"># the target platform - delayed for the default to keep the tpe of platform</span>
                    <span class="n">tpf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">tpf</span> <span class="ow">or</span> <span class="n">_tpf_each</span><span class="p">:</span>
                        <span class="n">_tpf_each</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="c1"># if none provided, just keep the final input platform</span>
                        <span class="n">tpf</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">r&#39;:.*$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">tsep</span><span class="p">,</span> <span class="n">tpsep</span><span class="p">,</span> <span class="n">_tpf</span><span class="p">,</span> <span class="n">_output</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">tpf</span><span class="p">,</span> <span class="n">apppre</span><span class="o">=</span><span class="n">apppre</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>
                    <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_output</span>

                    <span class="k">if</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">52</span><span class="p">:</span>
                        <span class="c1">#</span>
                        <span class="c1"># *** URI</span>
                        <span class="c1">#</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]):</span>
                            <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;requires absolute path, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>

                        <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;apppre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;keepsep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keepsep&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strip&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">normpathx</span><span class="p">(</span>
                                <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;escape&#39;</span><span class="p">):</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">escapepathx</span><span class="p">(</span>
                                <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unescape&#39;</span><span class="p">):</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">unescapepathx</span><span class="p">(</span>
                                <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>  <span class="c1"># validate</span>
                            <span class="c1"># app should be inherently by re</span>
                            <span class="n">_validate</span><span class="p">(</span><span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                            <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span>   <span class="c1">#: file-URI,</span>
                            <span class="p">):</span>
                        <span class="c1">#</span>
                        <span class="c1">#*** file-URI</span>
                        <span class="c1">#</span>

                        <span class="c1"># now correct the temporary spf assignment</span>
                        <span class="c1"># supports by default FILEURI5 and FILEURI,</span>
                        <span class="c1"># when required else the parameters &#39;spf&#39;</span>
                        <span class="c1"># and &#39;tpf&#39; has to be used</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                                <span class="n">spf</span> <span class="o">=</span> <span class="n">RTE_FILEURI5</span>
                                <span class="n">ssep</span><span class="p">,</span> <span class="n">pathsep</span><span class="p">,</span> <span class="n">_spf</span><span class="p">,</span> <span class="n">_input</span> <span class="o">=</span> <span class="n">getspf</span><span class="p">(</span><span class="n">spf</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">spf</span> <span class="o">=</span> <span class="n">RTE_FILEURI</span>
                                <span class="n">ssep</span><span class="p">,</span> <span class="n">pathsep</span><span class="p">,</span> <span class="n">_spf</span><span class="p">,</span> <span class="n">_input</span> <span class="o">=</span> <span class="n">getspf</span><span class="p">(</span><span class="n">spf</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>

                        <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">):</span>
                            <span class="c1"># create applicationscheme, thus uri with shlashes only</span>
                            <span class="n">_tpf_old</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">_output</span> <span class="o">&amp;</span> <span class="n">RTE_URI</span><span class="p">:</span>
                                <span class="c1"># concrete type of file-uri</span>
                                <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_output</span>
                                <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;apppre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># generic standard URI</span>
                                <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RTE_URI</span>
                                <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;apppre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="k">elif</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">):</span>
                            <span class="c1"># a tpf provided</span>
                            <span class="n">_tpf_old</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">pass</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># no tpf provided</span>
                            <span class="n">_tpf_old</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RTE</span>

                        <span class="k">if</span> <span class="n">_normpathx</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span>
                                    <span class="s1">&#39;//&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span>
                                <span class="n">_np</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">_np</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">_np</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;escape&#39;</span><span class="p">):</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                       <span class="n">escapepathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">))</span>
                        <span class="k">elif</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unescape&#39;</span><span class="p">):</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                       <span class="n">unescapepathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">))</span>

                        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>  <span class="c1"># validate</span>
                            <span class="c1"># app should be inherently by re</span>
                            <span class="n">_validate</span><span class="p">(</span><span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">_tpf_old</span><span class="p">:</span>
                            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tpf_old</span>

                    <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                            <span class="mi">36</span><span class="p">,</span>              <span class="c1">#: TODO: implement complete spec. SMB/CIFS</span>
                            <span class="p">):</span>
                        <span class="c1">#</span>
                        <span class="c1">#*** file-URI, SMB/CIFS</span>
                        <span class="c1">#</span>
                        <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">):</span>
                            <span class="c1"># create applicationscheme, thus uri with shlashes only</span>
                            <span class="n">_tpf_old</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">)</span>
                            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uri&#39;</span>
                            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;apppre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                        <span class="k">elif</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">):</span>
                            <span class="c1"># a tpf provided</span>
                            <span class="n">_tpf_old</span> <span class="o">=</span> <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span>
                            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uri&#39;</span>
                            <span class="k">pass</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># no tpf provided</span>
                            <span class="n">_tpf_old</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RTE</span>

                        <span class="k">if</span> <span class="n">_normpathx</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span>
                                    <span class="s1">&#39;//&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span>
                                <span class="n">_np</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">_np</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">_np</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;escape&#39;</span><span class="p">):</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                       <span class="n">escapepathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">))</span>
                        <span class="k">elif</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unescape&#39;</span><span class="p">):</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                       <span class="n">unescapepathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">))</span>

                        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>  <span class="c1"># validate</span>
                            <span class="c1"># app should be inherently by re</span>
                            <span class="n">_validate</span><span class="p">(</span><span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">_tpf_old</span><span class="p">:</span>
                            <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tpf_old</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">_normpathx</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span>
                                    <span class="s1">&#39;//&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span>
                                <span class="c1"># network share UNC/POSIX-app</span>
                                <span class="n">_np</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># source is ordinary local file</span>
                                <span class="n">_np</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

                            <span class="c1"># simpler than genric check and query for drive+path</span>
                            <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_CNW</span><span class="p">,</span> <span class="n">RTE_CNP</span><span class="p">,</span> <span class="n">RTE_LOCAL</span><span class="p">)</span>
                                    <span class="ow">and</span> <span class="n">_np</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span>
                                    <span class="ow">and</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                                <span class="p">):</span>
                                <span class="n">_np</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">_np</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;escape&#39;</span><span class="p">):</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                       <span class="n">escapepathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">))</span>
                        <span class="k">elif</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unescape&#39;</span><span class="p">):</span>
                            <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                       <span class="n">unescapepathx</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">))</span>

                        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>  <span class="c1"># validate</span>
                            <span class="c1"># app should be inherently by re</span>
                            <span class="n">_validate</span><span class="p">(</span><span class="n">_cur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">break</span>

        <span class="k">if</span> <span class="n">apppre</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="s2">&quot;requires absolute path, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">_delnulpsep</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">ret</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="k">break</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="c1">#* the case empty group regexpr at the end of the search path else complicates the regexpr at all</span>
    <span class="c1"># empty group at the end of string</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_delnulpsep</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">i</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">rtype</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lfsys&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_tpf_each</span><span class="p">:</span>
        <span class="n">_tpfin</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_tpfin</span><span class="p">:</span>
            <span class="n">tsep</span><span class="p">,</span> <span class="n">tpsep</span><span class="p">,</span> <span class="n">_tpf</span><span class="p">,</span> <span class="n">_output</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">_tpfin</span><span class="p">,</span> <span class="n">apppre</span><span class="o">=</span><span class="n">apppre</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">appsplit</span><span class="p">:</span>  <span class="c1"># ordinary pathsplit</span>
        <span class="n">_ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="n">_ret</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ret</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># expects &#39;rtype&#39;, and valid entries</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;requires absolute path, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

                <span class="k">if</span> <span class="n">_tpf_each</span><span class="p">:</span>
                    <span class="n">tsep</span><span class="p">,</span> <span class="n">tpsep</span><span class="p">,</span> <span class="n">_tpf</span><span class="p">,</span> <span class="n">_output</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">apppre</span><span class="o">=</span><span class="n">apppre</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>
                <span class="n">_ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">join_apppathx_entry</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_output</span><span class="p">,</span> <span class="n">apppre</span><span class="o">=</span><span class="n">apppre</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_ret</span>

    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="splitapppathx_getlocalpath"><a class="viewcode-back" href="../../apppaths.html#filesysobjects.apppaths.splitapppathx_getlocalpath">[docs]</a><span class="k">def</span> <span class="nf">splitapppathx_getlocalpath</span><span class="p">(</span><span class="n">elems</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Joins application elements to a path for local access.</span>

<span class="sd">    Args:</span>
<span class="sd">        **elems**:</span>
<span class="sd">            Elements as provided by &#39;splitapppathx&#39;</span>

<span class="sd">        kargs:</span>
<span class="sd">            **tpf**:</span>
<span class="sd">                Target platform for the file pathname, for details refer to</span>
<span class="sd">                :ref:`normpathx() &lt;def_normpathx&gt;`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        When successful the local access path, else None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AppPathError</span>
<span class="sd">        passed through exceptions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_tpf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_tpf</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s1">&#39;Windows&#39;</span><span class="p">,</span>
            <span class="s1">&#39;win&#39;</span><span class="p">,</span> <span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
    <span class="k">elif</span> <span class="n">_tpf</span> <span class="o">==</span> <span class="s1">&#39;posix&#39;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">elems</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">elems</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="nb">tuple</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">,</span> <span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">elems</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s1">&#39;Incompatible input:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">elems</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">elems</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elems</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span> <span class="ow">and</span> <span class="n">elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;smb&#39;</span><span class="p">,</span> <span class="s1">&#39;share&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Missing share name for start=&quot;</span> <span class="o">+</span>
                                       <span class="nb">str</span><span class="p">(</span><span class="n">elems</span><span class="p">))</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">elems</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">elems</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">elems</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">elems</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">elems</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">elems</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">elems</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">elems</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">elems</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="n">elems</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">elems</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">elems</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">elems</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="n">elems</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="gettop_from_pathstring"><a class="viewcode-back" href="../../apppaths.html#filesysobjects.apppaths.gettop_from_pathstring">[docs]</a><span class="k">def</span> <span class="nf">gettop_from_pathstring</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Searches for a partial path *spath* in a list of</span>
<span class="sd">    search paths *plist*. The current version supports for</span>
<span class="sd">    pure in-memory evaluation of literals and regexpr.</span>

<span class="sd">    The following example of input with default parameters ::</span>

<span class="sd">       spath := &#39;a/b/c&#39;</span>
<span class="sd">       plist := [</span>
<span class="sd">          &#39;/my/path/a/c/x/y/a/b/x/d/e/r&#39;,</span>
<span class="sd">          &#39;/my/path/a/c/x/y/a/b/c/d/e/r&#39;,</span>
<span class="sd">       ]</span>

<span class="sd">    results in the first match: ::</span>

<span class="sd">       result := &#39;/my/path/a/c/x/y/a/b/c&#39;</span>
<span class="sd">       #</span>
<span class="sd">       # shortes top-match: &#39;/my/path/a/c/x/y/&#39; + &#39;a/b/c&#39;</span>
<span class="sd">       #</span>

<span class="sd">    Same for a regular expression: ::</span>

<span class="sd">       spath := &#39;a/.*/[cxy]/[def]{1}&#39;</span>

<span class="sd">    results again in: ::</span>

<span class="sd">       result := &#39;/my/path/a/c/x/y/a/b/c&#39;</span>

<span class="sd">    The match is performed by the re module based on *re.split*</span>
<span class="sd">    spanning multiple directories in case of reguar expressions.</span>
<span class="sd">    Thus the expressions require some caution when constraints</span>
<span class="sd">    are required. The function itself serves as a framework</span>
<span class="sd">    providing parameterization of the match criteria.</span>

<span class="sd">    Args:</span>
<span class="sd">        **spath**:</span>
<span class="sd">            A path to be appended to an item from &#39;plist&#39;.</span>

<span class="sd">        **plist**:</span>
<span class="sd">            List of search strings to be extended</span>
<span class="sd">            by the subpath *spath*.</span>

<span class="sd">            default := sys.path</span>

<span class="sd">        kargs:</span>
<span class="sd">            **hook**:</span>
<span class="sd">                Returns the insertion point of *spath* without</span>
<span class="sd">                the *spath* itself.</span>

<span class="sd">            **keepsep**:</span>
<span class="sd">                Keeps significant separators, e.g. a trailing &#39;os.sep&#39;.</span>

<span class="sd">                default := True</span>

<span class="sd">            **matchidx**:</span>
<span class="sd">                Use the n-th match of the resulting path component only.</span>
<span class="sd">                The path component excludes the authority and share for</span>
<span class="sd">                network paths. ::</span>

<span class="sd">                   matchidx := #idx:</span>

<span class="sd">                   0 &lt;= idx   ; first match</span>

<span class="sd">                * Ignore matches for &#39;*&lt; #idx*&#39;</span>
<span class="sd">                * return match for &#39;*== #idx*&#39;, and stop search</span>

<span class="sd">                default := 0 # first match</span>

<span class="sd">                Depends on *reverse*.</span>

<span class="sd">            **pathsep**:</span>
<span class="sd">                Replaces the path separator set by the *spf*. ::</span>

<span class="sd">                    pathsep := (&#39;;&#39; | &#39;:&#39;)</span>

<span class="sd">            **pattern**:</span>
<span class="sd">                Sets and activates scope and type of match pattern.</span>
<span class="sd">                The pattern is matched node-by-node for each</span>
<span class="sd">                corresponding directory level: ::</span>

<span class="sd">                   pattern := (literal | regexpr)</span>

<span class="sd">                * *literal*:</span>

<span class="sd">                  Match literally. Pattern are treated as characters.</span>

<span class="sd">                * *regexpr*:</span>

<span class="sd">                  Match regular expression for individual nodes,</span>
<span class="sd">                  implies no contained reserved characters of the</span>
<span class="sd">                  current file system, so &#39;os.sep&#39; and no &#39;os.pathsep&#39;.</span>

<span class="sd">                default := literal</span>

<span class="sd">            **raw**:</span>
<span class="sd">                Suppress normalization by call of</span>
<span class="sd">                &#39;os.path.normpath&#39;.</span>

<span class="sd">            **reverse**:</span>
<span class="sd">                This reverses the resulting search order</span>
<span class="sd">                from bottom-up to top-down. Takes effect on</span>
<span class="sd">                &#39;redundant&#39; only.</span>

<span class="sd">            **split**:</span>
<span class="sd">                Returns the path prefix matched on the search list,</span>
<span class="sd">                and the relative sub path outside the search list</span>
<span class="sd">                as a tuple. ::</span>

<span class="sd">                   split := (True | False)</span>

<span class="sd">                For example the input: ::</span>

<span class="sd">                   spath := &#39;a/b/c&#39;</span>
<span class="sd">                   plist := [</span>
<span class="sd">                      &#39;/my/path/a/c/x/y/a/b/x/d/e/r&#39;,</span>
<span class="sd">                      &#39;/my/path/a/c/x/y/a/b/c/d/e/r&#39;,</span>
<span class="sd">                   ]</span>

<span class="sd">                results in: ::</span>

<span class="sd">                   result := (&#39;/my/path/a/c/x/y&#39;, &#39;a/b/c&#39;)</span>

<span class="sd">            **spf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">            **strip**:</span>
<span class="sd">                Strips null-entries.</span>

<span class="sd">                default := True</span>

<span class="sd">            **tpf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to the API in the manual at :ref:`tpf &lt;OPTS_TPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.gettpf() &lt;paths.html#gettpf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>


<span class="sd">    Returns:</span>
<span class="sd">        When successful returns by default the expanded pathname, else None.</span>
<span class="sd">        The return value in case of success depends on the parameters:</span>

<span class="sd">        * if *split == True*: returns a *tuple* ::</span>

<span class="sd">             result = (result[0], result[1],)</span>

<span class="sd">          result[0]: The matched path including the resolved searched sub-path *spath*.</span>

<span class="sd">          result[1]: The remainder.</span>

<span class="sd">        * if *split == True* and *hook == True*: returns a *tuple* ::</span>

<span class="sd">             result = (result[0], result[1], result[2],)</span>

<span class="sd">          result[0]: The matched path excluding the sub-path *spath*.</span>

<span class="sd">          result[1]: The resolved searched sub-path *spath*.</span>

<span class="sd">          result[2]: The remainder.</span>

<span class="sd">        * else: returns an *str* ::</span>

<span class="sd">             result = &lt;str&gt;</span>

<span class="sd">          * if *hook == True*:</span>

<span class="sd">            The matched path excluding the sub-path *spath* and an</span>
<span class="sd">            evtl. present remainder.</span>

<span class="sd">          * else:</span>

<span class="sd">            A string of the matched path including the resolved</span>
<span class="sd">            searched sub-path *spath*, excluding an evtl. present</span>
<span class="sd">            remainder.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AppPathError</span>

<span class="sd">        FileSysObjectsError</span>

<span class="sd">        passed-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">plist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Requires list argument:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">plist</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">_hook</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hook&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_hook</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_rev</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_rev</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_split</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_split</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_strip</span> <span class="o">=</span> <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;strip&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_strip</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">matchidx</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;matchidx&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">matchidx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">or</span> <span class="n">matchidx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Requires int&gt;0 matchidx=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matchidx</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">matchidx</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">_pat</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pattern&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_pat</span> <span class="o">==</span> <span class="s1">&#39;regexpr&#39;</span><span class="p">:</span>
            <span class="n">_pat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1">#</span>
        <span class="c1"># reminder: glob not supported for current release, requires an offline interpreter</span>
        <span class="c1"># elif v == &#39;glob&#39;:</span>
        <span class="c1">#     _pat = 2</span>
        <span class="k">elif</span> <span class="n">_pat</span> <span class="o">==</span> <span class="s1">&#39;literal&#39;</span><span class="p">:</span>
            <span class="n">_pat</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;gettop_from_pathstring:parameter not supported: pattern = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_pat</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_pat</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">raw</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_keepsep</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keepsep&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># get spf</span>
    <span class="c1">#</span>
    <span class="n">_spf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">ssep</span><span class="p">,</span> <span class="n">spsep</span><span class="p">,</span> <span class="n">_spf</span><span class="p">,</span> <span class="n">_input</span> <span class="o">=</span> <span class="n">getspf</span><span class="p">(</span><span class="n">_spf</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>
    <span class="c1"># pathsep = kargs.get(&#39;pathsep&#39;, spsep)</span>

    <span class="c1">#</span>
    <span class="c1"># get tpf</span>
    <span class="c1">#</span>
    <span class="n">_tpf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">tsep</span><span class="p">,</span> <span class="n">tpsep</span><span class="p">,</span> <span class="n">_tpf</span><span class="p">,</span> <span class="n">_output</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">_tpf</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>


    <span class="k">def</span> <span class="nf">_comp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;match regexpr</span>
<span class="sd">        p: regexpr</span>
<span class="sd">        b: item plist[i][j]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_pat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># regexpr</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>  <span class="c1"># assume a glob expression, thus terminate &#39;re&#39; processing now</span>
                <span class="k">return</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;^&#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">r&#39;$&#39;</span><span class="p">)</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">px</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">px</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">px</span><span class="o">.</span><span class="n">start</span><span class="p">():</span><span class="n">px</span><span class="o">.</span><span class="n">end</span><span class="p">()]</span>

        <span class="k">elif</span> <span class="n">_pat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># literal</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">b</span>

    <span class="c1"># define processed portion, save prefix for later prepend on result</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
        <span class="c1"># For *spath*, is relative thus cannot be http/https</span>
        <span class="c1">#</span>
        <span class="c1">#   _rtype   type</span>
        <span class="c1">#   _host:   host</span>
        <span class="c1">#   _share:  share</span>
        <span class="c1">#   sp:      local path</span>
        <span class="c1">#</span>
        <span class="n">_rtype</span><span class="p">,</span> <span class="n">_host</span><span class="p">,</span> <span class="n">_share</span><span class="p">,</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span>
            <span class="n">spath</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">_spf</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">,</span> <span class="n">rtype</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">keepsep</span><span class="o">=</span><span class="n">_keepsep</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="n">_strip</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">_app_prefix</span> <span class="o">=</span> <span class="n">_rtype</span> <span class="o">+</span> <span class="n">_host</span>
        <span class="k">if</span> <span class="n">_share</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_app_prefix</span><span class="p">:</span>
                <span class="n">_app_prefix</span> <span class="o">+=</span> <span class="n">ssep</span> <span class="o">+</span> <span class="n">_share</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_app_prefix</span> <span class="o">=</span> <span class="n">_share</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">_app_prefix</span><span class="p">,</span> <span class="n">sp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">spath</span>

    <span class="c1"># normalize search path</span>
    <span class="c1">#</span>
    <span class="c1"># For *spath*</span>
    <span class="c1">#</span>
    <span class="c1">#   _sp_elems[0]   type</span>
    <span class="c1">#   _sp_elems[1]:  host</span>
    <span class="c1">#   _sp_elems[2]:  share</span>
    <span class="c1">#   _sp_elems[3]:  local path</span>
    <span class="c1">#</span>
    <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;keepsep&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">_keepsep</span>
    <span class="n">_sp_elems</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">splitapppathx_getlocalpath</span><span class="p">(</span><span class="n">_sp_elems</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">)</span>
    <span class="n">sp_tmp</span> <span class="o">=</span> <span class="n">sp</span>


    <span class="n">sp</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ssep</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sp</span> <span class="ow">and</span> <span class="n">sp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># TODO:</span>
    <span class="k">if</span> <span class="n">sp</span> <span class="ow">and</span> <span class="n">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># is @root</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">_contained</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>  <span class="c1"># initially check anchor</span>
                <span class="n">_cxe</span> <span class="o">=</span> <span class="n">splitapppathx_getlocalpath</span><span class="p">(</span><span class="n">_sp_elems</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_cxe</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ssep</span> <span class="o">+</span> <span class="n">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">_contained</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_contained</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">_maxmatch</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># the maximum length of match that actually occured</span>
    <span class="n">_currentmatch</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># stack of current last list</span>

    <span class="n">si0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">_rev</span><span class="p">:</span>
        <span class="n">_pl</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">plist</span><span class="p">[:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_pl</span> <span class="o">=</span> <span class="n">plist</span>

    <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> <span class="n">_pl</span><span class="p">:</span>
        <span class="c1"># scan each path of pathlist(plist) for sp(spath) item-by-item</span>
        <span class="n">si0</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">_matchidx</span> <span class="o">=</span> <span class="n">matchidx</span>  <span class="c1"># count the present matches for each search path from plist</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sl</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># prepare prefix - host and/or share</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>  <span class="c1"># canonical</span>
            <span class="c1"># manage app paths - current network only</span>
            <span class="n">_elements</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span>
                <span class="n">sl</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">_spf</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">,</span> <span class="n">rtype</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_prtype</span><span class="p">,</span> <span class="n">_phost</span><span class="p">,</span> <span class="n">_pshare</span><span class="p">,</span> <span class="n">sl</span><span class="p">,</span> <span class="n">_qufrag</span> <span class="o">=</span> <span class="n">_elements</span>  <span class="c1"># for http/https</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">_prtype</span><span class="p">,</span> <span class="n">_phost</span><span class="p">,</span> <span class="n">_pshare</span><span class="p">,</span> <span class="n">sl</span> <span class="o">=</span> <span class="n">_elements</span>  <span class="c1"># for file systems</span>

            <span class="n">_prefix</span> <span class="o">=</span> <span class="n">_prtype</span> <span class="o">+</span> <span class="n">_phost</span>

            <span class="k">if</span> <span class="n">_pshare</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_prefix</span><span class="p">:</span>
                    <span class="n">_prefix</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">_pshare</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_prefix</span> <span class="o">=</span> <span class="n">_pshare</span>

            <span class="k">if</span> <span class="n">_app_prefix</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_app_prefix</span> <span class="o">!=</span> <span class="n">_prefix</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># apply a regexpr pattern as splitter</span>
        <span class="n">_prefix</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">_prefix</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sl_esc</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># the pattern needs twice</span>
        <span class="n">regpattern</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">sp_tmp</span><span class="p">,</span> <span class="n">_spf</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">regpattern</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">regpattern</span><span class="p">,</span> <span class="n">_spf</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">regpattern</span><span class="p">,</span> <span class="n">sl_esc</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">matchidx</span><span class="p">:</span>
            <span class="c1"># no match</span>
            <span class="k">continue</span>

        <span class="c1"># length of resulting top-pattern</span>
        <span class="n">lx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sl_esc</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># the resolved re</span>
        <span class="n">sp_resolved</span> <span class="o">=</span> <span class="n">sl_esc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">lx</span><span class="p">]</span>

        <span class="c1"># prepare join</span>
        <span class="k">if</span> <span class="n">sp_resolved</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">_r</span> <span class="o">=</span> <span class="n">_prefix</span>

        <span class="c1"># join as much as requested by matchidx, else the topmost only</span>
        <span class="k">if</span> <span class="n">_rev</span><span class="p">:</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="n">matchidx</span> <span class="c1">#- (s[-1] == &#39;&#39;)</span>
            <span class="k">if</span> <span class="n">lx</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">lx</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">_j</span> <span class="o">=</span> <span class="n">sp_resolved</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">lx</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">matchidx</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">matchidx</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;out of valid range: matchidx = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matchidx</span><span class="p">))</span>
                <span class="c1"># return None</span>

            <span class="k">if</span> <span class="n">matchidx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="c1"># the full string</span>
                <span class="n">lx</span> <span class="o">=</span> <span class="n">matchidx</span> <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># proceed as eventually expected</span>
                <span class="n">lx</span> <span class="o">=</span> <span class="n">matchidx</span>

            <span class="k">if</span> <span class="n">lx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># simply the first</span>
                <span class="n">_j</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># join the resolved re-split-pattern</span>
                <span class="n">_j</span> <span class="o">=</span> <span class="n">sp_resolved</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">lx</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_hook</span><span class="p">:</span>
            <span class="n">_j</span> <span class="o">+=</span> <span class="n">sp_resolved</span>

        <span class="n">remainder</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">_split</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_rev</span><span class="p">:</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="n">sp_resolved</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="n">matchidx</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="n">sp_resolved</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">matchidx</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">remainder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="n">remainder</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">remainder</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="n">remainder</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">_j</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_r</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;file:&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">sl</span><span class="p">):</span>
                    <span class="c1"># RFC 8089</span>
                    <span class="c1"># add prefix and absolute path</span>
                    <span class="n">_r</span> <span class="o">+=</span> <span class="n">_j</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;RFC8089 Requires absolute path, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sl</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">_r</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http:&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">sl</span><span class="p">):</span>
                    <span class="c1"># RFC 3986</span>
                    <span class="c1"># add prefix and absolute path</span>
                    <span class="n">_r</span> <span class="o">+=</span> <span class="n">_j</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;RFC3986 Requires absolute path, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sl</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">_sp_elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;lfsys&#39;</span><span class="p">:</span>
                <span class="n">join_apppathx_entry</span><span class="p">((</span><span class="n">_prtype</span><span class="p">,</span> <span class="n">_phost</span><span class="p">,</span> <span class="n">_pshare</span><span class="p">,</span> <span class="n">sl</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">_r</span> <span class="o">+=</span> <span class="n">_j</span>

        <span class="k">if</span> <span class="n">_r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">_r</span> <span class="o">=</span> <span class="n">_r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">_r</span> <span class="o">=</span> <span class="n">unescapepathx</span><span class="p">(</span><span class="n">_r</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_split</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_r</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_hook</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">_r</span><span class="p">,</span> <span class="n">sp_resolved</span><span class="p">,</span> <span class="n">remainder</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">_r</span><span class="p">,</span> <span class="n">remainder</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span></div>

<span class="k">def</span> <span class="nf">gettop_from_pathstring_partial_old</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Searches for a partial path *spath* in a list of</span>
<span class="sd">    search paths *plist*. The current version supports for</span>
<span class="sd">    pure in-memory evaluation of literals and regexpr.</span>

<span class="sd">    The following example of input with default parameters ::</span>

<span class="sd">       spath := &#39;a/b/c&#39;</span>
<span class="sd">       plist := [</span>
<span class="sd">          &#39;/my/path/a/c/x/y/a/b/x/d/e/r&#39;,</span>
<span class="sd">          &#39;/my/path/a/c/x/y/a/b/c/d/e/r&#39;,</span>
<span class="sd">       ]</span>

<span class="sd">    results in the first match: ::</span>

<span class="sd">       result := &#39;/my/path/a/c/x/y/a/b/c&#39;</span>
<span class="sd">       #</span>
<span class="sd">       # shortes top-match: &#39;/my/path/a/c/x/y/&#39; + &#39;a/b/c&#39;</span>
<span class="sd">       #</span>

<span class="sd">    Same for a regular expression: ::</span>

<span class="sd">       spath := &#39;a/.*/[cxy]/[def]{1}&#39;</span>

<span class="sd">    results again in: ::</span>

<span class="sd">       result := &#39;/my/path/a/c/x/y/a/b/c&#39;</span>

<span class="sd">    The match is performed by the re module based on *re.split*</span>
<span class="sd">    spanning multiple directories in case of reguar expressions.</span>
<span class="sd">    Thus the expressions require some caution when constraints</span>
<span class="sd">    are required. The function itself serves as a framework</span>
<span class="sd">    providing parameterization of the match criteria.</span>

<span class="sd">    Args:</span>
<span class="sd">        **spath**:</span>
<span class="sd">            A path to be appended to an item from &#39;plist&#39;.</span>

<span class="sd">        **plist**:</span>
<span class="sd">            List of search strings to be extended</span>
<span class="sd">            by the subpath *spath*.</span>

<span class="sd">            default := sys.path</span>

<span class="sd">        kargs:</span>
<span class="sd">            **hook**:</span>
<span class="sd">                Returns the insertion point of *spath* without</span>
<span class="sd">                the *spath* itself.</span>

<span class="sd">            **keepsep**:</span>
<span class="sd">                Keeps significant separators, e.g. a trailing &#39;os.sep&#39;.</span>

<span class="sd">                default := True</span>

<span class="sd">            **matchidx**:</span>
<span class="sd">                Use the n-th match only. ::</span>

<span class="sd">                   matchidx := #idx:</span>

<span class="sd">                   0 &lt;= idx   ; first match</span>

<span class="sd">                * Ignore matches for &#39;*&lt; #idx*&#39;</span>
<span class="sd">                * return match for &#39;*== #idx*&#39;, and stop search</span>

<span class="sd">                default := 0 # first match</span>

<span class="sd">                Depends on *reverse*.</span>

<span class="sd">            **pathsep**:</span>
<span class="sd">                Replaces the path separator set by the *spf*. ::</span>

<span class="sd">                    pathsep := (&#39;;&#39; | &#39;:&#39;)</span>

<span class="sd">            **pattern**:</span>
<span class="sd">                Sets and activates scope and type of match pattern.</span>
<span class="sd">                The pattern is matched node-by-node for each</span>
<span class="sd">                corresponding directory level: ::</span>

<span class="sd">                   pattern := (literal | regexpr)</span>

<span class="sd">                * *literal*:</span>

<span class="sd">                  Match literally. Pattern are treated as characters.</span>

<span class="sd">                * *regexpr*:</span>

<span class="sd">                  Match regular expression for individual nodes,</span>
<span class="sd">                  implies no contained reserved characters of the</span>
<span class="sd">                  current file system, so &#39;os.sep&#39; and no &#39;os.pathsep&#39;.</span>

<span class="sd">                default := literal</span>

<span class="sd">            **raw**:</span>
<span class="sd">                Suppress normalization by call of</span>
<span class="sd">                &#39;os.path.normpath&#39;.</span>

<span class="sd">            **reverse**:</span>
<span class="sd">                This reverses the resulting search order</span>
<span class="sd">                from bottom-up to top-down. Takes effect on</span>
<span class="sd">                &#39;redundant&#39; only.</span>

<span class="sd">            **split**:</span>
<span class="sd">                Returns the path prefix matched on the search list,</span>
<span class="sd">                and the relative sub path outside the search list</span>
<span class="sd">                as a tuple. ::</span>

<span class="sd">                   split := (True | False)</span>

<span class="sd">                For example the input: ::</span>

<span class="sd">                   spath := &#39;a/b/c&#39;</span>
<span class="sd">                   plist := [</span>
<span class="sd">                      &#39;/my/path/a/c/x/y/a/b/x/d/e/r&#39;,</span>
<span class="sd">                      &#39;/my/path/a/c/x/y/a/b/c/d/e/r&#39;,</span>
<span class="sd">                   ]</span>

<span class="sd">                results in: ::</span>

<span class="sd">                   result := (&#39;/my/path/a/c/x/y&#39;, &#39;a/b/c&#39;)</span>

<span class="sd">            **spf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">            **strip***:</span>
<span class="sd">                Strips null-entries.</span>

<span class="sd">                default := True</span>

<span class="sd">            **tpf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to the API in the manual at :ref:`tpf &lt;OPTS_TPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.gettpf() &lt;paths.html#gettpf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>


<span class="sd">    Returns:</span>
<span class="sd">        When successful returns by default the expanded pathname, else None.</span>
<span class="sd">        The return value in case of success depends on the parameters:</span>

<span class="sd">        * if *split == True*: returns a *tuple* ::</span>

<span class="sd">             result = (result[0], result[1],)</span>

<span class="sd">          result[0]: The matched path including the resolved searched sub-path *spath*.</span>

<span class="sd">          result[1]: The remainder.</span>

<span class="sd">        * if *split == True* and *hook == True*: returns a *tuple* ::</span>

<span class="sd">             result = (result[0], result[1], result[2],)</span>

<span class="sd">          result[0]: The matched path excluding the sub-path *spath*.</span>

<span class="sd">          result[1]: The resolved searched sub-path *spath*.</span>

<span class="sd">          result[2]: The remainder.</span>

<span class="sd">        * else: returns an *str* ::</span>

<span class="sd">             result = &lt;str&gt;</span>

<span class="sd">          * if *hook == True*:</span>

<span class="sd">            The matched path excluding the sub-path *spath* and an</span>
<span class="sd">            evtl. present remainder.</span>

<span class="sd">          * else:</span>

<span class="sd">            A string of the matched path including the resolved</span>
<span class="sd">            searched sub-path *spath*, excluding an evtl. present</span>
<span class="sd">            remainder.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AppPathError</span>

<span class="sd">        passed-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">plist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Requires list argument:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">plist</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">_hook</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hook&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_hook</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_rev</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_rev</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_split</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_split</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_strip</span> <span class="o">=</span> <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;strip&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_strip</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">matchidx</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;matchidx&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">matchidx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">or</span> <span class="n">matchidx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AppPathError</span><span class="p">(</span><span class="s2">&quot;Requires int&gt;0 matchidx=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matchidx</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">matchidx</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">_pat</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pattern&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_pat</span> <span class="o">==</span> <span class="s1">&#39;regexpr&#39;</span><span class="p">:</span>
            <span class="n">_pat</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1">#</span>
        <span class="c1"># reminder: glob not supported for current release, requires an offline interpreter</span>
        <span class="c1"># elif v == &#39;glob&#39;:</span>
        <span class="c1">#     _pat = 2</span>
        <span class="k">elif</span> <span class="n">_pat</span> <span class="o">==</span> <span class="s1">&#39;literal&#39;</span><span class="p">:</span>
            <span class="n">_pat</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;gettop_from_pathstring:parameter not supported: pattern = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_pat</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_pat</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">raw</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_keepsep</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keepsep&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># get spf</span>
    <span class="c1">#</span>
    <span class="n">_spf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">ssep</span><span class="p">,</span> <span class="n">spsep</span><span class="p">,</span> <span class="n">_spf</span><span class="p">,</span> <span class="n">_input</span> <span class="o">=</span> <span class="n">getspf</span><span class="p">(</span><span class="n">_spf</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>
    <span class="n">pathsep</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pathsep&#39;</span><span class="p">,</span> <span class="n">spsep</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># get tpf</span>
    <span class="c1">#</span>
    <span class="n">_tpf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">tsep</span><span class="p">,</span> <span class="n">tpsep</span><span class="p">,</span> <span class="n">_tpf</span><span class="p">,</span> <span class="n">_output</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">_tpf</span><span class="p">)</span>  <span class="c1"># @UnusedVariable</span>


    <span class="k">def</span> <span class="nf">_comp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;match regexpr</span>
<span class="sd">        p: regexpr</span>
<span class="sd">        b: item plist[i][j]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_pat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># regexpr</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>  <span class="c1"># assume a glob expression, thus terminate &#39;re&#39; processing now</span>
                <span class="k">return</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;^&#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">r&#39;$&#39;</span><span class="p">)</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">px</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">px</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">px</span><span class="o">.</span><span class="n">start</span><span class="p">():</span><span class="n">px</span><span class="o">.</span><span class="n">end</span><span class="p">()]</span>

        <span class="k">elif</span> <span class="n">_pat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># literal</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">b</span>

    <span class="c1"># define processed portion, save prefix for later prepend on result</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
        <span class="c1"># For *spath*, is relative thus cannot be http/https</span>
        <span class="c1">#</span>
        <span class="c1">#   _rtype   type</span>
        <span class="c1">#   _host:   host</span>
        <span class="c1">#   _share:  share</span>
        <span class="c1">#   sp:      local path</span>
        <span class="c1">#</span>
        <span class="n">_rtype</span><span class="p">,</span> <span class="n">_host</span><span class="p">,</span> <span class="n">_share</span><span class="p">,</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span>
            <span class="n">spath</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">_spf</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">,</span> <span class="n">rtype</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">keepsep</span><span class="o">=</span><span class="n">_keepsep</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="n">_strip</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">_app_prefix</span> <span class="o">=</span> <span class="n">_rtype</span> <span class="o">+</span> <span class="n">_host</span>
        <span class="k">if</span> <span class="n">_share</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_app_prefix</span><span class="p">:</span>
                <span class="n">_app_prefix</span> <span class="o">+=</span> <span class="n">ssep</span> <span class="o">+</span> <span class="n">_share</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_app_prefix</span> <span class="o">=</span> <span class="n">_share</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">_app_prefix</span><span class="p">,</span> <span class="n">sp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">spath</span>

    <span class="c1"># normalize search path</span>
    <span class="c1">#</span>
    <span class="c1"># For *spath*</span>
    <span class="c1">#</span>
    <span class="c1">#   _sp_elems[0]   type</span>
    <span class="c1">#   _sp_elems[1]:  host</span>
    <span class="c1">#   _sp_elems[2]:  share</span>
    <span class="c1">#   _sp_elems[3]:  local path</span>
    <span class="c1">#</span>
    <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;keepsep&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">_keepsep</span>
    <span class="n">_sp_elems</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">splitapppathx_getlocalpath</span><span class="p">(</span><span class="n">_sp_elems</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">)</span>
    <span class="n">sp_tmp</span> <span class="o">=</span> <span class="n">sp</span>


    <span class="n">sp</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ssep</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sp</span> <span class="ow">and</span> <span class="n">sp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">sp</span> <span class="ow">and</span> <span class="n">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># is @root</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">_contained</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>  <span class="c1"># initially check anchor</span>
                <span class="n">_cxe</span> <span class="o">=</span> <span class="n">splitapppathx_getlocalpath</span><span class="p">(</span><span class="n">_sp_elems</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_cxe</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ssep</span> <span class="o">+</span> <span class="n">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">_contained</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_contained</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">_maxmatch</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># the maximum length of match that actually occured</span>
    <span class="n">_currentmatch</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># stack of current last list</span>

    <span class="n">si0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">_rev</span><span class="p">:</span>
        <span class="n">_pl</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">plist</span><span class="p">[:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_pl</span> <span class="o">=</span> <span class="n">plist</span>

    <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> <span class="n">_pl</span><span class="p">:</span>
        <span class="c1"># scan each path of pathlist(plist) for sp(spath) item-by-item</span>
        <span class="n">si0</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">_matchidx</span> <span class="o">=</span> <span class="n">matchidx</span>  <span class="c1"># count the present matches for each search path from plist</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sl</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>  <span class="c1"># canonical</span>
            <span class="c1"># manage app paths - current network only</span>
            <span class="n">_elements</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span>
                <span class="n">sl</span><span class="p">,</span> <span class="n">appsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">_spf</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">,</span> <span class="n">rtype</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_prtype</span><span class="p">,</span> <span class="n">_phost</span><span class="p">,</span> <span class="n">_pshare</span><span class="p">,</span> <span class="n">sl</span><span class="p">,</span> <span class="n">_qufrag</span> <span class="o">=</span> <span class="n">_elements</span>  <span class="c1"># for http/https</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">_prtype</span><span class="p">,</span> <span class="n">_phost</span><span class="p">,</span> <span class="n">_pshare</span><span class="p">,</span> <span class="n">sl</span> <span class="o">=</span> <span class="n">_elements</span>  <span class="c1"># for file systems</span>

            <span class="n">_prefix</span> <span class="o">=</span> <span class="n">_prtype</span> <span class="o">+</span> <span class="n">_phost</span>

            <span class="k">if</span> <span class="n">_pshare</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_prefix</span><span class="p">:</span>
                    <span class="n">_prefix</span> <span class="o">+=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">_pshare</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_prefix</span> <span class="o">=</span> <span class="n">_pshare</span>

            <span class="k">if</span> <span class="n">_app_prefix</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_app_prefix</span> <span class="o">!=</span> <span class="n">_prefix</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>


        <span class="c1"># split the pattern</span>
        <span class="n">sl_esc</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">sp_tmp</span><span class="p">,</span> <span class="n">_spf</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">sl_esc</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">matchidx</span><span class="p">:</span>
            <span class="c1"># no match</span>
            <span class="k">continue</span>
            <span class="c1"># return None</span>

        <span class="n">lx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sl_esc</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">sp_resolved</span> <span class="o">=</span> <span class="n">sl_esc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">lx</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">sp_resolved</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsep</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">_r</span> <span class="o">=</span> <span class="n">_prefix</span>

        <span class="c1"># join as much as requested by matchidx</span>
        <span class="k">if</span> <span class="n">_rev</span><span class="p">:</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="n">matchidx</span> <span class="c1">#- (s[-1] == &#39;&#39;)</span>
            <span class="k">if</span> <span class="n">lx</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">lx</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">_j</span> <span class="o">=</span> <span class="n">sp_resolved</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">lx</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">matchidx</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">matchidx</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">matchidx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="n">lx</span> <span class="o">=</span> <span class="n">matchidx</span> <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lx</span> <span class="o">=</span> <span class="n">matchidx</span>
            <span class="k">if</span> <span class="n">lx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_j</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_j</span> <span class="o">=</span> <span class="n">sp_resolved</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">lx</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_hook</span><span class="p">:</span>
            <span class="n">_j</span> <span class="o">+=</span> <span class="n">sp_resolved</span>

        <span class="n">remainder</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">_split</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_rev</span><span class="p">:</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="n">sp_resolved</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="n">matchidx</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="n">sp_resolved</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">matchidx</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">remainder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="n">remainder</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">remainder</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="n">remainder</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">_j</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_r</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;file:&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">sl</span><span class="p">):</span>
                    <span class="c1"># RFC 8089</span>
                    <span class="c1"># add prefix and absolute path</span>
                    <span class="n">_r</span> <span class="o">+=</span> <span class="n">_j</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;RFC8089 Requires absolute path, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sl</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">_r</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http:&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">sl</span><span class="p">):</span>
                    <span class="c1"># RFC 3986</span>
                    <span class="c1"># add prefix and absolute path</span>
                    <span class="n">_r</span> <span class="o">+=</span> <span class="n">_j</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;RFC3986 Requires absolute path, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sl</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">_sp_elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;lfsys&#39;</span><span class="p">:</span>
                <span class="n">join_apppathx_entry</span><span class="p">((</span><span class="n">_prtype</span><span class="p">,</span> <span class="n">_phost</span><span class="p">,</span> <span class="n">_pshare</span><span class="p">,</span> <span class="n">sl</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">_r</span> <span class="o">+=</span> <span class="n">_j</span>

        <span class="k">if</span> <span class="n">_r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">_r</span> <span class="o">=</span> <span class="n">_r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_split</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_r</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_hook</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">_r</span><span class="p">,</span> <span class="n">sp_resolved</span><span class="p">,</span> <span class="n">remainder</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">_r</span><span class="p">,</span> <span class="n">remainder</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="gettop_from_pathstring_iter"><a class="viewcode-back" href="../../apppaths.html#filesysobjects.apppaths.gettop_from_pathstring_iter">[docs]</a><span class="k">def</span> <span class="nf">gettop_from_pathstring_iter</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iterates all matches in plist,see gettop_from_pathstring.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>

    <span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">gettop_from_pathstring</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="p">[</span><span class="n">pl</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">r</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/pyfilesysobjects-64x64.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">filesysobjects 0.1.34 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../filesysobjects.html" >filesysobjects</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2018, Arno-Can Uestuensoez.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>