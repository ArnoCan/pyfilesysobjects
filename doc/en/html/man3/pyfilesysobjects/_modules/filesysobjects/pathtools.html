<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>filesysobjects.pathtools &mdash; filesysobjects 0.1.34 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.34',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="filesysobjects 0.1.34 documentation" href="../../index.html" />
    <link rel="up" title="filesysobjects" href="../filesysobjects.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">filesysobjects 0.1.34 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../filesysobjects.html" accesskey="U">filesysobjects</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for filesysobjects.pathtools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;The filesysobjects.pathstools module provides operations</span>
<span class="sd">for address paths of file system based resources.</span>

<span class="sd">.. note::</span>

<span class="sd">   Current version supports local accessible file systems only.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sre_constants</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">filesysobjects.plugins.smb</span> <span class="k">import</span> <span class="n">normapppathx</span>


<span class="kn">from</span> <span class="nn">filesysobjects</span> <span class="k">import</span> <span class="n">V3K</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">os</span> <span class="k">import</span> <span class="n">scandir</span><span class="p">,</span> <span class="n">walk</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scandir</span> <span class="k">import</span> <span class="n">scandir</span><span class="p">,</span> <span class="n">walk</span>  <span class="c1"># @UnusedImport</span>

<span class="kn">from</span> <span class="nn">pysourceinfo.helper</span> <span class="k">import</span> <span class="n">getpythonpath_rel</span>

<span class="kn">import</span> <span class="nn">filesysobjects</span>
<span class="kn">from</span> <span class="nn">filesysobjects</span> <span class="k">import</span> <span class="n">ISSTR</span><span class="p">,</span> <span class="n">PathError</span><span class="p">,</span> \
    <span class="n">RTE</span><span class="p">,</span> <span class="n">RTE_WIN32</span><span class="p">,</span> <span class="n">RTE_POSIX</span><span class="p">,</span> \
    <span class="n">FileSysObjectsError</span><span class="p">,</span> <span class="n">PathToolsError</span><span class="p">,</span> \
    <span class="n">W_LITERAL_QUOTED</span><span class="p">,</span> \
    <span class="n">OF_LIST_STR</span><span class="p">,</span> <span class="n">OF_LIST_OID</span><span class="p">,</span> <span class="n">OF_LIST_RAW</span><span class="p">,</span> \
    <span class="n">L_TDOWN_WALK</span><span class="p">,</span> \
    <span class="n">M_ALL</span><span class="p">,</span> <span class="n">M_FILTPAR</span><span class="p">,</span> \
    <span class="n">T_ALL</span><span class="p">,</span> <span class="n">T_DIR</span><span class="p">,</span> <span class="n">T_FILE</span><span class="p">,</span> <span class="n">T_SYML</span><span class="p">,</span> <span class="n">T_MNT</span><span class="p">,</span> <span class="n">T_HARDL</span><span class="p">,</span> <span class="n">T_DEV</span><span class="p">,</span> \
    <span class="n">Q_ALL_TRIPLE</span><span class="p">,</span> <span class="n">Q_DOUBLE_TRIPLE</span><span class="p">,</span> <span class="n">Q_SINGLE_TRIPLE</span><span class="p">,</span> \
    <span class="n">W_GLOB</span><span class="p">,</span> <span class="n">W_RE</span><span class="p">,</span> \
    <span class="n">rte2num</span><span class="p">,</span> \
    <span class="n">_debug</span>

<span class="kn">from</span> <span class="nn">filesysobjects.paths</span> <span class="k">import</span> <span class="n">normpathx</span><span class="p">,</span> <span class="n">escapepathx</span>
<span class="kn">from</span> <span class="nn">filesysobjects.apppaths</span> <span class="k">import</span> <span class="n">splitapppathx</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Arno-Can Uestuensoez&#39;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;Artistic-License-2.0 + Forced-Fairplay-Constraints&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) 2010-2016 Arno-Can Uestuensoez&quot;</span> \
                <span class="s2">&quot;@Ingenieurbuero Arno-Can Uestuensoez&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.1.20&#39;</span>
<span class="n">__uuid__</span> <span class="o">=</span> <span class="s2">&quot;4135ab0f-fbb8-45a2-a6b1-80d96c164b72&quot;</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s2">&quot;restructuredtext en&quot;</span>


<span class="n">rebaseflags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span>  <span class="c1"># @UndefinedVariable</span>
<span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
    <span class="n">rebaseflags</span> <span class="o">|=</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span>  <span class="c1"># @UndefinedVariable</span>

<span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
    <span class="n">pathflags</span> <span class="o">=</span> <span class="n">rebaseflags</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span>  <span class="c1"># @UndefinedVariable</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">pathflags</span> <span class="o">=</span> <span class="n">rebaseflags</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span>  <span class="c1"># @UndefinedVariable</span>

<span class="c1">#: First stage regexpr scanner for &#39;normpathx&#39;, also used in &#39;escapepathx&#39;.</span>
<span class="n">QUOTESCANNER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;&quot;&quot;</span>
<span class="s2">    ([&quot;]</span><span class="si">{3}</span><span class="s2">[\x01-\xFF]*?[&quot;]</span><span class="si">{3}</span><span class="s2">)       # 1  quoted string by 3 double quotes(&quot;) - similar to Python</span>
<span class="s2">    |([&#39;]</span><span class="si">{3}</span><span class="s2">[\x01-\xFF]*?[&#39;]</span><span class="si">{3}</span><span class="s2">)      # 2  quoted string by 3 single quotes(&#39;) - similar to Python</span>
<span class="s2">    |(.*?)(?=[&quot;]</span><span class="si">{3}</span><span class="s2">|[&#39;]</span><span class="si">{3}</span><span class="s2">)</span>
<span class="s2">    |(.*)</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">pathflags</span><span class="p">)</span>


<div class="viewcode-block" id="findrelpath_in_searchpath"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.findrelpath_in_searchpath">[docs]</a><span class="k">def</span> <span class="nf">findrelpath_in_searchpath</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Search for subdirectory trees *spath* of the paths</span>
<span class="sd">    contained in *plist*. ::</span>

<span class="sd">       MATCH :  plist[x]/spath</span>

<span class="sd">    supports *glob*.</span>

<span class="sd">    Args:</span>
<span class="sd">        **spath**:</span>
<span class="sd">            A path to be hooked into &#39;plist[]&#39; when present.</span>
<span class="sd">            Could be either a literal, or a glob as an relative</span>
<span class="sd">            or absolute path. Valid *spath* wildcard types:</span>

<span class="sd">            +---------+----+</span>
<span class="sd">            | literal | X  |</span>
<span class="sd">            +---------+----+</span>
<span class="sd">            | re      | -- |</span>
<span class="sd">            +---------+----+</span>
<span class="sd">            | glob    | X  |</span>
<span class="sd">            +---------+----+</span>

<span class="sd">            See common options for details. ::</span>

<span class="sd">               spath := (literal|glob):</span>


<span class="sd">        **plist**:</span>
<span class="sd">            List of potential hooks for &#39;spath&#39;.</span>
<span class="sd">            The following formats are provided:</span>

<span class="sd">                1. list of single paths - used literally</span>
<span class="sd">                2. list of search path strings - each search path is split</span>
<span class="sd">                3. string with search path - split into it&#39;s components</span>
<span class="sd">                4. string with a single path - used literally</span>

<span class="sd">            The default behavior is:</span>

<span class="sd">                * first: (1.)</span>
<span class="sd">                * second: (3.), this contains (4.)</span>

<span class="sd">            The case (2.) has to be forced by the key-option: &#39;subsplit&#39;,</span>
<span class="sd">            or to be prepared by the call &#39;clearpath(split=True,)&#39;.</span>

<span class="sd">            Due to performance the case #1 should be preferred in order</span>
<span class="sd">            to save repetitive automatic conversion.</span>

<span class="sd">            See common options for further details.</span>


<span class="sd">            default := sys.path</span>

<span class="sd">        kargs:</span>
<span class="sd">            **isDir**:</span>
<span class="sd">                Is a directory.</span>

<span class="sd">            **isFile**:</span>
<span class="sd">                Is a file.</span>

<span class="sd">            **isLink**:</span>
<span class="sd">                Is a symbolic link.</span>

<span class="sd">            **isPathByLink**:</span>
<span class="sd">                Has a symbolic link in path.</span>

<span class="sd">            **matchidx**:</span>
<span class="sd">                Ignore matches &#39;&lt; #idx&#39;,</span>
<span class="sd">                return match &#39;== #idx&#39;. Depends on</span>
<span class="sd">                &#39;reverse&#39; ::</span>

<span class="sd">                   matchidx := #idx:</span>

<span class="sd">                default := 0 # first match</span>

<span class="sd">            **noglob**:</span>
<span class="sd">                Suppress application of &#39;glob&#39;.</span>

<span class="sd">            **not**:</span>
<span class="sd">                Inverts to does not matched defined</span>
<span class="sd">                criteria.</span>

<span class="sd">            **raw**:</span>
<span class="sd">                Suppress normalization by call of</span>
<span class="sd">                &#39;os.path.normpath&#39;.</span>

<span class="sd">            **reverse**:</span>
<span class="sd">                Reversed search order.</span>

<span class="sd">            **subsplit**:</span>
<span class="sd">                Splits each item part of a &#39;plist&#39; option.</span>

<span class="sd">    Returns:</span>
<span class="sd">        When successful returns the absolute pathname,</span>
<span class="sd">        else &#39;None&#39;. For a list refer to iterator.</span>

<span class="sd">    Raises:</span>
<span class="sd">        PathToolsError</span>
<span class="sd">        passed through exceptions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spath</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">plist</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">plist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">plist</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">apppre</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PathToolsError</span><span class="p">(</span><span class="s2">&quot;Unknown type:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">plist</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">spath</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">spath</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">spath</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">raw</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_rgx</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_rev</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">matchidx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">_chkT</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_isL</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_isD</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_isF</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_isPL</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_not</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_ng</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_ssplit</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;matchidx&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PathToolsError</span><span class="p">(</span><span class="s2">&quot;Requires int&gt;0 matchidx=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="n">matchidx</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;not&#39;</span><span class="p">:</span>
            <span class="n">_not</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;raw&#39;</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;reverse&#39;</span><span class="p">:</span>
            <span class="n">_rev</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;noglob&#39;</span><span class="p">:</span>
            <span class="n">_ng</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;isLink&#39;</span><span class="p">:</span>
            <span class="n">_chkT</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">_isL</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;isDir&#39;</span><span class="p">:</span>
            <span class="n">_chkT</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">_isD</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;isFile&#39;</span><span class="p">:</span>
            <span class="n">_chkT</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">_isF</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;isPathByLink&#39;</span><span class="p">:</span>
            <span class="n">_chkT</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;subsplit&#39;</span><span class="p">:</span>
            <span class="n">_ssplit</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PathToolsError</span><span class="p">(</span><span class="s2">&quot;Unknown param: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">_ssplit</span><span class="p">:</span>  <span class="c1"># split sub paths, but do not alter the callers source</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">plist</span><span class="p">[:]</span>
        <span class="n">clearpath</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># use canonical copy</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
        <span class="n">_sp</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">keepsep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">apppre</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_sp</span> <span class="o">=</span> <span class="n">spath</span><span class="p">[:]</span>

    <span class="k">def</span> <span class="nf">_checkit</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">_b</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">_chkT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_isF</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">_b</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">_isD</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">_b</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">_isL</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">_b</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">_isPL</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">_b</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">_b</span>

    <span class="c1"># short it up for absolute input of existing paths, thus is a literal too!</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">_sp</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_sp</span><span class="p">):</span>  <span class="c1"># exists as absolute</span>
        <span class="n">_b</span> <span class="o">=</span> <span class="n">_checkit</span><span class="p">(</span><span class="n">_sp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">_sp</span><span class="p">):</span>
                <span class="n">_b</span> <span class="o">&amp;=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">_b</span> <span class="ow">and</span> <span class="n">matchidx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">_b</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">matchidx</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">_sp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_b</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_not</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_sp</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">_rev</span><span class="p">:</span>  <span class="c1">#: reverse =&gt; bottom up for sorted</span>
        <span class="n">_pl</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">plist</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_pl</span> <span class="o">=</span> <span class="n">plist</span>

    <span class="c1"># now look for hooks of relative paths in plist</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">_pl</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">_b</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">_sp</span><span class="p">):</span>
            <span class="n">_px</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">_sp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_px</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">_sp</span><span class="p">),</span> <span class="n">stripquote</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_px</span><span class="p">):</span>
            <span class="n">_b</span> <span class="o">=</span> <span class="n">_checkit</span><span class="p">(</span><span class="n">_px</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_b</span> <span class="ow">and</span> <span class="n">matchidx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_b</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">matchidx</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">_b</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_not</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_px</span>

            <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_ng</span><span class="p">:</span>
            <span class="c1"># try a glob</span>
            <span class="k">for</span> <span class="n">gm</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">_px</span><span class="p">):</span>
                <span class="n">_b</span> <span class="o">=</span> <span class="n">_checkit</span><span class="p">(</span><span class="n">gm</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">_b</span> <span class="ow">and</span> <span class="n">matchidx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">_b</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">matchidx</span> <span class="o">-=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">_b</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_not</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">gm</span>

                <span class="k">continue</span>

    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="findrelpath_in_searchpath_iter"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.findrelpath_in_searchpath_iter">[docs]</a><span class="k">def</span> <span class="nf">findrelpath_in_searchpath_iter</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iterates all matches in plist, see *findrelpath_in_searchpath*.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">plist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">plist</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="p">[</span><span class="n">plist</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>

        <span class="c1"># TODO:</span>
        <span class="n">matchidx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;matchidx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchidx</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">findrelpath_in_searchpath</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="p">[</span><span class="n">pl</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">r</span>
                <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;matchidx&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span></div>


<div class="viewcode-block" id="findrelpath_in_uppertree"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.findrelpath_in_uppertree">[docs]</a><span class="k">def</span> <span class="nf">findrelpath_in_uppertree</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iterates all matches in plist, see findrelpath_in_searchpath.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="findrelpath_in_uppertree_iter"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.findrelpath_in_uppertree_iter">[docs]</a><span class="k">def</span> <span class="nf">findrelpath_in_uppertree_iter</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Iterates all matches in plist, see *findrelpath_in_uppertree*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>

    <span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>

        <span class="c1"># TODO:</span>
        <span class="n">matchidx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;matchidx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchidx</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">findrelpath_in_searchpath</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="p">[</span><span class="n">pl</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">r</span>
                <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;matchidx&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span></div>


<div class="viewcode-block" id="findpattern"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.findpattern">[docs]</a><span class="k">def</span> <span class="nf">findpattern</span><span class="p">(</span><span class="o">*</span><span class="n">srcdirs</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Executes on each *srcdirs* a tree search with match and drop patterns.</span>
<span class="sd">    The interface is basically similar to &#39;find&#39; with enhanced match options.</span>

<span class="sd">    The search operation relies for Python3.5+ on *os.scandir()* - for</span>
<span class="sd">    Python2.7 on *scandir.scandir()*. The interface extends the lower layer</span>
<span class="sd">    API by lists of filters with support for &#39;literal&#39;, &#39;glob&#39; and/or</span>
<span class="sd">    &#39;regexpr&#39; pattern.</span>

<span class="sd">    The search algorithm is performed as:</span>

<span class="sd">    0.  If *srcdirs* is provided use each as starting file path,</span>
<span class="sd">        else initialize based on current working directory.</span>

<span class="sd">    1.  Set behavior attributes, see options:</span>

<span class="sd">        0. *listorder*</span>
<span class="sd">        1. *followlinks*</span>
<span class="sd">        2. *matchbehavior*</span>
<span class="sd">        3. *matchcnt*</span>

<span class="sd">        .</span>
<span class="sd">    2.  If no filter parameters are present return afterwards.</span>

<span class="sd">        Else apply filter parameters. Each non-matching condition</span>
<span class="sd">        continues with next filter cycle by default. When no match</span>
<span class="sd">        the result is accepted, see options:</span>

<span class="sd">        0.  check *level*</span>
<span class="sd">        1.  check *blacklist*</span>
<span class="sd">        2.  check *whitelist*</span>
<span class="sd">        3.  check *dropdirs*</span>
<span class="sd">        4.  check *type*</span>

<span class="sd">        .</span>
<span class="sd">    3.  Apply string manipulation, see options</span>

<span class="sd">        a. check-cut *topcutlist*</span>

<span class="sd">        .</span>

<span class="sd">    The general behavior for the parameters is additive, this means</span>
<span class="sd">    e.g. when provided *wildcards*, *globs*, *regexpr*, and *filter*</span>
<span class="sd">    these are applied subsequently. Each match is added by default</span>
<span class="sd">    to the result list. The drop parameters instantly remove the match</span>
<span class="sd">    from the result list.</span>

<span class="sd">    Args:</span>

<span class="sd">        **srcdirs**:</span>
<span class="sd">            List of top level paths for search. Supports *literal*,</span>
<span class="sd">            *re*, and *glob*.</span>

<span class="sd">            default := *[&lt;current-workdir&gt;,]*</span>

<span class="sd">        kargs:</span>
<span class="sd">            Additional control:</span>

<span class="sd">            **abs**:</span>
<span class="sd">                Defines the type of returned path value,</span>
<span class="sd">                when present. ::</span>

<span class="sd">                   abs := (</span>
<span class="sd">                         True    # Force absolute paths.</span>
<span class="sd">                       | False   # Force relative paths.</span>
<span class="sd">                   )</span>

<span class="sd">                default := &quot;depends on type of input&quot;</span>

<span class="sd">            **blacklist**:</span>
<span class="sd">                File system nodes to be dropped from the result.</span>
<span class="sd">                Supports Python *re* expressions,</span>
<span class="sd">                See `Variants of Pathname Parameters - Literals, RegExpr, and Glob &lt;path_syntax.html#variants-of-pathname-parameters-literals-regexpr-and-glob&gt;`_</span>

<span class="sd">                default := None</span>

<span class="sd">            **whitelist**:</span>
<span class="sd">                File system nodes to be added to the result.</span>
<span class="sd">                Supports Python *re* expressions,</span>
<span class="sd">                See `Variants of Pathname Parameters - Literals, RegExpr, and Glob &lt;path_syntax.html#variants-of-pathname-parameters-literals-regexpr-and-glob&gt;`_</span>

<span class="sd">                default := *\**</span>

<span class="sd">            **followlinks**:</span>
<span class="sd">                Follow symbolic links.</span>

<span class="sd">                default := *False*</span>

<span class="sd">            **gid**:</span>
<span class="sd">                Group ID.</span>

<span class="sd">            **level**:</span>
<span class="sd">                Depth of search. The values are: ::</span>

<span class="sd">                   None: Search the subtree unlimited.</span>
<span class="sd">                   0:    Current directory only, basically</span>
<span class="sd">                         the same as *os.listdir()*.</span>
<span class="sd">                   &gt;0:   Sub-directories of given level.</span>

<span class="sd">                default := *None*</span>

<span class="sd">            **matchcnt**:</span>
<span class="sd">                Defines the selection of matches:</span>

<span class="sd">                * *n&lt;0*: the last *n*, last := *-1*.</span>
<span class="sd">                * *n=0*: all</span>
<span class="sd">                * *n&gt;0*: the first *n*, first := *1*.</span>

<span class="sd">                default := 0</span>

<span class="sd">            **nopostfix**:</span>
<span class="sd">                Deletes for files the postfix.</span>

<span class="sd">            **output**:</span>
<span class="sd">                Output format. Current available formats are: ::</span>

<span class="sd">                   output := (</span>
<span class="sd">                       OF_LIST_STR,   # list of file system path names</span>
<span class="sd">                       OF_LIST_OID,   # list of dotted object notation</span>
<span class="sd">                       OF_RAW         # list of raw entries *DirEntry*, see scandir</span>
<span class="sd">                   )</span>

<span class="sd">            **topcutlist**:</span>
<span class="sd">                Cut listed topmost path elements from</span>
<span class="sd">                found list elements, resulting in relative</span>
<span class="sd">                pathnames.</span>

<span class="sd">                default := *[&#39;.&#39; + os.sep]*</span>

<span class="sd">            **topdown**:</span>
<span class="sd">                Defines the order or the resulting list, same as</span>
<span class="sd">                *os.walk*. ::</span>

<span class="sd">                   topdown := (True | False)</span>

<span class="sd">                default := True</span>

<span class="sd">            **types**:</span>
<span class="sd">                Search and list selected types only.</span>
<span class="sd">                The value is a bit-array. ::</span>

<span class="sd">                    T_ALL, T_DEV, T_FILE, T_DIR, T_HARDL,</span>
<span class="sd">                    T_EXP, T_LOCAL, T_MNT, T_NODES,</span>
<span class="sd">                    T_SYML</span>

<span class="sd">                default := *T_ALL*</span>

<span class="sd">            **uid**:</span>
<span class="sd">                User ID.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Results in an list of found entries. When none,</span>
<span class="sd">        an empty list.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ffs.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># resolved result</span>
    <span class="n">i0</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># reusable index - handle with care</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># reusable index - handle with care</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># reusable index - handle with care</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">srcdirs</span><span class="p">:</span>
        <span class="n">srcdirs</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

    <span class="n">_blacklist</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_followlinks</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_gid</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_lvl</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_matchbehavior</span> <span class="o">=</span> <span class="n">M_ALL</span> <span class="o">|</span> <span class="n">M_FILTPAR</span>
    <span class="n">_matchcnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_nopostfix</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_output</span> <span class="o">=</span> <span class="n">OF_LIST_STR</span>
    <span class="n">_srcdirs</span> <span class="o">=</span> <span class="n">srcdirs</span>
    <span class="n">_topcutlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">]</span>
    <span class="n">_topdown</span> <span class="o">=</span> <span class="n">L_TDOWN_WALK</span>
    <span class="n">_types</span> <span class="o">=</span> <span class="n">T_ALL</span>
    <span class="n">_uid</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_whitelist</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;types&#39;</span><span class="p">:</span>
            <span class="n">_types</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;level&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_lvl</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_lvl</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;supported values for </span><span class="si">%s</span><span class="s2">: None, x&gt;=0, got: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;listorder&#39;</span><span class="p">:</span>
            <span class="n">_topdown</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;followlinks&#39;</span><span class="p">:</span>
            <span class="n">_followlinks</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;matchbehavior&#39;</span><span class="p">:</span>
            <span class="n">_matchbehavior</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;matchcnt&#39;</span><span class="p">:</span>
            <span class="n">_matchcnt</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;nopostfix&#39;</span><span class="p">:</span>
            <span class="n">_nopostfix</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;topcutlist&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
                <span class="n">_topcutlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">_topcutlist</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;blacklist&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
                <span class="n">_blacklist</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">_blacklist</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; requires (str|list|tuple), got: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;whitelist&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
                <span class="n">_whitelist</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">_whitelist</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; requires (str|list|tuple), got: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;gid&#39;</span><span class="p">:</span>
            <span class="n">_gid</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;uid&#39;</span><span class="p">:</span>
            <span class="n">_uid</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;output&#39;</span><span class="p">:</span>
            <span class="n">_output</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PathToolsError</span><span class="p">(</span><span class="s2">&quot;Unknown parameter:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span>
                                     <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

    <span class="c1"># monitor thresholds</span>
    <span class="n">_clvl</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># current level</span>
    <span class="n">_cmatch</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># current match count</span>

    <span class="c1">#</span>
    <span class="c1"># cache for resolved source paths</span>
    <span class="c1">#</span>
    <span class="n">_srccache</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i0</span> <span class="ow">in</span> <span class="n">_srcdirs</span><span class="p">:</span>  <span class="c1"># workout source dirs</span>

        <span class="c1"># TODO:</span>

        <span class="n">i1</span> <span class="o">=</span> <span class="n">expandpath</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">wildcards</span><span class="o">=</span><span class="n">W_GLOB</span> <span class="o">|</span> <span class="n">W_RE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i1</span><span class="p">:</span>
            <span class="n">_srccache</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># whitelist</span>
    <span class="c1">#</span>
    <span class="n">_wcache</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">_whitelist</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># give it a try</span>
            <span class="n">_wcache</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">normpathx</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">_whitelist</span><span class="p">),</span> <span class="n">stripquote</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_wcache</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_whitelist</span><span class="p">:</span>
                    <span class="c1"># pattern needs twice</span>
                    <span class="n">_pat</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stripquote</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">_pat</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">_pat</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">_wcache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">_pat</span><span class="p">))</span>

            <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s2">&quot;requires (str | list | tuple), got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_whitelist</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">sre_constants</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">e</span><span class="o">.</span><span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&quot;re&quot; compile-error:</span><span class="se">\n</span><span class="s1"> in: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">     </span><span class="si">%s</span><span class="s1">^</span><span class="se">\n</span><span class="s1">  =&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pattern</span><span class="p">)),</span>
                    <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pos</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pattern</span><span class="p">)[:</span><span class="n">e</span><span class="o">.</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># blacklist</span>
    <span class="c1">#</span>
    <span class="n">_bcache</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">_blacklist</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_bcache</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">normapppathx</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">_blacklist</span><span class="p">),</span> <span class="n">stripquote</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">_bcache</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_blacklist</span><span class="p">:</span>
                        <span class="n">_bcache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">normapppathx</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">stripquote</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>
                <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s2">&quot;requires (str | list | tuple), got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_blacklist</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">sre_constants</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">e</span><span class="o">.</span><span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&quot;re&quot; compile-error:</span><span class="se">\n</span><span class="s1"> in: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">     </span><span class="si">%s</span><span class="s1">^</span><span class="se">\n</span><span class="s1">  =&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pattern</span><span class="p">)),</span>
                    <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pos</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pattern</span><span class="p">)[:</span><span class="n">e</span><span class="o">.</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">checknode</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check a single node by prepared filter.</span>

<span class="sd">        Args:</span>

<span class="sd">            **nx**:</span>
<span class="sd">                Directory entry: ::</span>

<span class="sd">                   Python2.7:  *scandir.DirEntry*.</span>
<span class="sd">                   Python3.5+: *os.DirEntry*.</span>

<span class="sd">        Returns:</span>

<span class="sd">            MATCH: paths</span>
<span class="sd">            ELSE:  None</span>

<span class="sd">        Raises:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1">#</span>
        <span class="c1"># blacklist</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">_bcache</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_bcache</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">spx</span> <span class="ow">in</span> <span class="n">_bcache</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">spx</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>

        <span class="c1">#</span>
        <span class="c1"># whitelist</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">_wcache</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_wcache</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">spx</span> <span class="ow">in</span> <span class="n">_wcache</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">spx</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                        <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># check type</span>
        <span class="k">if</span> <span class="n">_types</span> <span class="o">^</span> <span class="n">T_ALL</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">_types</span> <span class="o">&amp;</span> <span class="n">T_DIR</span> <span class="ow">and</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_dir</span><span class="p">(</span><span class="n">follow_symlinks</span><span class="o">=</span><span class="n">_followlinks</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">_types</span> <span class="o">&amp;</span> <span class="n">T_FILE</span> <span class="ow">and</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_file</span><span class="p">(</span><span class="n">follow_symlinks</span><span class="o">=</span><span class="n">_followlinks</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">_types</span> <span class="o">&amp;</span> <span class="n">T_SYML</span> <span class="ow">and</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_symlink</span><span class="p">():</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">_types</span> <span class="o">&amp;</span> <span class="n">T_MNT</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">ismount</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">si</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">follow_symlinks</span><span class="o">=</span><span class="n">_followlinks</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_types</span> <span class="o">&amp;</span> <span class="n">T_HARDL</span> <span class="ow">and</span> <span class="n">si</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">_types</span> <span class="o">&amp;</span> <span class="n">T_DEV</span> <span class="ow">and</span> <span class="n">si</span><span class="o">.</span><span class="n">st_dev</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># elif  _types &amp; T_EXP and os.path.isfile(nx):</span>
            <span class="c1">#    res.append(nx)</span>
            <span class="c1"># elif  _types &amp; T_LOCAL and os.path.isfile(nx):</span>
            <span class="c1">#    res.append(nx)</span>
            <span class="c1"># elif  _types &amp; T_NODES and os.path.isfile(nx):</span>
            <span class="c1">#    res.append(nx)</span>
        <span class="k">elif</span> <span class="n">_uid</span> <span class="ow">or</span> <span class="n">_gid</span><span class="p">:</span>
            <span class="n">si</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">follow_symlinks</span><span class="o">=</span><span class="n">_followlinks</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_uid</span> <span class="ow">and</span> <span class="n">si</span><span class="o">.</span><span class="n">st_uid</span> <span class="ow">in</span> <span class="p">(</span><span class="n">_uid</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">_gid</span> <span class="ow">and</span> <span class="n">si</span><span class="o">.</span><span class="n">st_gid</span> <span class="ow">in</span> <span class="p">(</span><span class="n">_gid</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">fetchnode</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">lvl</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_lvl</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lvl</span> <span class="o">&gt;</span> <span class="n">_lvl</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">_opwd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">:</span>
            <span class="c1"># force absolute</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">abs</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
            <span class="n">_opwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span> <span class="o">=</span> <span class="n">start</span>


        <span class="k">for</span> <span class="n">sx</span> <span class="ow">in</span> <span class="n">scandir</span><span class="p">(</span><span class="n">start</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">checknode</span><span class="p">(</span><span class="n">sx</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">_output</span> <span class="ow">in</span> <span class="p">(</span><span class="n">OF_LIST_STR</span><span class="p">,</span> <span class="n">OF_LIST_OID</span><span class="p">):</span>
                    <span class="c1"># a. check-cut postfix</span>
                    <span class="k">if</span> <span class="n">_nopostfix</span> <span class="ow">and</span> <span class="n">sx</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                        <span class="n">px</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">sx</span><span class="o">.</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">px</span> <span class="o">=</span> <span class="n">sx</span><span class="o">.</span><span class="n">path</span>

                    <span class="c1"># b. check-cut topcutlist</span>
                    <span class="k">if</span> <span class="n">_topcutlist</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">_topcutlist</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">px</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">i2</span><span class="p">):</span>
                                <span class="n">px</span> <span class="o">=</span> <span class="n">px</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i2</span><span class="p">):]</span>
                                <span class="k">break</span>

                    <span class="k">if</span> <span class="n">_output</span> <span class="o">==</span> <span class="n">OF_LIST_OID</span><span class="p">:</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">px</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">_output</span> <span class="o">==</span> <span class="n">OF_LIST_RAW</span><span class="p">:</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>


            <span class="k">if</span> <span class="n">sx</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="n">fetchnode</span><span class="p">(</span><span class="n">sx</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">lvl</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_opwd</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">curdir</span> <span class="o">=</span> <span class="n">_opwd</span>

        <span class="k">return</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">_srccache</span><span class="p">:</span>  <span class="c1"># workout top-root-list</span>
        <span class="n">fetchnode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span></div>


<span class="c1">#</span>
<span class="c1"># Pre-Reduce the result by glob for literal prefix of re.</span>
<span class="c1"># Match on the longest sub-part applicable as prefix for a glob</span>
<span class="c1">#</span>
<span class="n">_glob_prefix</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;&quot;&quot;</span>
<span class="s2">     (^[a-zA-Z]:)                       # 1  - DOS drive</span>
<span class="s2">    |(\[[\^][^\]]*\][*]*)               # 2  - [^...]  it is a re</span>
<span class="s2">    |(\[[^/\]]*\][*]*)                  # 3  - [...]   a char class without separator</span>
<span class="s2">    |(\[[!][^/\]]*[/][^\]]*\][*]*)      # 4  - [!.../...]   a non-def char class with separator</span>
<span class="s2">    |(\[[/]*\][*]*)                     # 5  - [/]   a char class with posix-separator ONLY</span>
<span class="s2">    |(\[[^/\[\]]*[/][^/\[]*\][*]*)      # 6  - [.../...]   a char class with posix-separator</span>
<span class="s2">    |(\[[\\\\]*\][*]*)                  # 7  - [\\\\]   a char class with nt-separator ONLY</span>
<span class="s2">    |(\[[^\\\\]*[\\\\][^\\\\]*\][*]*)   # 8  - [...\\\\...]   a char class with nt-separator</span>
<span class="s2">    |(\([^)]*\))                        # 9  - (......)   a re-group</span>
<span class="s2">    |([/]+)                             # 10  - &#39;/&#39;     class-less n * posix-separator</span>
<span class="s2">    |([\\\\]+)                          # 11 - &#39;\\&#39;    class-less n * nt-separator</span>
<span class="s2">    |([^/\\\\\[\]]*[.][*][^/\\\\\[\]]*)(?=/|$)</span>
<span class="s2">                                        # 12 - a string containing &#39;.*&#39; and optional additional chars</span>
<span class="s2">    |([*])                              # 13 - a wildcard character</span>
<span class="s2">    |([^/\\\\\[\]]+)(?=/|$)             # 14 - any character until next shlash - separator for posix</span>
<span class="s2">    |([^/\\\\\[\]]+)(?=[\\\\]|$)        # 15 - any character until next back-slash - separator for win</span>
<span class="s2">    |(\[)                               # 16 - likely to be a syntax error, but could be literal too</span>
<span class="s2">    |(\])                               # 17 - likely to be a syntax error, but could be literal too</span>
<span class="s2">    |(.)                                # 18 - any literal character</span>
<span class="s2">    |($)                                # 19 - end of string</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># @UndefinedVariable</span>

<div class="viewcode-block" id="stripquotes"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.stripquotes">[docs]</a><span class="k">def</span> <span class="nf">stripquotes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">Q_ALL_TRIPLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Strips quotes.</span>

<span class="sd">    Args:</span>
<span class="sd">        **path**:</span>
<span class="sd">            Path to strip off of quotes.</span>

<span class="sd">        **scope**:</span>
<span class="sd">            Scope to be applied. ::</span>

<span class="sd">               scope := (</span>
<span class="sd">                    Q_ALL_TRIPLE     # &quot; * 3 and &#39; * 3</span>
<span class="sd">                  | Q_DOUBLE_TRIPLE  # &quot; * 3</span>
<span class="sd">                  | Q_SINGLE_TRIPLE  # &#39; * 3</span>
<span class="sd">               )</span>

<span class="sd">    Returns:</span>
<span class="sd">        Path without selected triple-quotes.</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">QUOTESCANNER</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>  <span class="c1"># PATHSCANNER ASCII_SC_CTRL</span>
        <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">scope</span> <span class="o">&amp;</span> <span class="n">Q_DOUBLE_TRIPLE</span><span class="p">:</span>
                <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">+=</span> <span class="n">_x</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">+=</span> <span class="n">_x</span>
                <span class="k">continue</span>

            <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">scope</span> <span class="o">&amp;</span> <span class="n">Q_SINGLE_TRIPLE</span><span class="p">:</span>
                <span class="c1"># ignore SonarLint here</span>
                <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">+=</span> <span class="n">_x</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">+=</span> <span class="n">_x</span>
                <span class="k">continue</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">parts</span> <span class="o">+=</span> <span class="n">x</span>

    <span class="k">return</span> <span class="n">parts</span></div>

<div class="viewcode-block" id="split_re_glob"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.split_re_glob">[docs]</a><span class="k">def</span> <span class="nf">split_re_glob</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Splits a mixed path expression into the *glob* + *literal*</span>
<span class="sd">    prefix and the regular expression *re* postfix. The cut for the</span>
<span class="sd">    expression is done by grouping the expressions at the edge of</span>
<span class="sd">    paths by matched free characters of path separators. The</span>
<span class="sd">    detection of the first *re* is done by detecting an unambiguously</span>
<span class="sd">    non-glob expression. These are considered as *re* expressions: ::</span>

<span class="sd">       [^...]     a exclusive character class</span>
<span class="sd">       (...)      a group</span>
<span class="sd">       \[ or \]   escaped square brackets</span>

<span class="sd">    Due to the various permitted character ranges,</span>
<span class="sd">    where e.g. POSIX allows almost any character these</span>
<span class="sd">    maz still be valid characters. In this case they have</span>
<span class="sd">    to be either escaped, or to be applied within character</span>
<span class="sd">    classes.</span>

<span class="sd">    The type resolution could in addition controlled by</span>
<span class="sd">    the option *typeprio*, which redfines some compilation</span>
<span class="sd">    priorities.</span>

<span class="sd">    See manual for further details.</span>

<span class="sd">    Args:</span>
<span class="sd">        **expr**:</span>
<span class="sd">            expression to be split</span>

<span class="sd">        kargs:</span>
<span class="sd">            **spf**:</span>
<span class="sd">                Source platform, defines the separator for path items.</span>

<span class="sd">                default := None</span>

<span class="sd">            **typeprio**:</span>
<span class="sd">                The priority type in case of ambiguity. ::</span>

<span class="sd">                   typeprio := (</span>
<span class="sd">                        W_GLOB     # interprets as *glob*</span>
<span class="sd">                      | W_RE       # interprets as *re*</span>
<span class="sd">                   )</span>

<span class="sd">                default := W_RE</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of two elements,</span>
<span class="sd">        &#39;L[0]- glob&#39; and &#39;L[1]- re&#39;</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_res</span> <span class="o">=</span> <span class="p">[[],[]]</span>
    <span class="n">_buf</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
    <span class="n">_state</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># has changed from *glob* to *re*</span>

    <span class="n">spf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spf</span><span class="p">:</span>
        <span class="n">spf</span> <span class="o">=</span> <span class="n">RTE</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">spf</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">spf</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;Unknown source platform: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spf</span><span class="p">))</span>

    <span class="n">typeprio</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;typeprio&#39;</span><span class="p">,</span> <span class="n">W_RE</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">_glob_prefix</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>

        <span class="c1"># glob-prefix</span>
        <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">3</span><span class="p">,</span>  <span class="c1"># class no sep</span>
                <span class="mi">13</span><span class="p">,</span>  <span class="c1"># wildcard char</span>
            <span class="p">):</span>
            <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">12</span><span class="p">,</span>  <span class="c1"># any-wildcard</span>
            <span class="p">):</span>
            <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">typeprio</span> <span class="o">&amp;</span> <span class="n">W_RE</span><span class="p">:</span>
                <span class="n">_state</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># any character until next shlash - separator for posix</span>
        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">14</span><span class="p">,</span> <span class="c1"># any char until next shlash</span>
                <span class="mi">18</span><span class="p">,</span> <span class="c1"># 17 - any literal character</span>
            <span class="p">):</span>
            <span class="c1"># is a path-item separator in any case - I am likely to ignore that POSIX allows slash as part of node name</span>
            <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="c1"># any character before next back-slash - separator for win</span>
        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">15</span><span class="p">,</span> <span class="c1"># any char before next back-slash</span>
            <span class="p">):</span>
            <span class="k">if</span> <span class="n">spf</span> <span class="o">==</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
                <span class="c1"># is a path-item separator for win</span>
                <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># is a common character for path-item names</span>
                <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="c1"># non-glob</span>
        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span>  <span class="c1"># [^...]</span>
                <span class="mi">4</span><span class="p">,</span>  <span class="c1"># [^/]</span>
                <span class="mi">16</span><span class="p">,</span> <span class="c1"># \[  basically a syntax error, but could be literal</span>
                <span class="mi">17</span><span class="p">,</span> <span class="c1"># \]  basically a syntax error, but could be literal</span>
                <span class="mi">9</span><span class="p">,</span>  <span class="c1"># (...) group</span>
            <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_state</span><span class="p">:</span>
                <span class="n">_res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_buf</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">_buf</span> <span class="o">=</span> <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">_state</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="c1"># free separators</span>
        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
               <span class="mi">10</span><span class="p">,</span>  <span class="c1"># free n*posix-sep</span>
            <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_state</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">_res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_buf</span><span class="p">)</span>
                    <span class="n">_buf</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">_buf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># free separators</span>
        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">11</span><span class="p">,</span>  <span class="c1"># free n*nt-sep</span>
            <span class="p">):</span>
            <span class="k">if</span> <span class="n">spf</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">_buf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="c1"># separators in classes</span>
        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">5</span><span class="p">,</span>  <span class="c1"># class with posix-sep [/]</span>
            <span class="p">):</span>
            <span class="c1"># is a common character for path-item names</span>
            <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="c1"># separators in classes</span>
        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">8</span><span class="p">,</span>  <span class="c1"># class with nt-sep</span>
            <span class="p">):</span>
<span class="c1">#             if spf == RTE_WIN32:</span>
<span class="c1">#                 # is a path-item separator for win</span>
<span class="c1">#                 _buf.append(&#39;&#39;)</span>
<span class="c1">#             else:</span>
<span class="c1">#                 # is a common character for path-item names</span>
<span class="c1">#                 _buf[-1] += it.group(g)</span>
            <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="c1"># dos drive</span>
        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>  <span class="c1"># DOS drive</span>
            <span class="p">):</span>
            <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_buf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">_buf</span> <span class="o">=</span> <span class="n">_buf</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">_state</span><span class="p">:</span>
        <span class="c1"># has re</span>
        <span class="n">_res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_buf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># assumably did not match any re</span>
        <span class="n">_res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_buf</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_res</span></div>


<div class="viewcode-block" id="get_subpath_product"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.get_subpath_product">[docs]</a><span class="k">def</span> <span class="nf">get_subpath_product</span><span class="p">(</span><span class="n">dirs</span><span class="p">,</span> <span class="n">subpaths</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates the textual cartesian product of directories and relative sub-paths.</span>
<span class="sd">    Addditional checks sould be applied by *clearpath()* and *expandpath()*.</span>

<span class="sd">    The calls for the specific platforms notations: ::</span>

<span class="sd">       cprod_posix = get_subpath_product((&#39;/path/0&#39;, &#39;/path/1&#39;), (&#39;suba&#39;, &#39;subb&#39;))</span>
<span class="sd">       cprod_win32 = get_subpath_product((&#39;c:\path\0&#39;, &#39;d:\path\1&#39;), (&#39;suba&#39;, &#39;subb&#39;))</span>

<span class="sd">    results in: ::</span>

<span class="sd">       cprod_posix == [</span>
<span class="sd">           &#39;/path/0/suba&#39;, &#39;/path/0/subb&#39;,</span>
<span class="sd">           &#39;/path/1/suba&#39;  &#39;/path/1/subb&#39;</span>
<span class="sd">        ]</span>
<span class="sd">       cprod_win32 == [</span>
<span class="sd">           &#39;c:\path\0\suba&#39;, &#39;c:\path\0\subb&#39;,</span>
<span class="sd">           &#39;d:\path\1\suba&#39;  &#39;d:\path\1\subb&#39;</span>
<span class="sd">        ]</span>

<span class="sd">    Args:</span>
<span class="sd">        **dirs**:</span>
<span class="sd">            Base directories for the provided subdirectories.</span>

<span class="sd">        **subpaths**:</span>
<span class="sd">            Sub-paths, each to be located within each of the</span>
<span class="sd">            directories *dirs*.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The list of path names resulting from the literal textual</span>
<span class="sd">        cartesian product.</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">dirs</span><span class="p">,</span> <span class="n">subpaths</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;subpath is absolute:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span></div>


<span class="c1">#: The scanner for the glob to re compiler.</span>
<span class="n">_glob_to_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;&quot;&quot;</span>
<span class="s2">    ([&quot;]</span><span class="si">{3}</span><span class="s2">[\x01-\xFF]*?[&quot;]</span><span class="si">{3}</span><span class="s2">)         # 1  quoted string by 3 double quotes(&quot;) - similar to Python</span>
<span class="s2">    |([&#39;]</span><span class="si">{3}</span><span class="s2">[\x01-\xFF]*?[&#39;]</span><span class="si">{3}</span><span class="s2">)        # 2  quoted string by 3 single quotes(&#39;) - similar to Python</span>

<span class="s2">    |(\[[!][^/\]]*[/][^\]]*\])          # 3  - [!.../...]</span>
<span class="s2">    |(\[[!][^\]]*[^\]]*\])              # 4  - [!...]</span>
<span class="s2">    |(\[[!][^/\]]*[*][^\]]*\])          # 5  - [!...*...]</span>
<span class="s2">    |(\[[!][^/\]]*[.][^\]]*\])          # 6  - [!...&#39;.&#39;...]</span>
<span class="s2">    |(\[[!][^/\]]*[?][^\]]*\])          # 7  - [!...&#39;?&#39;...]</span>
<span class="s2">    |(\[[^/\]]*[/][^\]]*\])             # 8  - [.../...] - don&#39;t touch it</span>
<span class="s2">    |(\[[^/\]]*[*][^\]]*\])             # 9  - [...*...] - don&#39;t touch it</span>
<span class="s2">    |(\[[^/\]]*[.][^\]]*\])             # 10 - [...&#39;.&#39;...] - don&#39;t touch it</span>
<span class="s2">    |(\[[^/\]]*[?][^\]]*\])             # 11 - [...&#39;?&#39;...] - don&#39;t touch it</span>
<span class="s2">    |([\\\\][\\\\])                     # 12 - escaped backslash</span>
<span class="s2">    |([\\\\][*])                        # 13 - escaped wildcard character</span>
<span class="s2">    |([*])                              # 14 - wildcard character</span>
<span class="s2">    |([.])                              # 15 - dot - for glob a literal dot</span>
<span class="s2">    |([?])                              # 16 - question mark - for glob any char</span>
<span class="s2">    |(.)                                # 17 - any literal char</span>
<span class="s2">    |($)                                # 18 - end of string</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># @UndefinedVariable</span>

<div class="viewcode-block" id="glob_to_re"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.glob_to_re">[docs]</a><span class="k">def</span> <span class="nf">glob_to_re</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compiles a *glob* to the corresponding *re*.</span>
<span class="sd">    The following mapping is implemented:</span>

<span class="sd">    +-------+-------+</span>
<span class="sd">    | glob  | re    |</span>
<span class="sd">    +=======+=======+</span>
<span class="sd">    | \*    | .*    |</span>
<span class="sd">    +-------+-------+</span>
<span class="sd">    | [!x]  | [^x]  |</span>
<span class="sd">    +-------+-------+</span>
<span class="sd">    | .     | [.]   |</span>
<span class="sd">    +-------+-------+</span>
<span class="sd">    | ?     |  .    |</span>
<span class="sd">    +-------+-------+</span>

<span class="sd">    Args:</span>
<span class="sd">        **expr**:</span>
<span class="sd">            A *glob* expression. The function relies on</span>
<span class="sd">            the caller and &#39;blindly&#39; assumes to process</span>
<span class="sd">            a glob.</span>

<span class="sd">        kargs:</span>
<span class="sd">            **spf**:</span>
<span class="sd">                The platform defining the syntax domain</span>
<span class="sd">                of *expr*.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The converted expression.</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">spf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">,</span> <span class="n">RTE</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">_glob_to_re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>
        <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># quotes</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,):</span>  <span class="c1"># exclusive classes</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s1">&#39;[^&#39;</span> <span class="o">+</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,):</span>  <span class="c1"># classes</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">12</span><span class="p">,):</span>  <span class="c1"># &#39;\\&#39;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">13</span><span class="p">,):</span>  <span class="c1"># &#39;\*&#39;</span>
            <span class="k">if</span> <span class="n">spf</span> <span class="o">==</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="s1">&#39;\.*&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># requires escaping when not wanted</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">14</span><span class="p">:</span>  <span class="c1"># &#39;*&#39;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s1">&#39;.*&#39;</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>  <span class="c1"># &#39;.&#39;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s1">&#39;[.]&#39;</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>  <span class="c1"># &#39;?&#39;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s1">&#39;.&#39;</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">17</span><span class="p">:</span>  <span class="c1"># &lt;any-char&gt;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">18</span><span class="p">:</span>  <span class="c1"># &#39;$&#39;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="splitre_separator"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.splitre_separator">[docs]</a><span class="k">def</span> <span class="nf">splitre_separator</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Splits a literal and/or wildcard expressions into it&#39;s</span>
<span class="sd">    directory items. This provides for intermediate file sets</span>
<span class="sd">    evaluated by directory-wise *glob* and *re*.</span>

<span class="sd">    Args:</span>
<span class="sd">        **expr**:</span>
<span class="sd">            expression to be split</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of partial wildcard expressions</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">_glob_prefix</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>
        <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span>   <span class="c1"># 1  - DOS drive</span>
                <span class="mi">2</span><span class="p">,</span>   <span class="c1"># class no sep</span>
                <span class="mi">3</span><span class="p">,</span>   <span class="c1"># class no sep</span>
                <span class="mi">4</span><span class="p">,</span>   <span class="c1"># [^/]</span>
                <span class="mi">9</span><span class="p">,</span>   <span class="c1"># group</span>
                <span class="mi">12</span><span class="p">,</span>  <span class="c1"># wildcard char with &#39;.*&#39;</span>
                <span class="mi">13</span><span class="p">,</span>  <span class="c1"># wildcard char</span>
                <span class="mi">14</span><span class="p">,</span>  <span class="c1"># any character until next back-slash - separator for posix</span>
                <span class="mi">15</span><span class="p">,</span>  <span class="c1"># any character until next back-slash - separator for win</span>
                <span class="mi">16</span><span class="p">,</span>  <span class="c1"># \[  basically a syntax error, but could be literal</span>
                <span class="mi">17</span><span class="p">,</span>  <span class="c1"># \]  basically a syntax error, but could be literal</span>
                <span class="mi">18</span><span class="p">,</span>  <span class="c1"># 17 - any literal character</span>
                <span class="mi">19</span><span class="p">,</span>
            <span class="p">):</span>
            <span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">10</span><span class="p">,</span>  <span class="c1"># free n*posix-sep</span>
                <span class="mi">11</span><span class="p">,</span>  <span class="c1"># free n*nt-sep</span>
            <span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="mi">5</span><span class="p">,</span>  <span class="c1"># class with posix-sep [/]</span>
                <span class="mi">6</span><span class="p">,</span>  <span class="c1"># class with posix-sep [/] only</span>
                <span class="mi">7</span><span class="p">,</span>  <span class="c1"># class with nt-sep only</span>
                <span class="mi">8</span><span class="p">,</span>  <span class="c1"># class with nt-sep</span>
            <span class="p">):</span>
            <span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="clearpath"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.clearpath">[docs]</a><span class="k">def</span> <span class="nf">clearpath</span><span class="p">(</span><span class="n">plist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clears, splits and joins a list of path variables by various criteria.</span>

<span class="sd">    Args:</span>
<span class="sd">        **plist**:</span>
<span class="sd">            List of paths to be cleared.</span>
<span class="sd">            See common options for details.</span>

<span class="sd">            default := sys.path</span>

<span class="sd">        kargs:</span>
<span class="sd">            **abs**:</span>
<span class="sd">                Converts all entries into absolute pathnames.</span>
<span class="sd">                This implies the activation of the options</span>
<span class="sd">                *shellvars* and *uservars*.</span>

<span class="sd">                default := False</span>

<span class="sd">            **existent**:</span>
<span class="sd">                Removes all existing items. For test</span>
<span class="sd">                and verification.</span>

<span class="sd">                default := False</span>

<span class="sd">            **nonexistent**:</span>
<span class="sd">                Removes all items which do not exist.</span>

<span class="sd">                default := False</span>

<span class="sd">            **nonredundant**:</span>
<span class="sd">                Removes all items which are not redundant.</span>
<span class="sd">                Results e.g. in multiple incarnations of the same</span>
<span class="sd">                file/path type.</span>

<span class="sd">                default := False</span>

<span class="sd">            **normpath**:</span>
<span class="sd">                Calls &#39;os.path.normpath&#39; on each result.</span>

<span class="sd">                default := False</span>

<span class="sd">            **redundant**:</span>
<span class="sd">                Clears all items from redundancies.</span>

<span class="sd">                default := True</span>

<span class="sd">            **rel**:</span>
<span class="sd">                Converts all entries into relative pathnames.</span>

<span class="sd">                default := False</span>

<span class="sd">            **reverse**:</span>
<span class="sd">                This reverses the resulting search order</span>
<span class="sd">                from bottom-up to top-down. Takes effect on</span>
<span class="sd">                &#39;redundant&#39; only.</span>

<span class="sd">                default := False</span>

<span class="sd">            **shellvars**:</span>
<span class="sd">                Replaces shell variables within pathnames. ::</span>

<span class="sd">                  $VAR, ${VAR}</span>
<span class="sd">                  %VAR%</span>

<span class="sd">                default := False</span>

<span class="sd">            **uservars**:</span>
<span class="sd">                Replaces special user variables as</span>
<span class="sd">                path-prefix. Currently support: ::</span>

<span class="sd">                  ~ (tilde)</span>
<span class="sd">                  $HOME, ${HOME}</span>
<span class="sd">                  %HOME%</span>

<span class="sd">                default := False</span>

<span class="sd">            **shrink**:</span>
<span class="sd">                Drops resulting empty items.</span>

<span class="sd">                default := True</span>

<span class="sd">            **split**:</span>
<span class="sd">                Forces split of multiple paths items within</span>
<span class="sd">                one item into separate item entries.</span>

<span class="sd">                default := True</span>

<span class="sd">            **stripquote**:</span>
<span class="sd">                Removes paired triple-quotes of protected/masked</span>
<span class="sd">                string sections. ::</span>

<span class="sd">                   &quot;/a/&#39;&#39;&#39;head:&#39;&#39;&#39;/c&quot; =&gt; &quot;/a/head:/c&quot;</span>

<span class="sd">                default := False</span>

<span class="sd">            **withinItemOnly**:</span>
<span class="sd">                Performs any action for each</span>
<span class="sd">                item of &#39;plist&#39; only.</span>

<span class="sd">                default := False</span>

<span class="sd">    Returns:</span>
<span class="sd">        When successful returns &#39;True&#39;, else returns either &#39;False&#39;,</span>
<span class="sd">        or raises an exception.</span>

<span class="sd">    Raises:</span>
<span class="sd">        passed through exceptions:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>

    <span class="c1"># _links = kargs.get(&#39;links&#39;, False)</span>

    <span class="n">_abs</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_existent</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;existent&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_ne</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nonexistent&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_normpath</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;normpath&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_nr</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nonredundant&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_redundant</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;redundant&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">_rel</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_reverse</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_shrink</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;shrink&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">_split</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;split&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">_user</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;uservars&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_vars</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;shellvars&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_wio</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;withinItemOnly&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_stripquote</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stripquote&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">clearIt</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the actual workhorse</span>

<span class="sd">        px:  patch to process</span>
<span class="sd">        ref: reference path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_abs</span><span class="p">:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">px</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_existent</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">px</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">_ne</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">px</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">_normpath</span><span class="p">:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">px</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_rel</span><span class="p">:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">getpythonpath_rel</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">plist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">px</span>

    <span class="k">def</span> <span class="nf">clrred</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;clear redundancies&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clearpath</span><span class="o">.</span><span class="n">_clearlst</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">clearpath</span><span class="o">.</span><span class="n">_clearlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="c1">#</span>
    <span class="c1"># --------------------------------------------</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_wio</span><span class="p">:</span>
        <span class="n">clearpath</span><span class="o">.</span><span class="n">_clearlst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pn</span> <span class="o">=</span> <span class="n">plist</span><span class="p">[:]</span>  <span class="c1"># input list</span>

    <span class="k">if</span> <span class="n">_reverse</span><span class="p">:</span>  <span class="c1"># revese input list</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plist</span><span class="p">)):</span>
        <span class="n">plist</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># clear source for new items - in place of caller</span>

    <span class="c1">#</span>
    <span class="c1"># split items into sub items as separate new items</span>
    <span class="k">if</span> <span class="n">_split</span><span class="p">:</span>
        <span class="n">_pn</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pn</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">px</span> <span class="ow">in</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                    <span class="n">_pn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">px</span><span class="p">)</span>
        <span class="n">pn</span> <span class="o">=</span> <span class="n">_pn</span>

    <span class="c1">#</span>
    <span class="c1"># work out items</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pn</span><span class="p">:</span>  <span class="c1"># each item</span>

        <span class="c1"># within item only</span>
        <span class="k">if</span> <span class="n">_wio</span><span class="p">:</span>
            <span class="n">clearpath</span><span class="o">.</span><span class="n">_clearlst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pn</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># reverse order</span>
        <span class="k">if</span> <span class="n">_reverse</span><span class="p">:</span>
            <span class="n">plx</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">stripquote</span><span class="o">=</span><span class="n">_stripquote</span><span class="p">)</span>
            <span class="n">plx</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plx</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">stripquote</span><span class="o">=</span><span class="n">_stripquote</span><span class="p">)</span>

        <span class="c1"># clear redundancies</span>
        <span class="k">for</span> <span class="n">p1</span> <span class="ow">in</span> <span class="n">plx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_vars</span> <span class="ow">or</span> <span class="n">_abs</span><span class="p">:</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_user</span> <span class="ow">or</span> <span class="n">_abs</span><span class="p">:</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_redundant</span><span class="p">:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">clrred</span><span class="p">(</span><span class="n">clearIt</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">clearIt</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_shrink</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">px</span><span class="p">:</span>
                    <span class="n">pn</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span> <span class="o">+</span> <span class="n">px</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">px</span><span class="p">:</span>
                    <span class="n">pn</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span> <span class="o">+</span> <span class="n">px</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pn</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span>

        <span class="k">if</span> <span class="n">pn</span><span class="p">:</span>
            <span class="n">pn</span> <span class="o">=</span> <span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">_reverse</span> <span class="ow">and</span> <span class="n">pn</span><span class="p">:</span>

            <span class="c1"># plx = pn.split(os.pathsep)</span>
            <span class="n">plx</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">pn</span><span class="p">,</span> <span class="n">stripquote</span><span class="o">=</span><span class="n">_stripquote</span><span class="p">)</span>
            <span class="n">plx</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="n">pn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plx</span><span class="p">)</span>

        <span class="c1"># shrink</span>
        <span class="k">if</span> <span class="n">_shrink</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pn</span><span class="p">:</span>
                <span class="n">plist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_reverse</span><span class="p">:</span>
        <span class="n">plist</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span></div>


<div class="viewcode-block" id="expandpath"><a class="viewcode-back" href="../../pathtools.html#filesysobjects.pathtools.expandpath">[docs]</a><span class="k">def</span> <span class="nf">expandpath</span><span class="p">(</span><span class="o">*</span><span class="n">paths</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Splits, expands and normalizes a list of paths and search paths.</span>

<span class="sd">    **REMINDER**: Non-existent path entries are dropped.</span>

<span class="sd">    The input list &#39;*\*paths*&#39; may contain mixed entries of:</span>

<span class="sd">    * search paths - combined by *os.pathsep*</span>
<span class="sd">    * wildcards-paths containing &#39;*literal*&#39;, &#39;*glob*&#39;, and &#39;*regexpr*&#39; parts</span>
<span class="sd">    * inserted user directory</span>
<span class="sd">    * inserted environment variables</span>
<span class="sd">    * file and directory paths</span>

<span class="sd">    The resulting normalized *list* contains in case of matches</span>
<span class="sd">    one path in each entry by the following algorithm.</span>

<span class="sd">    .. code-block:: text</span>

<span class="sd">       Expand contained:</span>

<span class="sd">       1. expand environment variables</span>
<span class="sd">       2. expand user directory</span>
<span class="sd">       3. check and use if exists, else continue</span>

<span class="sd">       If wildcards are selected continue with</span>

<span class="sd">       4. split and resolve paths and remove quotes - *stripquote*</span>
<span class="sd">       5. expand *literals* and *globs*</span>
<span class="sd">       6. expand *literals* and *regexpr*</span>

<span class="sd">    Args:</span>

<span class="sd">        **paths**:</span>
<span class="sd">            A list of paths and search paths to be expanded. For</span>
<span class="sd">            supported pattern of following table refer to parameter</span>
<span class="sd">            *wildcards*.</span>

<span class="sd">            +---------+--------------+-----------+---------+-----------+</span>
<span class="sd">            | type    | *W_LITERAL*  | *W_GLOB*  | *W_RE*  | *W_FULL*  |</span>
<span class="sd">            +=========+==============+===========+=========+===========+</span>
<span class="sd">            | literal | X            | X         | X       | X         |</span>
<span class="sd">            +---------+--------------+-----------+---------+-----------+</span>
<span class="sd">            | glob    |              | X         |         | X         |</span>
<span class="sd">            +---------+--------------+-----------+---------+-----------+</span>
<span class="sd">            | re      |              |           | X       | X         |</span>
<span class="sd">            +---------+--------------+-----------+---------+-----------+</span>

<span class="sd">            default := *W_RE*  # see parameter **wildcards**</span>

<span class="sd">        kargs:</span>

<span class="sd">            **dironly**:</span>
<span class="sd">                Contained file name paths are cut to their *dirname*. ::</span>

<span class="sd">                   expandvars := (True | False)</span>

<span class="sd">                default := *False*</span>

<span class="sd">            **expandvars**:</span>
<span class="sd">                Expand embedded environment variables. ::</span>

<span class="sd">                   expandvars := (True | False)</span>

<span class="sd">                default := True</span>

<span class="sd">            **expanduser**:</span>
<span class="sd">                Expand embedded user directories. ::</span>

<span class="sd">                   expandvars := (True | False)</span>

<span class="sd">                default := True</span>

<span class="sd">            **isDir**:</span>
<span class="sd">                Returns directories only.</span>

<span class="sd">                default := all</span>

<span class="sd">            **isFile**:</span>
<span class="sd">                Returns files only.</span>

<span class="sd">                default := all</span>

<span class="sd">            **nestclear**:</span>
<span class="sd">                Clear nested subdirectories ::</span>

<span class="sd">                   expandvars := (True | False)</span>

<span class="sd">                when *True*, e.g. ::</span>

<span class="sd">                   /a/b:/a/b/c::/a/b/c =&gt; /a/b</span>

<span class="sd">                default := *False*</span>

<span class="sd">            **regexprspandir**:</span>
<span class="sd">                Controls whether regexpr may span multiple</span>
<span class="sd">                directories, thus handling os.path.sep as</span>
<span class="sd">                ordinary chars.</span>

<span class="sd">                This in particular controls the technical</span>
<span class="sd">                implementation of the iterative path</span>
<span class="sd">                resolution for  paths by intermixed</span>
<span class="sd">                wildcards.</span>

<span class="sd">                * True:</span>

<span class="sd">                  The treatment of path seperators within</span>
<span class="sd">                  regexpr has to be assured by the caller.</span>

<span class="sd">                * False:</span>

<span class="sd">                  The regular experessions are resolved</span>
<span class="sd">                  in chunks seperated by the path seperator.</span>
<span class="sd">                  Thus each chunk is technically wrapped by</span>
<span class="sd">                  the re-module:</span>
<span class="sd">                  ::</span>

<span class="sd">                    &#39;&lt;regexpr&gt;&#39; + os.path.sep+&#39;$&#39;</span>

<span class="sd">            **strip**:</span>
<span class="sd">                Reduces by dropping redundancies. The strip parameter</span>
<span class="sd">                influences the match of regular expressions, which just</span>
<span class="sd">                do a pattern match, thus hit null-separator directories too.</span>
<span class="sd">                The strip of these prevents from unwanted matches on separator</span>
<span class="sd">                characters. ::</span>

<span class="sd">                   strip := (</span>
<span class="sd">                        True      # clear null-separators</span>
<span class="sd">                      | False     # no strip at all</span>
<span class="sd">                      | all       # clear any redundancy</span>
<span class="sd">                      | contain   # contained sub directories</span>
<span class="sd">                      | multiple  # multiple occurance</span>
<span class="sd">                   )</span>

<span class="sd">                default := True</span>

<span class="sd">            **spf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">            **wildcards**:</span>
<span class="sd">                Controls the type of path evaluation.</span>
<span class="sd">                Supported *paths* values types are: ::</span>

<span class="sd">                    wildcards := (</span>
<span class="sd">                        W_LITERAL      # literal existence check</span>
<span class="sd">                        | W_GLOB       # globs, contains W_LITERAL</span>
<span class="sd">                        | W_RE         # re, contains W_GLOB</span>
<span class="sd">                        | W_FULL       # re</span>
<span class="sd">                    )</span>

<span class="sd">                Expects mixed path names with *literals*, *globs*, and *regexpr*.</span>

<span class="sd">                default := *W_RE*</span>

<span class="sd">    Returns:</span>
<span class="sd">        In case of success a list with directory entries with</span>
<span class="sd">        splitted search paths. An empty list when no results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        PathToolsError</span>

<span class="sd">        pass-through</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">_dironly</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dironly&#39;</span><span class="p">)</span>
    <span class="n">_escape</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;escape&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_expanduser</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expanduser&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">_expandvars</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expandvars&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">_isdir</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isDir&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">_isfile</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isFile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">_nestclear</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nestclear&#39;</span><span class="p">)</span>
    <span class="n">_spf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">)</span>
    <span class="n">_splitglobregexpr</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;splitglobregexpr&#39;</span><span class="p">)</span>
    <span class="n">_tpf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">)</span>
    <span class="n">_wildcards</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wildcards&#39;</span><span class="p">,</span> <span class="n">W_RE</span><span class="p">)</span>

    <span class="n">_tsep</span><span class="p">,</span> <span class="n">_tpsep</span><span class="p">,</span> <span class="n">tpf</span><span class="p">,</span> <span class="n">_tpfn</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">filesysobjects</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">gettpf</span><span class="p">(</span><span class="n">_tpf</span><span class="p">)</span>

    <span class="c1"># TODO:</span>
    <span class="n">_strip</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strip&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_strip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;contain&#39;</span><span class="p">,</span> <span class="s1">&#39;multiple&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PathToolsError</span><span class="p">(</span><span class="s2">&quot;ERROR:Unknow param: strip=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_strip</span><span class="p">))</span>

    <span class="n">_pl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
    <span class="n">clearpath</span><span class="p">(</span><span class="n">_pl</span><span class="p">,</span> <span class="n">stripquote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_escape</span><span class="p">:</span>
        <span class="n">_pl</span> <span class="o">=</span> <span class="p">[</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_pl</span><span class="p">]</span>

    <span class="c1"># split search lists of contained multiple paths</span>
    <span class="n">_pl</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_plx</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="n">_plx</span> <span class="o">=</span> <span class="n">splitapppathx</span><span class="p">(</span><span class="n">_plx</span><span class="p">,</span> <span class="n">stripquote</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">_spf</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">)</span>
        <span class="n">_pl</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_plx</span><span class="p">)</span>

    <span class="n">clearpath</span><span class="p">(</span><span class="n">_pl</span><span class="p">,</span> <span class="n">stripquote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_escape</span><span class="p">:</span>
        <span class="n">_pl</span> <span class="o">=</span> <span class="p">[</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_pl</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">_pl</span><span class="p">:</span>  <span class="c1"># list of paths</span>
        <span class="c1">#</span>
        <span class="c1"># *** 1. expand environment variables</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">_expandvars</span><span class="p">:</span>
            <span class="n">pi</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># *** 2. expand user directory</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">_expanduser</span><span class="p">:</span>
            <span class="n">pi</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># 3. *** check and use if exists, else continue</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pi</span><span class="p">):</span>
            <span class="c1"># no need for search</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">_wildcards</span> <span class="o">==</span> <span class="n">W_LITERAL_QUOTED</span><span class="p">:</span>  <span class="c1"># literal with quotes</span>
            <span class="n">lppath</span> <span class="o">=</span> <span class="n">normapppathx</span><span class="p">(</span>
                    <span class="n">pi</span><span class="p">,</span> <span class="n">stripquote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">_spf</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">,</span>
                    <span class="n">delnulpsep</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lppath</span><span class="p">):</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lppath</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">_wildcards</span><span class="p">:</span>  <span class="c1"># requires recursive file system evaluation -&gt; performance degradation</span>

            <span class="c1">#</span>
            <span class="c1"># *** 4. split, strip and unquote</span>
            <span class="c1">#</span>
            <span class="n">lppath</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">splitapppathx</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">stripquote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">_spf</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">lppath</span><span class="p">):</span>
                <span class="n">_gr</span> <span class="o">=</span> <span class="n">split_re_glob</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">_ix</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="n">_gr</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="c1"># the non-glob-part for &#39;*-globbing&#39; and post-filtering</span>
                    <span class="n">_ix</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_gr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">_ind</span> <span class="o">=</span> <span class="n">lppath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">lppath</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">_ind</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">_ixx</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">_ix</span><span class="p">):</span>
                        <span class="n">lppath</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">_ind</span><span class="p">,</span> <span class="n">_ixx</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_strip</span><span class="p">:</span>
                        <span class="n">_ind</span> <span class="o">=</span> <span class="n">lppath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">_ind</span><span class="p">:</span>
                            <span class="c1"># first is root-slash</span>
                            <span class="n">lppath</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">_ind</span><span class="p">)</span>

            <span class="n">_idx</span> <span class="o">=</span> <span class="n">_lenppath</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lppath</span><span class="p">)</span>  <span class="c1"># abort endless recursion</span>

            <span class="c1">#</span>
            <span class="c1"># ** now we have the non-quoted effective path expression</span>
            <span class="c1">#</span>

            <span class="c1">#</span>
            <span class="c1"># *** 5. expand literals and globs</span>
            <span class="c1">#</span>
            <span class="n">pparts</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1">#: largest-glob</span>
            <span class="n">gparts</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="n">globtore</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">lppath</span><span class="p">:</span>
                <span class="c1"># re present</span>
                <span class="k">if</span> <span class="n">_gr</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="c1"># the glob part for explicit &#39;globbing&#39;</span>
                    <span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
                        <span class="n">pparts</span> <span class="o">=</span> <span class="n">_tsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_gr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pparts</span> <span class="o">=</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">_tsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_gr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="n">gparts</span> <span class="o">=</span> <span class="n">pparts</span>

            <span class="k">elif</span> <span class="n">_gr</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="c1"># glob only</span>
                <span class="k">if</span> <span class="n">_gr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
                        <span class="n">lppath</span> <span class="o">=</span> <span class="p">[</span><span class="n">_tsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_gr</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lppath</span> <span class="o">=</span> <span class="p">[</span><span class="n">_tsep</span> <span class="o">+</span> <span class="n">_tsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_gr</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lppath</span> <span class="o">=</span> <span class="p">[</span><span class="n">_tsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_gr</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

            <span class="c1">#</span>
            <span class="n">pparts</span> <span class="o">=</span> <span class="n">glob_to_re</span><span class="p">(</span><span class="n">pparts</span><span class="p">)</span>


            <span class="n">_search_set_next</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">px</span> <span class="ow">in</span> <span class="n">lppath</span><span class="p">:</span>  <span class="c1"># 3. expand literals and *globs* - walk the path top-down</span>
                <span class="n">_idx</span> <span class="o">-=</span> <span class="mi">1</span>

                <span class="c1"># includes Posix-netapp and MS-shares</span>
                <span class="k">if</span> <span class="n">px</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">_idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">_strip</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">pparts</span> <span class="o">==</span> <span class="n">_tsep</span> <span class="ow">and</span> <span class="n">px</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">_p</span> <span class="o">=</span> <span class="n">pparts</span> <span class="o">+</span> <span class="n">px</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">px</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                                <span class="n">_p</span> <span class="o">=</span> <span class="n">px</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">_p</span> <span class="o">=</span> <span class="n">pparts</span> <span class="o">+</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">px</span>
                        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                            <span class="n">_p</span> <span class="o">=</span> <span class="n">pparts</span> <span class="o">+</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">px</span>
                    <span class="k">elif</span> <span class="n">pparts</span><span class="p">:</span>
                        <span class="n">_p</span> <span class="o">=</span> <span class="n">pparts</span> <span class="o">+</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">px</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_p</span> <span class="o">=</span> <span class="n">px</span>

                <span class="k">if</span> <span class="n">_idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># make match criteria a bit stronger</span>
                    <span class="n">_p</span> <span class="o">+=</span> <span class="n">_tsep</span>

                <span class="k">if</span> <span class="n">_wildcards</span> <span class="o">&amp;</span> <span class="n">W_RE</span><span class="p">:</span>
                    <span class="c1"># try to resolve ambiguity between DSL, of e.g. [^x] and [!x]</span>
                    <span class="c1"># priority on W_RE here</span>
                    <span class="n">_subre</span> <span class="o">=</span> <span class="n">split_re_glob</span><span class="p">(</span><span class="n">_p</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">_debug</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DBG:subre = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_subre</span><span class="p">))</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_subre</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="c1"># glob/literal only</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># check match by glob for current path-part</span>
                            <span class="n">_lglob</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="n">_p</span><span class="p">)</span>  <span class="c1"># check only for a match</span>
                            <span class="n">_pi</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">_lglob</span><span class="p">)</span>  <span class="c1"># test a match</span>
                            <span class="n">pparts</span> <span class="o">=</span> <span class="n">_p</span>
                            <span class="n">gparts</span> <span class="o">=</span> <span class="n">_p</span>
                        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                            <span class="n">gparts</span> <span class="o">+=</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="s1">&#39;***&#39;</span>
                            <span class="n">_pi</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># found first segment that did not match</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># has *re*</span>
                        <span class="n">_head</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">_lpre</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_tsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_subre</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="k">for</span> <span class="n">chk</span>  <span class="ow">in</span> <span class="n">_subre</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">_lpre</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_tsep</span> <span class="o">+</span> <span class="n">chk</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">chk</span> <span class="ow">and</span> <span class="n">chk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,):</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">_head</span><span class="p">:</span>
                                    <span class="n">_head</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                        <span class="s1">&#39;WARNING:Leading wildcard without char for re:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                        <span class="p">)</span>

                                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                    <span class="s1">&#39;  -&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span>
                                    <span class="o">%</span><span class="p">(</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">_p</span><span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">_lpre</span> <span class="o">+</span> <span class="s1">&#39;^</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                        <span class="c1"># has a non-glob/non-literal postfix, so search and filter</span>
                        <span class="n">gparts</span> <span class="o">+=</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="s1">&#39;***&#39;</span>
                        <span class="n">_pi</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># found first segment that did not match</span>

                    <span class="n">pparts</span> <span class="o">+=</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">px</span>

                    <span class="k">if</span> <span class="n">_pi</span><span class="p">:</span>  <span class="c1"># current segment is literal part of the path</span>
                        <span class="k">if</span> <span class="n">_idx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if current set are leafs</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_pi</span><span class="p">)</span>  <span class="c1"># add checked leaf</span>
                            <span class="k">for</span> <span class="n">_lg</span> <span class="ow">in</span> <span class="n">_lglob</span><span class="p">:</span>  <span class="c1"># collect remaining leafs</span>
                                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_lg</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>  <span class="c1"># check match by glob for current path-part</span>
                        <span class="n">_lglob</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="n">_p</span><span class="p">)</span>  <span class="c1"># check only for a match</span>
                        <span class="n">_pi</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">_lglob</span><span class="p">)</span>  <span class="c1"># test a match</span>
                        <span class="n">pparts</span> <span class="o">=</span> <span class="n">_p</span>

                        <span class="n">gparts</span> <span class="o">=</span> <span class="n">_p</span>
                    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                        <span class="n">gparts</span> <span class="o">+=</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="s1">&#39;***&#39;</span>
                        <span class="n">_pi</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># found first segment that did not match</span>

                    <span class="k">if</span> <span class="n">_pi</span><span class="p">:</span>  <span class="c1"># current segment is literal part of the path</span>
                        <span class="k">if</span> <span class="n">_idx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if current set are leafs</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_pi</span><span class="p">)</span>  <span class="c1"># add checked leaf</span>
                            <span class="k">for</span> <span class="n">_lg</span> <span class="ow">in</span> <span class="n">_lglob</span><span class="p">:</span>  <span class="c1"># collect remaining leafs</span>
                                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_lg</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">_wildcards</span> <span class="o">&amp;</span> <span class="n">W_RE</span><span class="p">:</span>  <span class="c1"># current level is possibly matched by expansion</span>
                    <span class="c1"># entering next level of expansion</span>

                    <span class="c1">#</span>
                    <span class="c1"># *** 6. expand regexpr</span>
                    <span class="c1">#</span>
                    <span class="n">_s</span> <span class="o">=</span> <span class="n">_search_set_next</span><span class="p">[:]</span> <span class="c1"># use search set from previous - if there</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">_sext</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">gparts</span><span class="p">)</span>  <span class="c1"># expand globs for post matching of re</span>
                        <span class="n">_s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_sext</span><span class="p">)</span>  <span class="c1"># current roundexpanded</span>
                    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                        <span class="k">pass</span>

                    <span class="k">if</span> <span class="n">gparts</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;***&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">px</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">px</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[.]&#39;</span><span class="p">)):</span>  <span class="c1"># is shifted glob for re</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">_sext</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">gparts</span><span class="p">)</span> <span class="o">+</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span>
                            <span class="n">_s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_sext</span><span class="p">)</span>  <span class="c1"># current round expanded</span>
                        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                            <span class="k">pass</span>


                    <span class="n">_search_set_next</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># prepare next round</span>
                    <span class="n">matched</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">_s</span><span class="p">:</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">_tpfn</span> <span class="o">&amp;</span> <span class="n">RTE</span><span class="p">:</span>
                            <span class="n">z</span> <span class="o">=</span> <span class="n">normpathx</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpfn</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">pparts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">r&#39;$&#39;</span><span class="p">:</span>
                            <span class="n">a</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">pparts</span> <span class="o">+</span> <span class="s1">r&#39;$&#39;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">a</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">pparts</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">_debug</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DBG:current-raw = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DBG:current-esc = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DBG:regexpr     = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">_debug</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DBG:current-raw = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DBG:matched by  = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pparts</span><span class="p">))</span>

                        <span class="n">_search_set</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># pick up first search subset</span>
                        <span class="k">while</span> <span class="n">_search_set</span><span class="p">:</span>
                            <span class="n">p0</span> <span class="o">=</span> <span class="n">_search_set</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># next item from search list</span>
                            <span class="n">p0d</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>  <span class="c1"># parent node for appending re</span>
                            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">p0</span><span class="p">):</span>  <span class="c1"># nothing more to traverse</span>
                                <span class="c1"># it is a potential regexpr</span>
                                <span class="c1"># try to search for paths matching the LHS-part of</span>
                                <span class="c1"># the maximum of the remaining path by regexpr</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">_pat</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">p0d</span> <span class="o">+</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">px</span> <span class="o">+</span> <span class="s1">r&#39;$&#39;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                    <span class="n">_pat</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">_pat</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">charback</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_pat</span><span class="p">,</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>

                                        <span class="k">if</span> <span class="n">_debug</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DBG:res[i] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p0</span><span class="p">))</span>

                                        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
                                        <span class="n">matched</span> <span class="o">=</span> <span class="kc">True</span>

                                <span class="k">except</span> <span class="n">sre_constants</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="n">e</span><span class="o">.</span><span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">compile-error:</span><span class="se">\n</span><span class="s1"> in: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">     </span><span class="si">%s</span><span class="s1">^</span><span class="se">\n</span><span class="s1">  =&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                            <span class="nb">str</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">p0d</span> <span class="o">+</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">px</span> <span class="o">+</span> <span class="s1">r&#39;$&#39;</span><span class="p">)),</span>
                                            <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                            <span class="nb">str</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">p0d</span> <span class="o">+</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">px</span> <span class="o">+</span> <span class="s1">r&#39;$&#39;</span><span class="p">)[:</span><span class="n">e</span><span class="o">.</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                                        <span class="p">)</span>
                                        <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
                                <span class="k">continue</span>

                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">_pat</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">p0d</span> <span class="o">+</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">px</span> <span class="o">+</span> <span class="s1">r&#39;$&#39;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="n">_pat</span> <span class="o">=</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">_pat</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">charback</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_pat</span><span class="p">,</span> <span class="n">escapepathx</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>  <span class="c1"># check re match</span>
                                    <span class="k">if</span> <span class="n">_idx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># it&#39;s a leaf</span>
                                        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
                                        <span class="n">matched</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># intermediate branch, set it for next round</span>
                                        <span class="n">_search_set_next</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>

                            <span class="k">except</span> <span class="n">sre_constants</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">e</span><span class="o">.</span><span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">compile-error:</span><span class="se">\n</span><span class="s1"> in: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">     </span><span class="si">%s</span><span class="s1">^</span><span class="se">\n</span><span class="s1">  =&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">p0d</span> <span class="o">+</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">px</span> <span class="o">+</span> <span class="s1">r&#39;$&#39;</span><span class="p">)),</span>
                                        <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">p0d</span> <span class="o">+</span> <span class="n">_tsep</span> <span class="o">+</span> <span class="n">px</span> <span class="o">+</span> <span class="s1">r&#39;$&#39;</span><span class="p">)[:</span><span class="n">e</span><span class="o">.</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="p">)</span>
                                    <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">matched</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_search_set_next</span><span class="p">:</span>
                        <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># literal W_LITERAL</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pi</span><span class="p">):</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>

    <span class="c1"># normalize the result</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">filesysobjects</span><span class="o">.</span><span class="n">apppaths</span><span class="o">.</span><span class="n">normpathx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="n">_tpf</span><span class="p">,)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>

    <span class="c1"># TODO: add app and glob/re-support</span>
    <span class="k">if</span> <span class="n">_dironly</span><span class="p">:</span>
        <span class="n">_tpfn</span> <span class="o">=</span> <span class="n">filesysobjects</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">gettpf</span><span class="p">(</span><span class="n">_tpf</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">_tpfn</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">ntpath</span>
            <span class="k">for</span> <span class="n">rx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_tsep</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">]):</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">],</span> <span class="n">_tpf</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">]:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">_tpfn</span> <span class="o">&amp;</span> <span class="n">RTE_POSIX</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">posixpath</span>
            <span class="k">for</span> <span class="n">rx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">]):</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">]</span> <span class="o">=</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">]:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">]):</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">]</span> <span class="o">=</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">])</span>
                <span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">[</span><span class="n">rx</span><span class="p">]:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>

    <span class="c1"># TODO: integrate into the algorithm</span>
    <span class="k">if</span> <span class="n">_isdir</span> <span class="ow">or</span> <span class="n">_isfile</span><span class="p">:</span>
        <span class="n">_res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_isdir</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                <span class="n">_res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">_isfile</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                <span class="n">_res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_res</span>

    <span class="k">return</span> <span class="n">res</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/pyfilesysobjects-64x64.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">filesysobjects 0.1.34 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../filesysobjects.html" >filesysobjects</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2018, Arno-Can Uestuensoez.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>