<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>filesysobjects.paths &mdash; filesysobjects 0.1.34 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.34',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="filesysobjects 0.1.34 documentation" href="../../index.html" />
    <link rel="up" title="filesysobjects" href="../filesysobjects.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">filesysobjects 0.1.34 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../filesysobjects.html" accesskey="U">filesysobjects</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for filesysobjects.paths</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;The &#39;filesysobjects.paths&#39; module provides operations on static file</span>
<span class="sd">resource paths.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sre_constants</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">posixpath</span>
<span class="kn">import</span> <span class="nn">ntpath</span>

<span class="kn">from</span> <span class="nn">filesysobjects</span> <span class="k">import</span> <span class="n">PathError</span><span class="p">,</span> \
    <span class="n">ISSTR</span><span class="p">,</span> \
    <span class="n">gettpf</span><span class="p">,</span> <span class="n">getspf</span><span class="p">,</span> \
    <span class="n">rte2num</span><span class="p">,</span> <span class="n">rte_map</span><span class="p">,</span> \
    <span class="n">V3K</span><span class="p">,</span> <span class="n">RTE</span><span class="p">,</span> <span class="n">RTE_POSIX</span><span class="p">,</span> <span class="n">RTE_WIN32</span><span class="p">,</span> <span class="n">FileSysObjectsError</span><span class="p">,</span> \
    <span class="n">RTE_LOCAL</span><span class="p">,</span> <span class="n">RTE_CNP</span><span class="p">,</span> <span class="n">RTE_CNW</span><span class="p">,</span> \
    <span class="n">RTE_FILEURI0</span><span class="p">,</span> <span class="n">RTE_FILEURI4</span><span class="p">,</span> <span class="n">RTE_FILEURI5</span><span class="p">,</span> <span class="n">RTE_FILEURI</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Arno-Can Uestuensoez&#39;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;Artistic-License-2.0 + Forced-Fairplay-Constraints&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) 2010-2016 Arno-Can Uestuensoez&quot;</span> \
                <span class="s2">&quot;@Ingenieurbuero Arno-Can Uestuensoez&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.1.20&#39;</span>
<span class="n">__uuid__</span> <span class="o">=</span> <span class="s2">&quot;4135ab0f-fbb8-45a2-a6b1-80d96c164b72&quot;</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s2">&quot;restructuredtext en&quot;</span>

<span class="c1">#</span>
<span class="c1"># for test and development</span>
<span class="c1"># _mydebug = False</span>

<span class="c1">#*</span>
<span class="c1"># *** static compiled strings ***</span>
<span class="c1">#*</span>

<span class="c1"># pathname seperator</span>
<span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
    <span class="n">OSSEP</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>  <span class="c1">#: os separator</span>
    <span class="n">OSSEPCLS</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="se">\\\\</span><span class="s1">]&#39;</span>  <span class="c1">#: character class os separator</span>
    <span class="n">OSSEPCLSN</span> <span class="o">=</span> <span class="s1">&#39;[^</span><span class="se">\\\\</span><span class="s1">]&#39;</span>  <span class="c1">#: character class without separator</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">OSSEP</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>  <span class="c1">#: os separator</span>
    <span class="n">OSSEPCLS</span> <span class="o">=</span> <span class="s1">&#39;[/]&#39;</span>  <span class="c1">#: character class os separator</span>
    <span class="n">OSSEPCLSN</span> <span class="o">=</span> <span class="s1">&#39;[^/]&#39;</span>  <span class="c1">#: character class without separator</span>

<span class="n">rebaseflags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">X</span>  <span class="c1"># @UndefinedVariable</span>
<span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
    <span class="n">rebaseflags</span> <span class="o">|=</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span>  <span class="c1"># @UndefinedVariable</span>

<span class="c1">#</span>
<span class="c1"># prohibited characters for optional validation - see strict options</span>
<span class="c1">#</span>
<span class="n">INVALIDCHARSWIN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;[:&lt;&gt;*?]&#39;</span><span class="p">)</span>  <span class="c1">#: windows</span>
<span class="n">INVALIDCHARSPOSIX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;\0&#39;</span><span class="p">)</span>  <span class="c1">#: posix</span>
<span class="n">INVALIDCHARS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;[:&lt;&gt;*?\0]&#39;</span><span class="p">)</span>  <span class="c1">#: super position of both</span>

<span class="c1">#: maps unambiguous escape characters to escape sequences</span>
<span class="n">ESC_CHAR_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;</span><span class="se">\a</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">a&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\b</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\f</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">f&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">r&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">t&quot;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\v</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">v&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">#: list of special escape characters</span>
<span class="n">ESC_CHARS</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="se">\a\b\f\n\r\t\v</span><span class="s1">]&#39;</span>

<span class="c1">#: maps escape characters for escape sequences to unescape</span>
<span class="n">UNESC_CHAR_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\a</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\f</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\v</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># pylint: disable-msg=W0105</span>

<span class="c1"># [MS-DTYP] - 2.2.57 - UNC definitions</span>
<span class="c1"># pchar = %x20-21 / %x23-29 / %x2D-2E / %x30-39 / %x40-5A / %x5E-7B / %x7D-FF</span>
<span class="c1"># pchar = r&#39;[\x20-\x21\x23-\x29\x2D-\x2E\x30-\x39\x40-\x5A\x5E-\x7B\x7D-\xFF]&#39;</span>
<span class="c1"># pchar=&quot;&quot;&quot;[^\x00-\x1f\x22\x2a-\x2c\x2f\x3a-\x3f\x5b-\x5d\x7c]&quot;&quot;&quot;</span>

<span class="c1">#</span>
<span class="c1"># *** splits environment variables ***</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="n">RTE</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
    <span class="n">_ENV_SPLIT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;&quot;&quot;</span>
<span class="s2">       (</span>
<span class="s2">           (([^%]*?)([%][a-zA-Z0-9_]+[%]))           # 2: defined without brace</span>
<span class="s2">         | (([^%]*?)([%][a-zA-Z0-9_]+[^%]?))         # 5: ERROR:</span>
<span class="s2">         | ((.*)())                                  # 8: any</span>
<span class="s2">       )</span>
<span class="s2">       &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">rebaseflags</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Split-out environment variables for substitution.&quot;&quot;&quot;</span>

    <span class="n">_ENV_SPLITg</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="sd">&quot;&quot;&quot;Entry points into sub strings environment variables and literals.&quot;&quot;&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_ENV_SPLIT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;&quot;&quot;</span>
<span class="s2">       (</span>
<span class="s2">           (([^$]*?)([$][{][a-zA-Z0-9_]+[}]))        # 2: defined with brace</span>
<span class="s2">         | (([^$]*?)([$][a-zA-Z0-9_]+[;]?))          # 5: defined without brace</span>
<span class="s2">         | (([^$]*?)([$][{][a-zA-Z0-9_]+[^}]?))      # 8: ERROR:</span>
<span class="s2">         | ((.*)())                                  # 11: any</span>
<span class="s2">       )</span>
<span class="s2">       &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">rebaseflags</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Split-out environment variables for substitution.&quot;&quot;&quot;</span>

    <span class="n">_ENV_SPLITg</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">2</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">,</span>
        <span class="mi">11</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="sd">&quot;&quot;&quot;Entry points into sub strings environment variables and literals.&quot;&quot;&quot;</span>

<span class="c1"># pylint: enable-msg=W0105</span>
<span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
    <span class="n">pathflags</span> <span class="o">=</span> <span class="n">rebaseflags</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span>  <span class="c1"># @UndefinedVariable</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">pathflags</span> <span class="o">=</span> <span class="n">rebaseflags</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span>  <span class="c1"># @UndefinedVariable</span>

<span class="c1">#: First stage regexpr scanner for &#39;normpathx&#39;, also used in &#39;escapepathx&#39;.</span>
<span class="n">PATHSCANNER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;&quot;&quot;</span>
<span class="s2">    ([&quot;]</span><span class="si">{3}</span><span class="s2">[\x01-\xFF]*?[&quot;]</span><span class="si">{3}</span><span class="s2">)       # 1  quoted string by 3 double quotes(&quot;) - similar to Python</span>
<span class="s2">    |([&#39;]</span><span class="si">{3}</span><span class="s2">[\x01-\xFF]*?[&#39;]</span><span class="si">{3}</span><span class="s2">)      # 2  quoted string by 3 single quotes(&#39;) - similar to Python</span>
<span class="s2">    |([\a\b\f\n\r\t\v])               # 3  python escape char - without separate backslash</span>
<span class="s2">    |(?&lt;=[^\\\\]){0,1}([\\\\][u][0-9]</span><span class="si">{4}</span><span class="s2">)</span>
<span class="s2">                                      # 4  unicode-16</span>
<span class="s2">    |(?&lt;=[^\\\\]){0,1}([\\\\][U][0-9]</span><span class="si">{8}</span><span class="s2">)</span>
<span class="s2">                                      # 5  unicode-32</span>
<span class="s2">    |^(file://[/]{0,1}[/\\\\]</span><span class="si">{2}</span><span class="s2">)(?![/\\\\])</span>
<span class="s2">                                      # 6  share/netapp - rfc8089, [MS-DTYP]</span>

<span class="s2">    |^(file://)(?![/\\\\])            # 7  non-local - rfc8089 / maps to Posix-App</span>
<span class="s2">    |^(file:)(?=/[^/\\\\])            # 8  min - rfc8089</span>
<span class="s2">    |^(file://)(?=/)                  # 9  absolute path - rfc8089 rfc1738</span>
<span class="s2">    |^(file:)(?=[a-zA-Z]:)            # 10 short-form - rfc8089 - DOS drive</span>

<span class="s2">    |^(//)(?=[^\\\\/&quot;]+[\\\\/][\x20-\x21\x23-\x29\x2D-\x2E\x30-\x39\x40-\x5A\x5E-\x7B\x7D-\xFF]{1,80}[\\\\/]*)</span>
<span class="s2">                                      # 11 portable UNC</span>

<span class="s2">    |^(//)(?=[^/\\\\][^/]*/.+)        # 12 pure posix - with the additional constraint first != [/\\]</span>
<span class="s2">    |^([\\\\][\\\\])(?=[^\\\\/&quot;]+[\\\\/][\x20-\x21\x23-\x29\x2D-\x2E\x30-\x39\x40-\x5A\x5E-\x7B\x7D-\xFF]{1,80}[\\\\/]*)</span>
<span class="s2">                                      # 13 UNC</span>

<span class="s2">    |^([a-zA-Z]:)(?=\\a|\\b|\\f|\\n|\\r|\\t|\\v)</span>
<span class="s2">                                      # 14 drive following escaped special escape character</span>

<span class="s2">    |^([a-zA-Z]:[\\\\]+)(?![\a\b\f\n\r\t\v])</span>
<span class="s2">                                      # 15 drive following 1..n * &#39;[\\]&#39;</span>
<span class="s2">    |^([a-zA-Z]:[/]+)                 # 16 drive following 1..n * &#39;[/]&#39;</span>
<span class="s2">    |^([a-zA-Z]:)                     # 17 drive only, or relative path</span>
<span class="s2">    |(?&lt;=[;:])([a-zA-Z]:[\\\\]+)      # 18 drive following 1..n * &#39;[\\]&#39;</span>
<span class="s2">    |(?&lt;=[;:])([a-zA-Z]:[/]+)         # 19 drive following 1..n * &#39;[/]&#39;</span>

<span class="s2">    |(?&lt;=[;:])([a-zA-Z]:)             # 20 drive only, or relative path</span>
<span class="s2">    |(?&lt;=[\\\\])([/]+)                # 21 os. sep - posix pathname separators</span>
<span class="s2">    |(/+)(?=/)                        # 22 n * posix dir-separators</span>
<span class="s2">    |(/)                              # 23 1 * posix dir-separators</span>
<span class="s2">    |(?&lt;=[\\\\/])([.][.][\\\\/])      # 24 &#39;up-dir: /../ &#39;</span>
<span class="s2">    |^([.][.][\\\\/]+)                # 25 &#39;up-dir: ^../ &#39;</span>
<span class="s2">    |(?&lt;=[\\\\/])([.][.])$            # 26 &#39;up-dir: /..$ &#39;</span>

<span class="s2">    |(?&lt;=[/\\\\])([.][/\\\\])         # 27 &#39;null-dir: \.\ /./&#39;</span>
<span class="s2">    |^([.][/\\\\]+)                   # 28 &#39;null-dir: .\ ./&#39;</span>
<span class="s2">    |(?&lt;=[/\\\\])([.])$               # 29 &#39;null-dir: \. /.&#39;</span>

<span class="s2">    |([\\\\][\\\\])                   # 30 bs pairs</span>
<span class="s2">    |([\\\\])(?=\n)                   # 31 single bs - escape &#39;\n&#39;</span>
<span class="s2">    |([\\\\])(?=\n)                   # 32 single bs - escape &#39;\n&#39;</span>
<span class="s2">    |([\\\\])(?![\\\\])               # 33 single bs - non-escape</span>
<span class="s2">    |([:]+)                           # 34 posix path-separators</span>
<span class="s2">    |([;]+)                           # 35 win path-separators</span>
<span class="s2">    |(?&lt;![^\\\\][\\\\])(\[)           # 36 start char class</span>
<span class="s2">    |(?&lt;![^\\\\][\\\\])(\])           # 37 end char class</span>
<span class="s2">    |(?&lt;![^\\\\][\\\\])(&#39;)            # 38 escaped &#39;</span>
<span class="s2">    |(?&lt;![^\\\\][\\\\])(&quot;)            # 39 escaped &quot;</span>
<span class="s2">    |([^\\\\/\a\b\f\n\r\t\v:;&quot;&#39;\[\]]+)# 40</span>
<span class="s2">    |([^\\\\/\a\b\f\n\r\t\v:;]+)(?!.*[&quot;&#39;\[\]])</span>
<span class="s2">                                      # 41</span>
<span class="s2">    |(.)                              # 42 # free char</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">pathflags</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># map matches to actual control sequences</span>
<span class="c1">#</span>
<span class="n">SC_BSPAIR</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># &#39;\&#39; pair</span>
<span class="n">SC_CIFS</span> <span class="o">=</span> <span class="mi">1010</span>  <span class="c1"># cifs:</span>
<span class="n">SC_CRMASK</span> <span class="o">=</span> <span class="mi">1020</span>  <span class="c1"># masked &#39;\n&#39;</span>
<span class="n">SC_DOIT</span> <span class="o">=</span> <span class="mi">1030</span>  <span class="c1"># out of range</span>
<span class="n">SC_DQUOTED</span> <span class="o">=</span> <span class="mi">1040</span>  <span class="c1"># &quot;</span>
<span class="n">SC_DRIVE</span> <span class="o">=</span> <span class="mi">1050</span>  <span class="c1"># dos drive letter - or a directory on Posix !!!</span>
<span class="n">SC_DRIVENPSEP</span> <span class="o">=</span> <span class="mi">1060</span>  <span class="c1"># dos drive letter following n * posix_sep</span>
<span class="n">SC_DRIVENWSEP</span> <span class="o">=</span> <span class="mi">1070</span>  <span class="c1"># dos drive letter following n * win_sep</span>
<span class="n">SC_DUMMY</span> <span class="o">=</span> <span class="mi">1080</span>  <span class="c1"># dummy</span>
<span class="n">SC_EACHOF</span> <span class="o">=</span> <span class="mi">1090</span>  <span class="c1"># assure for each</span>
<span class="n">SC_ESCCHAR</span> <span class="o">=</span> <span class="mi">1100</span>  <span class="c1"># \[abf...]</span>
<span class="n">SC_FABS</span> <span class="o">=</span> <span class="mi">1110</span>  <span class="c1"># file:///path - absolute path - rfc8089 rfc1738</span>
<span class="n">SC_FILE</span> <span class="o">=</span> <span class="mi">1120</span>  <span class="c1"># file:</span>
<span class="n">SC_FMIN</span> <span class="o">=</span> <span class="mi">1130</span>  <span class="c1"># file:/path - min rfc8089 - Appendix B</span>
<span class="n">SC_FNONLOCAL</span> <span class="o">=</span> <span class="mi">1140</span>  <span class="c1"># file://host/path  non-local - rfc8089 - Appendix B / maps to Posix-App</span>
<span class="n">SC_FSHORT</span><span class="o">=</span> <span class="mi">1150</span>  <span class="c1"># file:&lt;dos-drive&gt;:path - short-form - rfc8089</span>
<span class="n">SC_FUNC</span> <span class="o">=</span> <span class="mi">1160</span>  <span class="c1"># file:///// | file://// - share/netapp - rfc8089 - Appendix E.3.2</span>
<span class="n">SC_HTTP</span> <span class="o">=</span> <span class="mi">1170</span>  <span class="c1"># http:</span>
<span class="n">SC_KEEP</span> <span class="o">=</span> <span class="mi">1180</span>  <span class="c1"># keep literally</span>
<span class="n">SC_MASKALL</span> <span class="o">=</span> <span class="mi">1190</span>  <span class="c1"># keep literally</span>
<span class="n">SC_NULLDIR</span> <span class="o">=</span> <span class="mi">1200</span>  <span class="c1"># &#39;\.\&#39; &#39;/./&#39;</span>
<span class="n">SC_PAPP</span> <span class="o">=</span> <span class="mi">1210</span>  <span class="c1"># Posix-Net-App</span>
<span class="n">SC_PDOM</span> <span class="o">=</span> <span class="mi">1220</span>  <span class="c1"># Posix-Net-App prefix-compliance to SC_WDOM [MS-DTY]</span>
<span class="n">SC_PSEPP</span> <span class="o">=</span> <span class="mi">1230</span>  <span class="c1"># &#39;:&#39;</span>
<span class="n">SC_PSEPW</span> <span class="o">=</span> <span class="mi">1240</span>  <span class="c1"># &#39;;&#39;</span>
<span class="n">SC_REPLACE</span> <span class="o">=</span> <span class="mi">1250</span>  <span class="c1"># replace an equal set of chars e.g. &#39;/&#39; or &#39;\&#39;</span>
<span class="n">SC_SEPP</span> <span class="o">=</span> <span class="mi">1260</span>  <span class="c1"># n * Posix path.sep</span>
<span class="n">SC_SEPW</span> <span class="o">=</span> <span class="mi">1270</span>  <span class="c1"># 1 * win path.sep</span>
<span class="n">SC_SLASH</span> <span class="o">=</span> <span class="mi">1280</span>  <span class="c1"># 1 * &#39;/&#39;</span>
<span class="n">SC_SLASHPREB</span> <span class="o">=</span> <span class="mi">1290</span>  <span class="c1"># &#39;\&#39; + &#39;/&#39;</span>
<span class="n">SC_SMB</span> <span class="o">=</span> <span class="mi">1300</span>  <span class="c1"># smb:</span>
<span class="n">SC_SQUOTED</span> <span class="o">=</span> <span class="mi">1310</span>  <span class="c1"># &#39;</span>
<span class="n">SC_TOEVEN</span> <span class="o">=</span> <span class="mi">1320</span>  <span class="c1"># assure count is even</span>
<span class="n">SC_U16</span> <span class="o">=</span> <span class="mi">1330</span>  <span class="c1"># unicode-16</span>
<span class="n">SC_U16R</span> <span class="o">=</span> <span class="mi">1340</span>  <span class="c1"># unicode-16 raw</span>
<span class="n">SC_U32</span> <span class="o">=</span> <span class="mi">1350</span>  <span class="c1"># unicode-32</span>
<span class="n">SC_U32R</span> <span class="o">=</span> <span class="mi">1360</span>  <span class="c1"># unicode-32 raw</span>
<span class="n">SC_UNC</span> <span class="o">=</span> <span class="mi">1370</span>  <span class="c1"># unc:</span>
<span class="n">SC_UPDIR</span> <span class="o">=</span> <span class="mi">1380</span>  <span class="c1"># &#39;/../&#39;</span>
<span class="n">SC_WDOM</span> <span class="o">=</span> <span class="mi">1390</span>  <span class="c1"># Win-Domain</span>
<span class="n">SC_CHRCLSSTART</span> <span class="o">=</span> <span class="mi">1400</span>
<span class="n">SC_CHRCLSEND</span> <span class="o">=</span> <span class="mi">1410</span>
<span class="n">SC_ANYONECHR</span> <span class="o">=</span> <span class="mi">1420</span>
<span class="n">SC_ESCAPEDSQUOT</span> <span class="o">=</span> <span class="mi">1430</span>
<span class="n">SC_ESCAPEDDQUOT</span> <span class="o">=</span> <span class="mi">1440</span>


<span class="c1">#: Context maps of item indexes corresponding to group indexes onto constants.</span>
<span class="c1">#: Performance enhancement by padding, in order to avoid hash calculations via a dictionary.</span>
<span class="n">ASCII_SC_CTRL</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">0</span><span class="p">,</span>  <span class="c1"># all by *re*</span>
    <span class="n">SC_DQUOTED</span><span class="p">,</span>      <span class="c1"># 1  string</span>
    <span class="n">SC_SQUOTED</span><span class="p">,</span>      <span class="c1"># 2  string</span>
    <span class="n">SC_ESCCHAR</span><span class="p">,</span>      <span class="c1"># 3  python escape sequences</span>
    <span class="n">SC_U16</span><span class="p">,</span>          <span class="c1"># 4  unicode-16</span>
    <span class="n">SC_U32</span><span class="p">,</span>          <span class="c1"># 5  unicode-32</span>

    <span class="n">SC_FUNC</span> <span class="p">,</span>        <span class="c1"># 6  file:///// | file://// - share/netapp - rfc8089 - Appendix E.3.2</span>
    <span class="n">SC_FNONLOCAL</span><span class="p">,</span>    <span class="c1"># 7  rfc8089 - Appendix B</span>
    <span class="n">SC_FMIN</span><span class="p">,</span>         <span class="c1"># 8  rfc8089 - Appendix B</span>
    <span class="n">SC_FABS</span><span class="p">,</span>         <span class="c1"># 9  absolute path- rfc8089, rfc1738</span>
    <span class="n">SC_FSHORT</span><span class="p">,</span>       <span class="c1"># 10 short-form - rfc8089</span>

    <span class="n">SC_PDOM</span><span class="p">,</span>         <span class="c1"># 11  &#39;//&#39; - UNC-Compatible</span>
    <span class="n">SC_PAPP</span><span class="p">,</span>         <span class="c1"># 12 &#39;//&#39; - pure POSIX compliance</span>
    <span class="n">SC_WDOM</span><span class="p">,</span>         <span class="c1"># 13 &#39;\\\\&#39;</span>

    <span class="n">SC_DRIVE</span><span class="p">,</span>        <span class="c1"># 14  DOS drive letter - no following sep</span>

    <span class="n">SC_DRIVENWSEP</span><span class="p">,</span>   <span class="c1"># 15  DOS drive letter with n * win_sep</span>
    <span class="n">SC_DRIVENPSEP</span><span class="p">,</span>   <span class="c1"># 16  DOS drive letter with n * possix_sep</span>

    <span class="n">SC_DRIVE</span><span class="p">,</span>        <span class="c1"># 17  DOS drive letter - no following sep</span>

    <span class="n">SC_DRIVENWSEP</span><span class="p">,</span>   <span class="c1"># 18 DOS drive letter with n * win_sep</span>
    <span class="n">SC_DRIVENPSEP</span><span class="p">,</span>   <span class="c1"># 19 DOS drive letter with n * posix_sep</span>

    <span class="n">SC_DRIVE</span><span class="p">,</span>        <span class="c1"># 20 DOS drive letter - no following sep</span>
    <span class="n">SC_SLASHPREB</span><span class="p">,</span>    <span class="c1"># 21 &#39;\/&#39;</span>
    <span class="n">SC_SEPP</span><span class="p">,</span>         <span class="c1"># 22 n * &#39;/&#39;</span>
    <span class="n">SC_SLASH</span><span class="p">,</span>        <span class="c1"># 23 1 * &#39;/&#39;</span>
    <span class="n">SC_UPDIR</span><span class="p">,</span>        <span class="c1"># 24 &#39;updir/..&#39;</span>
    <span class="n">SC_UPDIR</span><span class="p">,</span>        <span class="c1"># 25 &#39;updir/..&#39;</span>
    <span class="n">SC_UPDIR</span><span class="p">,</span>        <span class="c1"># 26 &#39;updir/..&#39;</span>

    <span class="n">SC_NULLDIR</span><span class="p">,</span>      <span class="c1"># 27 &#39;nulldir/.&#39;</span>
    <span class="n">SC_NULLDIR</span><span class="p">,</span>      <span class="c1"># 28 &#39;nulldir/.&#39;</span>
    <span class="n">SC_NULLDIR</span><span class="p">,</span>      <span class="c1"># 29 &#39;nulldir/.&#39;</span>

    <span class="n">SC_BSPAIR</span><span class="p">,</span>       <span class="c1"># 30 a &#39;\&#39; pair of 1..n</span>
    <span class="n">SC_CRMASK</span><span class="p">,</span>       <span class="c1"># 31 a masked &lt;CR&gt; - r&#39;\\n&#39;, else difficult to detect by regexpr</span>
    <span class="n">SC_CRMASK</span><span class="p">,</span>       <span class="c1"># 32 same as SC_CRMASK, but raw - &#39;\\n&#39;,</span>
    <span class="n">SC_SEPW</span><span class="p">,</span>         <span class="c1"># 33 &#39;\\&#39;,</span>
    <span class="n">SC_PSEPP</span><span class="p">,</span>        <span class="c1"># 34 &#39;:&#39;,</span>
    <span class="n">SC_PSEPW</span><span class="p">,</span>        <span class="c1"># 35 &#39;;&#39;,</span>
    <span class="n">SC_CHRCLSSTART</span><span class="p">,</span>  <span class="c1"># 36</span>
    <span class="n">SC_CHRCLSEND</span><span class="p">,</span>    <span class="c1"># 37</span>
    <span class="n">SC_ESCAPEDSQUOT</span><span class="p">,</span> <span class="c1"># 38</span>
    <span class="n">SC_ESCAPEDDQUOT</span><span class="p">,</span> <span class="c1"># 39</span>
    <span class="n">SC_DOIT</span><span class="p">,</span>         <span class="c1"># 40</span>
    <span class="n">SC_DOIT</span><span class="p">,</span>         <span class="c1"># 41</span>
    <span class="n">SC_DOIT</span><span class="p">,</span>         <span class="c1"># 42</span>
<span class="p">]</span>
<span class="c1">#: Checks for contained dot-directory names in paths, controls parser mode.</span>
<span class="n">_NULLDIRS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s1">r&#39;.*([/</span><span class="se">\\\\</span><span class="s1">][.]{1,2}[/</span><span class="se">\\\\</span><span class="s1">]|[/</span><span class="se">\\\\</span><span class="s1">][.][.]$|^[.][.][/</span><span class="se">\\\\</span><span class="s1">])&#39;</span><span class="p">)</span>

<span class="n">_file_uri_scheme</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="s1">&#39;file&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="s1">&#39;file&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>  <span class="s1">&#39;file&#39;</span><span class="p">,</span>
    <span class="s1">&#39;//&#39;</span><span class="p">:</span>  <span class="s1">&#39;netapp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">:</span>  <span class="s1">&#39;netapp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fileuri&#39;</span><span class="p">:</span>  <span class="s1">&#39;file://&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fileuri0&#39;</span><span class="p">:</span> <span class="s1">&#39;file:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fileuri4&#39;</span><span class="p">:</span> <span class="s1">&#39;file:///&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fileuri5&#39;</span><span class="p">:</span> <span class="s1">&#39;file:////&#39;</span><span class="p">,</span>
    <span class="n">RTE_FILEURI0</span><span class="p">:</span> <span class="s1">&#39;file:&#39;</span><span class="p">,</span>
    <span class="n">RTE_FILEURI4</span><span class="p">:</span> <span class="s1">&#39;file:///&#39;</span><span class="p">,</span>
    <span class="n">RTE_FILEURI5</span><span class="p">:</span> <span class="s1">&#39;file:////&#39;</span><span class="p">,</span>
    <span class="n">RTE_FILEURI</span><span class="p">:</span> <span class="s1">&#39;file://&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">_file_uri_scheme_num</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fileuri&#39;</span><span class="p">:</span>  <span class="n">RTE_FILEURI</span><span class="p">,</span>
    <span class="s1">&#39;fileuri0&#39;</span><span class="p">:</span> <span class="n">RTE_FILEURI0</span><span class="p">,</span>
    <span class="s1">&#39;fileuri4&#39;</span><span class="p">:</span> <span class="n">RTE_FILEURI4</span><span class="p">,</span>
    <span class="s1">&#39;fileuri5&#39;</span><span class="p">:</span> <span class="n">RTE_FILEURI5</span><span class="p">,</span>
    <span class="n">RTE_FILEURI0</span><span class="p">:</span> <span class="n">RTE_FILEURI0</span><span class="p">,</span>
    <span class="n">RTE_FILEURI4</span><span class="p">:</span> <span class="n">RTE_FILEURI4</span><span class="p">,</span>
    <span class="n">RTE_FILEURI5</span><span class="p">:</span> <span class="n">RTE_FILEURI5</span><span class="p">,</span>
    <span class="n">RTE_FILEURI</span><span class="p">:</span> <span class="n">RTE_FILEURI</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">_get_lead_sep</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;(/*|[</span><span class="se">\\\\</span><span class="s1">]*)&#39;</span><span class="p">)</span>


<span class="c1">#: short scanner for unescape</span>
<span class="n">PATHSCANNER_UNESC</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;&quot;&quot;</span>
<span class="s2">    ([&quot;]</span><span class="si">{3}</span><span class="s2">[\x01-\xFF]*?[&quot;]</span><span class="si">{3}</span><span class="s2">)       #  1  quoted string by 3 double quotes(&quot;) - similar to Python</span>
<span class="s2">    |([&#39;]</span><span class="si">{3}</span><span class="s2">[\x01-\xFF]*?[&#39;]</span><span class="si">{3}</span><span class="s2">)      #  2  quoted string by 3 single quotes(&#39;) - similar to Python</span>

<span class="s2">    |(?&lt;=[\\\\])([\a\b\f\n\r\t\v])    #  3  python escape char with leading backslash</span>
<span class="s2">    |(?&lt;=[^\\\\])([\\u][0-9]</span><span class="si">{4}</span><span class="s2">)      #  4  unicode-16</span>
<span class="s2">    |(?&lt;=[^\\\\])([\\U][0-9]</span><span class="si">{8}</span><span class="s2">)      #  5  unicode-32</span>
<span class="s2">    |^([\\\\][\\\\])(?=[^\\\\/&quot;]+[\\\\/][\x20-\x21\x23-\x29\x2D-\x2E\x30-\x39\x40-\x5A\x5E-\x7B\x7D-\xFF]{1,80}[\\\\/]*)</span>
<span class="s2">                                      #  6 UNC</span>
<span class="s2">    |([\\\\][abfnrtv])                #  7  python escaped char with leading backslash</span>
<span class="s2">    |([\\\\][\\\\])(?![abfnrtvuU])    #  8 bs pairs - free - not escaping</span>
<span class="s2">    |([\\\\][\\\\][abfnrtvuU])        #  9 bs pairs - escaping an escape char</span>
<span class="s2">    |([\\\\])(?![\\\\])               # 10 single bs - non-escape</span>
<span class="s2">    |([\\\\][&#39;])                      # 11 special escapes - POSIX + Windows</span>
<span class="s2">    |([\\\\][&quot;])                      # 12 special escapes - POSIX only (+ URI ?)</span>
<span class="s2">    |(?&lt;![^\\\\][\\\\])(\[)           # 13 start char class</span>
<span class="s2">    |(?&lt;![^\\\\][\\\\])(\])           # 14 end char class</span>
<span class="s2">    |([^\\\\/\a\b\f\n\r\t\v:;&quot;&#39;\[\]]+)# 15</span>
<span class="s2">    |([^\\\\/\a\b\f\n\r\t\v:;]+)(?!.*[&quot;&#39;\[\]])</span>
<span class="s2">                                      # 16</span>
<span class="s2">    |(.)                              # 17 # free char</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">pathflags</span><span class="p">)</span>

<div class="viewcode-block" id="sub_keep"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.sub_keep">[docs]</a><span class="k">def</span> <span class="nf">sub_keep</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">RTE</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pathsep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;To be used by re.sub() - keeps mixed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>  <span class="c1"># PATHSCANNER ASCII_SC_CTRL</span>
    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
        <span class="c1">#        x = it.group(g)</span>
        <span class="c1">#         c = ASCII_SC_CTRL[g]</span>
        <span class="c1">#         if ASCII_SC_REPLACE_KEEP[g] == SC_KEEP:</span>
        <span class="c1">#             pass</span>
        <span class="c1">#        return x</span>

        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span></div>


<span class="n">_esc_state_shared</span> <span class="o">=</span> <span class="p">[]</span>
<div class="viewcode-block" id="sub_esc"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.sub_esc">[docs]</a><span class="k">def</span> <span class="nf">sub_esc</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">RTE</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pathsep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">_esc_state_shared</span><span class="p">,</span>  <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;To be used by re.sub() - escapes backslashes and non-printable</span>
<span class="sd">    characters.</span>

<span class="sd">    Args:</span>
<span class="sd">        **it**:</span>
<span class="sd">            iterator from *re.sub*.</span>

<span class="sd">        **spf**:</span>
<span class="sd">            Source platform, defines the input syntax domain.</span>
<span class="sd">            For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">            For additi0onal details refer to</span>
<span class="sd">            :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">            `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">            :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">            `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">        **strip**:</span>

<span class="sd">        **pathsep**:</span>

<span class="sd">        **state**:</span>

<span class="sd">        kw:</span>
<span class="sd">            **charback**:</span>
<span class="sd">                Escapes all backslashes within character classes.</span>
<span class="sd">                Could be combined with *force* and *freeback*.</span>

<span class="sd">            **force**:</span>
<span class="sd">                Escapes all back-slashes, else the special</span>
<span class="sd">                characters only. Unix processing of DOS paths</span>
<span class="sd">                requires all separators to be escaped.</span>

<span class="sd">                default := False</span>

<span class="sd">            **freeback**:</span>
<span class="sd">                Escapes backslashes outside character classes.</span>
<span class="sd">                Could be combined with *charback*.</span>

<span class="sd">    Returns:</span>

<span class="sd">        Converted format win.</span>
<span class="sd">        E.g. ::</span>

<span class="sd">           C:\\Windows\\system32\\cmd.exe;C:\\Windows\\system32\\notepad.exe</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_all</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span> <span class="c1"># old - temporary for migration</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_all</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">_charback</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;charback&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">_freeback</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;freeback&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>  <span class="c1"># PATHSCANNER ASCII_SC_CTRL</span>
    <span class="n">_le</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ASCII_SC_CTRL</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>

        <span class="c1"># FIXME: check for null-dir on &#39;win&#39;</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_BSPAIR</span><span class="p">:</span>  <span class="c1"># pairs of &#39;\\&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_all</span><span class="p">:</span>  <span class="c1"># escape anything - blindly</span>
                    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
                <span class="k">elif</span> <span class="n">_freeback</span><span class="p">:</span>  <span class="c1"># free standing only</span>
                    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
            <span class="k">elif</span> <span class="n">_charback</span><span class="p">:</span>  <span class="c1"># within character classes only</span>
                <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSSTART</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># char class start</span>
            <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSEND</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># char class end</span>
            <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span>
            <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                <span class="n">state</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)):</span>
                        <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">r</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_SEPW</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># 1 * &#39;\&#39; - win treats &#39;/&#39; equal</span>
<span class="c1">#             if _all and not state:  # escape anything - blindly</span>
<span class="c1">#                 return 2 * x</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_all</span><span class="p">:</span>  <span class="c1"># escape anything - blindly</span>
                    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
                <span class="k">elif</span> <span class="n">_freeback</span><span class="p">:</span>  <span class="c1"># free standing only</span>
                    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
            <span class="k">elif</span> <span class="n">_charback</span><span class="p">:</span>  <span class="c1"># within character classes only</span>
                <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_WDOM</span><span class="p">,</span> <span class="p">):</span>
<span class="c1">#             if _all and not state:  # escape anything - blindly</span>
<span class="c1">#                 return 2 * x</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_all</span><span class="p">:</span>  <span class="c1"># escape anything - blindly</span>
                    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
                <span class="k">elif</span> <span class="n">_freeback</span><span class="p">:</span>  <span class="c1"># free standing only</span>
                    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
            <span class="k">elif</span> <span class="n">_charback</span><span class="p">:</span>  <span class="c1"># within character classes only</span>
                <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_DRIVENWSEP</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_all</span> <span class="p">:</span>  <span class="c1"># escape anything - blindly</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_ESCCHAR</span><span class="p">,</span> <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ESC_CHAR_MAP</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CRMASK</span><span class="p">,</span> <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_NULLDIR</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
                <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
                <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">29</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">x</span>

        <span class="k">return</span> <span class="n">x</span></div>


<span class="n">_unesc_state_shared</span> <span class="o">=</span> <span class="p">[]</span>
<div class="viewcode-block" id="sub_unesc"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.sub_unesc">[docs]</a><span class="k">def</span> <span class="nf">sub_unesc</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">_unesc_state_shared</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;To be used by re.sub() - unescapes backslashes and</span>
<span class="sd">    non-printable characters.</span>

<span class="sd">    Args:</span>
<span class="sd">        **it**:</span>
<span class="sd">            iterator from *re.sub*.</span>

<span class="sd">        **_t**:</span>

<span class="sd">        **spf**:</span>
<span class="sd">            Source platform, defines the input syntax domain.</span>
<span class="sd">            For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">            For additi0onal details refer to</span>
<span class="sd">            :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">            `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">            :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">            `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">        **state***:</span>

<span class="sd">        kw:</span>
<span class="sd">            **all** or **force**:</span>
<span class="sd">                Unescapes all back/slashes, else the special</span>
<span class="sd">                characters only. Unix processing of DOS paths</span>
<span class="sd">                requires all separators to be escaped and</span>
<span class="sd">                therefore eventually to be unescaped too.</span>

<span class="sd">                default := False</span>

<span class="sd">    Returns:</span>

<span class="sd">        Converted format win.</span>
<span class="sd">        E.g.::</span>

<span class="sd">           C:\\Windows\\system32\\cmd.exe;C:\\Windows\\system32\\notepad.exe</span>

<span class="sd">    Raises:</span>

<span class="sd">        pass-through</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_all</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span> <span class="c1"># old - temporary for migration</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_all</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>  <span class="c1"># PATHRULES ASCII_SC_CTRL</span>
    <span class="n">_le</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_all</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_all</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>  <span class="c1"># escaped special char &#39;\\[ab....]&#39;</span>
            <span class="k">return</span> <span class="n">UNESC_CHAR_MAP</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># free pairs of &#39;\\&#39; - non/escaping</span>
            <span class="k">if</span> <span class="n">_all</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>  <span class="c1"># single &#39;\&#39; following escaped char &#39;\[ab....]&#39;</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>  <span class="c1"># escaped &#39;</span>
            <span class="k">if</span> <span class="n">_all</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>  <span class="c1"># escaped &quot;</span>
            <span class="k">if</span> <span class="n">_all</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">state</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">x</span></div>


<div class="viewcode-block" id="sub_posix"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.sub_posix">[docs]</a><span class="k">def</span> <span class="nf">sub_posix</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">RTE</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pathsep</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;To be used by re.sub() - converts to posix.</span>

<span class="sd">    Replaces &#39;[/\\]&#39; with &#39;/&#39;, and &#39;[;:]&#39; with &#39;:&#39;.</span>

<span class="sd">    Posix does not have drives, just ignores the</span>
<span class="sd">    drive-property, assumes these are ordinary characters.</span>
<span class="sd">    When drives are required as syntax tokens refer to &#39;Cygwin&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        **it**:</span>
<span class="sd">            Iterator from *re.sub*.</span>

<span class="sd">        **spf**:</span>
<span class="sd">            Source platform, defines the input syntax domain.</span>
<span class="sd">            For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">            For additi0onal details refer to</span>
<span class="sd">            :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">            `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">            :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">            `normpathx() &lt;paths.html#normpathx&gt;`_.</span>


<span class="sd">        **strip**:</span>
<span class="sd">            Strip redundancies.</span>

<span class="sd">        **pathsep**:</span>
<span class="sd">            Input separator &#39;pathsep&#39; to be be</span>
<span class="sd">            replaced. ::</span>

<span class="sd">               pathsep := &#39;:&#39; &#39;;&#39; &#39;&#39;</span>

<span class="sd">            One or more are allowed, is used as a set</span>
<span class="sd">            containment of replacement checks. Empty</span>
<span class="sd">            string disables the replacement.</span>

<span class="sd">        **state**:</span>
<span class="sd">            Compile states.</span>

<span class="sd">        kw:</span>
<span class="sd">           **apppre**:</span>
<span class="sd">               Application prefix.</span>

<span class="sd">           **keepsep**:</span>
<span class="sd">               Keeps seprator, in particular the trailing.</span>

<span class="sd">           **stripquote**:</span>
<span class="sd">               Strips *filesysobjects* triple-quotes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Converted format posix.</span>
<span class="sd">        E.g.::</span>

<span class="sd">           c:/Windows/system32/cmd.exe:c:/Windows/system32/notepad.exe</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">apppre</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">keepsep</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keepsep&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">stripquote</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stripquote&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># tracks multiple path separators, when these are of mixed</span>
    <span class="c1"># platforms(&#39;/&#39;, &#39;\&#39;) to be normalized</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># ignores character classes</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">inchrclass</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inchrclass</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1">#</span>
    <span class="c1"># frequently used values</span>
    <span class="c1">#</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>  <span class="c1"># PATHSCANNER ASCII_SC_CTRL</span>
    <span class="n">_le</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">_isfirst</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">_islast</span> <span class="o">=</span> <span class="n">_le</span> <span class="o">==</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span>
    <span class="n">_charbefore</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ASCII_SC_CTRL</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSSTART</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># char class start</span>
            <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSEND</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># char class end</span>
            <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">inchrclass</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DQUOTED</span><span class="p">,</span> <span class="n">SC_SQUOTED</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">stripquote</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DQUOTED</span><span class="p">,</span> <span class="n">SC_SQUOTED</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">stripquote</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_BSPAIR</span><span class="p">:</span>  <span class="c1"># pairs of &#39;\\&#39;</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

                <span class="n">_pre</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_pre</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>  <span class="c1"># already done</span>
                    <span class="k">if</span> <span class="n">sx</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">_pre</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                <span class="k">elif</span> <span class="n">_islast</span> <span class="ow">or</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">keepsep</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                <span class="k">elif</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;\/&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                        <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SLASH</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_isfirst</span> <span class="ow">and</span> <span class="n">_islast</span><span class="p">):</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                <span class="k">elif</span> <span class="n">_islast</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">keepsep</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_isfirst</span> <span class="ow">or</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">keepsep</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SLASHPREB</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sx</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SEPP</span><span class="p">:</span>  <span class="c1"># n * &#39;/&#39;</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_isfirst</span> <span class="ow">or</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                    <span class="n">sx</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SEPW</span><span class="p">:</span>  <span class="c1"># n * &#39;/&#39;</span>

            <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>  <span class="c1"># is app-pre &#39;//&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

            <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_islast</span> <span class="ow">or</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">sx</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span> <span class="o">&gt;</span> <span class="n">_le</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span> <span class="o">&gt;</span> <span class="n">_le</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_PSEPP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>  <span class="c1"># 1..n</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_islast</span><span class="p">:</span>  <span class="c1"># drop trailing os.pathsep</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;:&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;:&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_PSEPW</span><span class="p">:</span>
            <span class="c1"># native</span>
            <span class="k">return</span> <span class="n">x</span>

            <span class="c1"># mixed</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>  <span class="c1"># 1..n</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">if</span> <span class="n">spf</span> <span class="o">&amp;</span> <span class="n">RTE_POSIX</span><span class="p">:</span>  <span class="c1"># for posix node names an ordinary character</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_islast</span><span class="p">:</span>  <span class="c1"># drop trailing os.pathsep</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">return</span> <span class="s1">&#39;:&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;:&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_FUNC</span><span class="p">,):</span>  <span class="c1"># verified by char contents</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;file://///&#39;</span>
            <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">SC_UPDIR</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;../&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">SC_FNONLOCAL</span><span class="p">:</span>  <span class="c1"># verified by char contents</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;file://&#39;</span>
            <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_FMIN</span><span class="p">,</span> <span class="n">SC_FABS</span><span class="p">,</span> <span class="n">SC_FSHORT</span><span class="p">,):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_WDOM</span><span class="p">,</span> <span class="n">SC_PDOM</span><span class="p">,</span> <span class="n">SC_PAPP</span><span class="p">,):</span>  <span class="c1"># verified by char contents</span>
            <span class="k">if</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">elif</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">_islast</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DRIVENPSEP</span><span class="p">,</span> <span class="n">SC_DRIVENWSEP</span><span class="p">):</span>  <span class="c1"># posix does not have drives</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>  <span class="c1"># keep drive-root</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:/&#39;</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_DRIVE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_NULLDIR</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_FILE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_UNC</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

        <span class="k">return</span> <span class="n">x</span></div>


<span class="k">def</span> <span class="nf">sub_uri</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">RTE</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pathsep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;To be used by re.sub() - converts to uri.</span>

<span class="sd">    Args:</span>
<span class="sd">        **it**:</span>
<span class="sd">            Iterator from *re.sub*.</span>

<span class="sd">        **spf**:</span>
<span class="sd">            Source platform, defines the input syntax domain.</span>
<span class="sd">            For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">            For additi0onal details refer to</span>
<span class="sd">            :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">            `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">            :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">            `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">        **strip**:</span>
<span class="sd">            Strip redundancies.</span>

<span class="sd">        **pathsep**:</span>
<span class="sd">            Input separator &#39;pathsep&#39; to be be</span>
<span class="sd">            replaced. ::</span>

<span class="sd">               pathsep := &#39;:&#39; &#39;;&#39; &#39;&#39;</span>

<span class="sd">            One or more are allowed, is used as a set</span>
<span class="sd">            containment of replacement checks. Empty</span>
<span class="sd">            string disables the replacement.</span>

<span class="sd">        kw:</span>
<span class="sd">           **apppre**:</span>
<span class="sd">               Application prefix.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Converted format uri.</span>
<span class="sd">        E.g.::</span>

<span class="sd">           http://a/b/c</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">apppre</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>  <span class="c1"># PATHRULES ASCII_SC_CTRL</span>
    <span class="n">_le</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ASCII_SC_CTRL</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_BSPAIR</span><span class="p">:</span>  <span class="c1"># pairs of &#39;\\&#39;</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#                     if it.string[it.end(g)] in &#39;/\\&#39;:</span>
                    <span class="c1">#                         return &#39;/&#39;</span>
                    <span class="c1">#                     return &#39;//&#39;</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>  <span class="c1"># already done</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>  <span class="c1"># want to reduce by look-ahead</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="c1"># FIXME: a.s.a.p.</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">_le</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                    <span class="c1"># FIXME: a.s.a.p.</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">_le</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SLASH</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SLASHPREB</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SEPP</span><span class="p">:</span>  <span class="c1"># n * &#39;/&#39;</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SEPW</span><span class="p">:</span>  <span class="c1"># n * &#39;/&#39;</span>
            <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># is app-pre &#39;//&#39;</span>
                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;//&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="c1"># is app-pre &#39;//&#39;</span>
                <span class="k">elif</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># 2SEP has own rules</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="n">_le</span> <span class="ow">and</span> <span class="n">_le</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># do not &#39;/&#39;</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_PSEPP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>  <span class="c1"># 1..n</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="n">_le</span><span class="p">:</span>  <span class="c1"># drop trailing os.pathsep</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">return</span> <span class="s1">&#39;:&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;:&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_PSEPW</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>  <span class="c1"># 1..n</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">if</span> <span class="n">spf</span> <span class="o">&amp;</span> <span class="n">RTE_POSIX</span><span class="p">:</span>  <span class="c1"># for posix node names an ordinary character</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="n">_le</span><span class="p">:</span>  <span class="c1"># do not drop trailing &#39;/&#39;</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">return</span> <span class="s1">&#39;:&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;:&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_PAPP</span><span class="p">,</span> <span class="n">SC_WDOM</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DRIVENPSEP</span><span class="p">,</span> <span class="n">SC_DRIVENWSEP</span><span class="p">):</span>  <span class="c1"># posix does not have drives</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>  <span class="c1"># keep drive-root</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:/&#39;</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">SC_UPDIR</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;../&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_DRIVE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_NULLDIR</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_FILE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_UNC</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

        <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">sub_rfc8089</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">RTE</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pathsep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;To be used by re.sub() - converts to file uri in accordance to RFC8089.</span>
<span class="sd">    This is different from most of common URI, e.g. HTTP(S).</span>

<span class="sd">    Args:</span>
<span class="sd">        **it**:</span>
<span class="sd">            Iterator from *re.sub*.</span>

<span class="sd">        **spf**:</span>
<span class="sd">            Source platform, defines the input syntax domain.</span>
<span class="sd">            For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">            For additi0onal details refer to</span>
<span class="sd">            :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">            `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">            :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">            `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">        **strip**:</span>
<span class="sd">            Strip redundancies.</span>

<span class="sd">        **pathsep**:</span>
<span class="sd">            Input separator &#39;pathsep&#39; to be be</span>
<span class="sd">            replaced. ::</span>

<span class="sd">               pathsep := &#39;:&#39; &#39;;&#39; &#39;&#39;</span>

<span class="sd">            One or more are allowed, is used as a set</span>
<span class="sd">            containment of replacement checks. Empty</span>
<span class="sd">            string disables the replacement.</span>

<span class="sd">        **state**:</span>
<span class="sd">            Compile states.</span>

<span class="sd">        kw:</span>
<span class="sd">            **apppre**:</span>
<span class="sd">                Application prefix.</span>

<span class="sd">            **keepsep**:</span>
<span class="sd">                Keeps the trailing separator. ::</span>

<span class="sd">                   keepsep := (</span>
<span class="sd">                         True    # keep trailing sep, indicating a directory</span>
<span class="sd">                       | False   # drop trailing sep</span>
<span class="sd">                   )</span>

<span class="sd">           **stripquote**:</span>
<span class="sd">               Strips *filesysobjects* triple-quotes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Converted format uri.</span>
<span class="sd">        E.g.::</span>

<span class="sd">           http://a/b/c</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">apppre</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">keepsep</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keepsep&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">stripquote</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stripquote&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># tracks multiple path separators, when these are of mixed</span>
    <span class="c1"># platforms(&#39;/&#39;, &#39;\&#39;) to be normalized</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># ignores character classes</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">inchrclass</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inchrclass</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1">#</span>
    <span class="c1"># frequently used values</span>
    <span class="c1">#</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>  <span class="c1"># PATHSCANNER ASCII_SC_CTRL</span>
    <span class="n">_le</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">_isfirst</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">_islast</span> <span class="o">=</span> <span class="n">_le</span> <span class="o">==</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span>
    <span class="n">_charbefore</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ASCII_SC_CTRL</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSSTART</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># char class start</span>
            <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSEND</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># char class end</span>
            <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">inchrclass</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DQUOTED</span><span class="p">,</span> <span class="n">SC_SQUOTED</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">stripquote</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_BSPAIR</span><span class="p">:</span>  <span class="c1"># pairs of &#39;\\&#39;</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

                <span class="n">_pre</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_pre</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>  <span class="c1"># already done</span>
                    <span class="k">if</span> <span class="n">sx</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">_pre</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                <span class="k">elif</span> <span class="n">_islast</span> <span class="ow">or</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">keepsep</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                <span class="k">elif</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;\/&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                        <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

<span class="c1">#             if strip:</span>
<span class="c1">#                 if it.start(g) == 0:</span>
<span class="c1">#                     #                     if it.string[it.end(g)] in &#39;/\\&#39;:</span>
<span class="c1">#                     #                         return &#39;/&#39;</span>
<span class="c1">#                     #                     return &#39;//&#39;</span>
<span class="c1">#                     return &#39;/&#39;</span>
<span class="c1">#</span>
<span class="c1">#                 if it.string[it.start(g) - 1] in &#39;/\\&#39;:  # already done</span>
<span class="c1">#                     return &#39;&#39;</span>
<span class="c1">#                 elif len(it.string) &gt; _le:</span>
<span class="c1">#                     return &#39;/&#39;</span>
<span class="c1">#             else:</span>
<span class="c1">#                 return &#39;//&#39;</span>
<span class="c1">#</span>
<span class="c1">#             if strip:  # want to reduce by look-ahead</span>
<span class="c1">#                 if len(it.string) &gt; _le and it.string[_le] == &#39;\\&#39;:</span>
<span class="c1">#                     # FIXME: a.s.a.p.</span>
<span class="c1">#                     if it.string.find(&#39;\\&#39;, _le) &lt; len(it.string) - 1:</span>
<span class="c1">#                         return &#39;&#39;</span>
<span class="c1">#                 elif len(it.string) &gt; _le and it.string[_le] == &#39;/&#39;:</span>
<span class="c1">#                     # FIXME: a.s.a.p.</span>
<span class="c1">#                     if it.string.find(&#39;/&#39;, _le) &lt; len(it.string) - 1:</span>
<span class="c1">#                         return &#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#                 return &#39;/&#39;</span>
<span class="c1">#             else:</span>
<span class="c1">#                 return &#39;//&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SLASH</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_isfirst</span> <span class="ow">and</span> <span class="n">_islast</span><span class="p">):</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                <span class="k">elif</span> <span class="n">_islast</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">keepsep</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_isfirst</span> <span class="ow">or</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">keepsep</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SLASHPREB</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sx</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">x</span>
<span class="c1">#             if strip:</span>
<span class="c1">#                 return &#39;&#39;</span>
<span class="c1">#             return x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SEPP</span><span class="p">:</span>  <span class="c1"># n * &#39;/&#39;</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_isfirst</span> <span class="ow">or</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                    <span class="n">sx</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">#             if strip:</span>
<span class="c1">#                 return &#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#             else:</span>
<span class="c1">#                 return &#39;/&#39; * len(x)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SEPW</span><span class="p">:</span>  <span class="c1"># n * &#39;/&#39;</span>
            <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>  <span class="c1"># is app-pre &#39;//&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

            <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_islast</span> <span class="ow">or</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">sx</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span> <span class="o">&gt;</span> <span class="n">_le</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span> <span class="o">&gt;</span> <span class="n">_le</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
<span class="c1">#             if it.start(g) == 0:  # is app-pre &#39;//&#39;</span>
<span class="c1">#                 if it.start(g) &gt; 1:</span>
<span class="c1">#                     return &#39;//&#39;</span>
<span class="c1">#                 return &#39;/&#39;</span>
<span class="c1">#             if strip:</span>
<span class="c1">#                 if it.string[it.start(g) - 1] in &#39;/\\&#39;:</span>
<span class="c1">#                     return &#39;&#39;</span>
<span class="c1">#                 # is app-pre &#39;//&#39;</span>
<span class="c1">#                 elif it.start(g) == 1 and it.string[0] in (&#39;/&#39;, &#39;\\&#39;):</span>
<span class="c1">#                     return &#39;&#39;  # 2SEP has own rules</span>
<span class="c1">#</span>
<span class="c1">#                 if len(it.string) == _le and _le &gt; 1:  # do not &#39;/&#39;</span>
<span class="c1">#                     return &#39;/&#39;</span>
<span class="c1">#</span>
<span class="c1">#             if len(it.string) &gt; _le:</span>
<span class="c1">#                 if it.string[_le] == &#39;\\&#39;:</span>
<span class="c1">#                     if len(it.string) &gt; _le + 1 and it.string[_le + 1] == &#39;\n&#39;:</span>
<span class="c1">#                         pass</span>
<span class="c1">#                     else:</span>
<span class="c1">#                         if strip:</span>
<span class="c1">#                             return &#39;&#39;</span>
<span class="c1">#                 return &#39;/&#39;</span>
<span class="c1">#</span>
<span class="c1">#             if strip:</span>
<span class="c1">#                 return &#39;/&#39;</span>
<span class="c1">#             else:</span>
<span class="c1">#                 return &#39;/&#39; * len(x)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_PSEPP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>  <span class="c1"># 1..n</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_islast</span><span class="p">:</span>  <span class="c1"># drop trailing os.pathsep</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;:&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;:&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">#             if x[0] not in pathsep:  # 1..n</span>
<span class="c1">#                 return x</span>
<span class="c1">#</span>
<span class="c1">#             if strip:</span>
<span class="c1">#                 if len(it.string) == _le:  # drop trailing os.pathsep</span>
<span class="c1">#                     return &#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#                 if len(it.string) &gt; _le:</span>
<span class="c1">#                     if it.string[_le] == &#39;;&#39;:</span>
<span class="c1">#                         return &#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#                 return &#39;:&#39;</span>
<span class="c1">#             else:</span>
<span class="c1">#                 return &#39;:&#39; * len(x)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_PSEPW</span><span class="p">:</span>
            <span class="c1"># native</span>
<span class="c1">#            return x</span>

            <span class="c1"># mixed</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>  <span class="c1"># 1..n</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">if</span> <span class="n">spf</span> <span class="o">&amp;</span> <span class="n">RTE_POSIX</span><span class="p">:</span>  <span class="c1"># for posix node names an ordinary character</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_islast</span><span class="p">:</span>  <span class="c1"># drop trailing os.pathsep</span>
                    <span class="k">if</span> <span class="n">keepsep</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">x</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">return</span> <span class="s1">&#39;:&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;:&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">#             if x[0] not in pathsep:  # 1..n</span>
<span class="c1">#                 return x</span>
<span class="c1">#</span>
<span class="c1">#             if spf &amp; RTE_POSIX:  # for posix node names an ordinary character</span>
<span class="c1">#                 return x</span>
<span class="c1">#</span>
<span class="c1">#             if strip:</span>
<span class="c1">#                 if len(it.string) == _le:  # do not drop trailing &#39;/&#39;</span>
<span class="c1">#                     return &#39;/&#39;</span>
<span class="c1">#</span>
<span class="c1">#                 if len(it.string) &gt; _le:</span>
<span class="c1">#                     if it.string[_le] == &#39;:&#39;:</span>
<span class="c1">#                         return &#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#                 return &#39;:&#39;</span>
<span class="c1">#             else:</span>
<span class="c1">#                 return &#39;:&#39; * len(x)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_PAPP</span><span class="p">,</span> <span class="n">SC_WDOM</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DRIVENPSEP</span><span class="p">,</span> <span class="n">SC_DRIVENWSEP</span><span class="p">):</span>  <span class="c1"># posix does not have drives</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>  <span class="c1"># keep drive-root</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:/&#39;</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">SC_UPDIR</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;../&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_DRIVE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_NULLDIR</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_FILE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_UNC</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">return</span> <span class="s1">&#39;//&#39;</span>

        <span class="k">return</span> <span class="n">x</span>


<div class="viewcode-block" id="sub_win"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.sub_win">[docs]</a><span class="k">def</span> <span class="nf">sub_win</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">spf</span><span class="o">=</span><span class="n">RTE</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pathsep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;To be used by re.sub() - converts to windows.</span>

<span class="sd">    Replaces &#39;[/\\\\]&#39; with &#39;\\\\&#39;, and &#39;[;:]&#39; with &#39;;&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        **it**:</span>
<span class="sd">            iterator from *re.sub*.</span>

<span class="sd">        **spf**:</span>
<span class="sd">            Source platform, defines the input syntax domain.</span>
<span class="sd">            For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">            For additi0onal details refer to</span>
<span class="sd">            :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">            `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">            :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">            `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">        **strip**:</span>
<span class="sd">            Strip redundancies.</span>

<span class="sd">        **pathsep**:</span>
<span class="sd">            Input separator &#39;pathsep&#39; to be be</span>
<span class="sd">            replaced. ::</span>

<span class="sd">               pathsep := &#39;:&#39; &#39;;&#39; &#39;&#39;</span>

<span class="sd">            One or more are allowed, is used as a set</span>
<span class="sd">            containment of replacement checks. Empty</span>
<span class="sd">            string disables the replacement.</span>

<span class="sd">        **state**:</span>
<span class="sd">            Compile states.</span>

<span class="sd">        kw:</span>
<span class="sd">           **apppre**:</span>
<span class="sd">               Application prefix.</span>

<span class="sd">           **keepsep**:</span>
<span class="sd">               Keeps seprator, in particular the trailing.</span>

<span class="sd">           **stripquote**:</span>
<span class="sd">               Strips *filesysobjects* triple-quotes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Converted format win.</span>
<span class="sd">        E.g.::</span>

<span class="sd">           C:\\Windows\\system32\\cmd.exe;C:\\Windows\\system32\\notepad.exe</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">apppre</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">keepsep</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keepsep&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">stripquote</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stripquote&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
        <span class="c1"># scheme for an URI requested, so slashes only</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">sep2</span> <span class="o">=</span> <span class="s1">&#39;//&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># no scheme, so a UNC</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
        <span class="n">sep2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span>

    <span class="c1"># tracks multiple path separators</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># ignores character classes</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">inchrclass</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inchrclass</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1">#</span>
    <span class="c1"># frequently used values</span>
    <span class="c1">#</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>  <span class="c1"># PATHRULES ASCII_SC_CTRL</span>
    <span class="n">_le</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">_isfirst</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">_islast</span> <span class="o">=</span> <span class="n">_le</span> <span class="o">==</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span>
    <span class="n">_isnotlast</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span> <span class="o">&gt;</span> <span class="n">_le</span>
    <span class="n">_charbefore</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">_isnotlast</span><span class="p">:</span>
        <span class="n">_nextissep</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">/&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_nextispsep</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">_isnotlast</span><span class="p">:</span>
        <span class="n">_nextispsep</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pathsep</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_nextispsep</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>  <span class="c1"># PATHRULES PATHSCANNER ASCII_SC_CTRL</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ASCII_SC_CTRL</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSSTART</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># char class start</span>
            <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSEND</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># char class end</span>
            <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">inchrclass</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DQUOTED</span><span class="p">,</span> <span class="n">SC_SQUOTED</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">stripquote</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DQUOTED</span><span class="p">,</span> <span class="n">SC_SQUOTED</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">stripquote</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_BSPAIR</span><span class="p">:</span>  <span class="c1"># pairs of &#39;\\&#39;</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>  <span class="c1"># TODO: basically not possible as net-app, see SC_PAP</span>
                    <span class="k">if</span> <span class="n">_isnotlast</span> <span class="ow">and</span> <span class="n">_nextissep</span><span class="p">:</span>
                        <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">return</span> <span class="n">sep</span>
                <span class="k">elif</span> <span class="n">_islast</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">sep</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">_nextispsep</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sx</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">sep</span>
                    <span class="k">elif</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">sep</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">_nextissep</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">sx</span><span class="p">:</span>
                        <span class="n">sx</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="n">sep</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sep2</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_SLASH</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># 1 * &#39;\&#39; - win treats &#39;/&#39; equal</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_islast</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">sep</span>
                    <span class="k">elif</span> <span class="n">_nextissep</span><span class="p">:</span>
                        <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">elif</span> <span class="n">_nextispsep</span> <span class="ow">or</span> <span class="n">_islast</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">sep</span>
                    <span class="k">elif</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">sep</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">elif</span> <span class="n">_isnotlast</span> <span class="ow">and</span> <span class="n">_nextissep</span><span class="p">:</span>
                    <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">return</span> <span class="n">sep</span>

            <span class="k">return</span> <span class="n">sep</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_SLASHPREB</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># &#39;\/&#39;</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_islast</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">sep</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">_nextissep</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">sx</span><span class="p">:</span>
                        <span class="n">sx</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">sep</span>
                <span class="k">return</span> <span class="n">sep</span>
            <span class="k">return</span> <span class="n">sep</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_SEPP</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># n * &#39;/&#39;</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>
                    <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">sep</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_SEPW</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># n * &#39;\&#39; - win treats &#39;/&#39; equal</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sep</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_isnotlast</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_nextissep</span><span class="p">:</span>
                        <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">_nextispsep</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">sep</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">sep</span>

            <span class="k">elif</span> <span class="n">_islast</span> <span class="ow">or</span> <span class="n">_nextispsep</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">sep</span>
                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">sep</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">elif</span> <span class="n">_isnotlast</span> <span class="ow">and</span> <span class="n">_nextissep</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sx</span><span class="p">:</span>
                    <span class="n">sx</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">sx</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sep</span>
            <span class="k">return</span> <span class="n">sep</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_PSEPP</span><span class="p">:</span>
            <span class="c1"># native</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pathsep</span> <span class="ow">and</span> <span class="n">_islast</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">return</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_CRMASK</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">elif</span> <span class="n">sx</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sep</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="k">return</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_FUNC</span><span class="p">,):</span>  <span class="c1"># verified by char contents</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;file://///&#39;</span>

            <span class="k">if</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">elif</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">_islast</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
            <span class="k">return</span> <span class="n">sep2</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">SC_FABS</span><span class="p">:</span>

            <span class="c1"># lookahead for RFC8089 - appendix E.2.1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span> <span class="o">+</span> <span class="mi">2</span> <span class="ow">and</span> \
                    <span class="nb">ord</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span><span class="mi">91</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">:</span>
                <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_FMIN</span><span class="p">,</span> <span class="n">SC_FSHORT</span><span class="p">,):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_PSEPW</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>  <span class="c1"># changed spf/psep</span>
                <span class="k">return</span> <span class="n">x</span>

            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="n">_is</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_is</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_is</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pathsep</span> <span class="ow">and</span> <span class="n">_is</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_is</span>
                                                          <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pathsep</span><span class="p">:</span>  <span class="c1"># 1..n</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="s1">&#39;;&#39;</span>

            <span class="k">return</span> <span class="s1">&#39;;&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">SC_UPDIR</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;..</span><span class="se">\\</span><span class="s1">&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">SC_FNONLOCAL</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">SC_PAPP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">_nextispsep</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sep</span>
            <span class="k">return</span> <span class="n">sep2</span>


        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_WDOM</span><span class="p">,</span> <span class="n">SC_PDOM</span><span class="p">):</span>  <span class="c1"># basically sure a UNC or NETAPP</span>
            <span class="k">if</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">_nextispsep</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sep</span>
            <span class="k">return</span> <span class="n">sep2</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DRIVENWSEP</span><span class="p">,</span> <span class="n">SC_DRIVENPSEP</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>  <span class="c1"># keep drive-root</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">sep</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_DRIVE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_NULLDIR</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_FILE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_UNC</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">return</span> <span class="n">sep2</span>

        <span class="k">return</span> <span class="n">x</span></div>


<span class="n">sub_path_calls</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1">#: &#39;re.sub&#39; callbacks for normalization</span>
    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">sub_win</span><span class="p">,</span>
    <span class="s1">&#39;cnp&#39;</span><span class="p">:</span> <span class="n">sub_posix</span><span class="p">,</span>
    <span class="s1">&#39;cnw&#39;</span><span class="p">:</span> <span class="n">sub_win</span><span class="p">,</span>
    <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">sub_rfc8089</span><span class="p">,</span>
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="n">sub_uri</span><span class="p">,</span>
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="n">sub_uri</span><span class="p">,</span>
    <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="n">sub_keep</span><span class="p">,</span>
    <span class="s1">&#39;keep&#39;</span><span class="p">:</span> <span class="n">sub_keep</span><span class="p">,</span>
    <span class="s1">&#39;posix&#39;</span><span class="p">:</span> <span class="n">sub_posix</span><span class="p">,</span>
    <span class="s1">&#39;rfsys&#39;</span><span class="p">:</span> <span class="n">sub_posix</span><span class="p">,</span>
    <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="n">sub_posix</span><span class="p">,</span>
    <span class="s1">&#39;share&#39;</span><span class="p">:</span> <span class="n">sub_win</span><span class="p">,</span>
    <span class="s1">&#39;uri&#39;</span><span class="p">:</span> <span class="n">sub_uri</span><span class="p">,</span>
    <span class="s1">&#39;win&#39;</span><span class="p">:</span> <span class="n">sub_win</span><span class="p">,</span>
    <span class="s1">&#39;win32&#39;</span><span class="p">:</span> <span class="n">sub_win</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="escapepathx"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.escapepathx">[docs]</a><span class="k">def</span> <span class="nf">escapepathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">tpf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Escape special characters within path names,</span>
<span class="sd">    supports cross-platform processing, knows the</span>
<span class="sd">    special escape characters of Python and *re*.</span>
<span class="sd">    The characters could be masked by quoting, and/or</span>
<span class="sd">    enclosing in character classes.</span>

<span class="sd">    +----------------+-----------------------+-----------------+</span>
<span class="sd">    | input          | -&gt; esc                | -&gt; unesc        |</span>
<span class="sd">    +================+=======================+=================+</span>
<span class="sd">    |     \\\\abc&quot;\\\\n&quot; |       \\\\\\\\abc&quot;\\\\n&quot;    |     \\\\abc&quot;\\\\n&quot;  |</span>
<span class="sd">    +----------------+-----------------------+-----------------+</span>
<span class="sd">    |     \\\\&quot;abc\\\\n&quot; |       \\\\\\\\&quot;abc\\\\n&quot;    |     \\\\&quot;abc\\\\n&quot;  |</span>
<span class="sd">    +----------------+-----------------------+-----------------+</span>
<span class="sd">    |     \\\\abc\\\\n   |         \\\\\\\\abc\\\\\\\\n  |     \\\\abc\\\\n    |</span>
<span class="sd">    +----------------+-----------------------+-----------------+</span>
<span class="sd">    |   \\\\xy&quot; &quot;z     |     \\\\\\\\xy&quot; &quot;z        |   \\\\xy&quot; &quot;z      |</span>
<span class="sd">    +----------------+-----------------------+-----------------+</span>
<span class="sd">    |   \\\\&quot;xy z&quot;     |     \\\\\\\\&quot;xy z&quot;        |   \\\\&quot;xy z&quot;      |</span>
<span class="sd">    +----------------+-----------------------+-----------------+</span>
<span class="sd">    |   \\\\xy z       |       \\\\\\\\xy\\\\ z      |   \\\\xy z        |</span>
<span class="sd">    +----------------+-----------------------+-----------------+</span>

<span class="sd">    Args:</span>
<span class="sd">        **spath**:</span>
<span class="sd">            The path to be escaped. ::</span>

<span class="sd">               spath := (</span>
<span class="sd">                    &lt;path-string&gt;</span>
<span class="sd">                  | &lt;path-array&gt;</span>
<span class="sd">               )</span>

<span class="sd">               path-string := (str | unicode)</span>
<span class="sd">               path-array := (list | tuple)</span>

<span class="sd">            * *path-string*</span>

<span class="sd">              The string representation of a complete path, which may contain literal,</span>
<span class="sd">              *glob*, and *re* expressions. The supported character representation</span>
<span class="sd">              is *str* or *unicode* for Pyton2.7 and Python3.5+.</span>

<span class="sd">            * *path-array*</span>

<span class="sd">              The component representation of a path, which consists of it&#39;s items,</span>
<span class="sd">              either as a *list* or as a *tuple*. Each item may contain literal,</span>
<span class="sd">              *glob*, and *re* expressions.</span>


<span class="sd">        **tpf**:</span>
<span class="sd">            Target path separator, currently not used.</span>

<span class="sd">        kargs:</span>

<span class="sd">            **charback**:</span>
<span class="sd">                Escapes all backslashes within character classes.</span>
<span class="sd">                Could be combined with *force* and *freeback*. ::</span>

<span class="sd">                   \a\[\\] =&gt; \a\[\\\\]</span>

<span class="sd">            **force**:</span>
<span class="sd">                Controls the escaped scope. Excludes quoted strings and</span>
<span class="sd">                character classes. Could be combined with *charback*. ::</span>

<span class="sd">                   force = (</span>
<span class="sd">                        True    # escape characters and any free backslash</span>
<span class="sd">                      | False   # defined escape characters only</span>
<span class="sd">                   )</span>

<span class="sd">                   force == True</span>

<span class="sd">                      \\a\\X\\n =&gt; \\\\a\\\\X\\\\n</span>

<span class="sd">                   force == False</span>

<span class="sd">                      \\a\\X\\n =&gt; \\\\a\\X\\\\n</span>

<span class="sd">                default := False</span>

<span class="sd">            **freeback**:</span>
<span class="sd">                Escapes backslashes outside character classes.</span>
<span class="sd">                Could be combined with *charback*. ::</span>

<span class="sd">                   \a\b\[\\] =&gt; \a\\b\\[\\]</span>

<span class="sd">    Returns:</span>
<span class="sd">        The escaped path with added &#39;*\\\\*&#39; in accordance to the rules and chosen</span>
<span class="sd">        options. The return type of the representation is the same as the input</span>
<span class="sd">        representation. ::</span>

<span class="sd">            str      =&gt;  str</span>
<span class="sd">            unicode  =&gt;  unicode</span>
<span class="sd">            list     =&gt;  list</span>
<span class="sd">            tuple    =&gt;  tuple</span>

<span class="sd">    Raises:</span>
<span class="sd">        PathError</span>

<span class="sd">        FileSysObjectsError</span>

<span class="sd">        TypeError</span>

<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tpf</span><span class="p">:</span>
        <span class="n">_ttpf</span> <span class="o">=</span> <span class="n">RTE</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_ttpf</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">tpf</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="s2">&quot;escapepathx:Parameter tpf: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tpf</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">_strip</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;strip&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">_strip</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_state</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PATHSCANNER</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sub_esc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_ttpf</span><span class="p">,</span> <span class="n">_strip</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">_state</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">spath</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spx</span> <span class="ow">in</span> <span class="n">spath</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PATHSCANNER</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sub_esc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_ttpf</span><span class="p">,</span> <span class="n">_strip</span><span class="p">,</span> <span class="n">_state</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">spx</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;escapepathx:requires (str | list | tuple), got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spath</span><span class="p">))</span></div>

<div class="viewcode-block" id="unescapepathx"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.unescapepathx">[docs]</a><span class="k">def</span> <span class="nf">unescapepathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Unescape path - which has been escaped before. The path representation</span>
<span class="sd">    could either be as a string/unicode or split components as a *list*</span>
<span class="sd">    or *tuple*.</span>

<span class="sd">    .. warning::</span>

<span class="sd">       Processes strings accurately which were processed by *escapepathx()*</span>
<span class="sd">       before, else the result could be erroneous. In particular for</span>
<span class="sd">       windows paths due to the ambiguity of the &#39;\\\\&#39;!</span>

<span class="sd">    The same masking rules apply as for the *normpathx()* and</span>
<span class="sd">    *escapepathx()* calls. Escape sequences could be protected by quoting,</span>
<span class="sd">    which keeps the content literally. See *pathtools.stripquotes*.</span>

<span class="sd">    Args:</span>
<span class="sd">        **spath**:</span>
<span class="sd">            The path to be unescaped. ::</span>

<span class="sd">               spath := (</span>
<span class="sd">                    &lt;path-string&gt;</span>
<span class="sd">                  | &lt;path-array&gt;</span>
<span class="sd">               )</span>

<span class="sd">               path-string := (str | unicode)</span>
<span class="sd">               path-array := (list | tuple)</span>

<span class="sd">            * *path-string*</span>

<span class="sd">              The string representation of a complete path, which may contain literal,</span>
<span class="sd">              *glob*, and *re* expressions. The supported character representation</span>
<span class="sd">              is *str* or *unicode* for Pyton2.7 and Python3.5+.</span>

<span class="sd">            * *path-array*</span>

<span class="sd">              The component representation of a path, which consists of it&#39;s items,</span>
<span class="sd">              either as a *list* or as a *tuple*. Each item may contain literal,</span>
<span class="sd">              *glob*, and *re* expressions.</span>

<span class="sd">        kargs:</span>
<span class="sd">            **tpf**:</span>
<span class="sd">                Target platform, currently not used.</span>

<span class="sd">            **netpath**:</span>
<span class="sd">                When *True* considers double prefix separators as share and/or</span>
<span class="sd">                network application, else assumes these are the result of escaping</span>
<span class="sd">                with force.</span>

<span class="sd">                default := False</span>

<span class="sd">    Returns:</span>
<span class="sd">        The unescaped path with removed &#39;\\&#39; in accordance to the rules and chosen</span>
<span class="sd">        options. The return type of the representation is the same as the input</span>
<span class="sd">        representation. ::</span>

<span class="sd">            str      =&gt;  str</span>
<span class="sd">            unicode  =&gt;  unicode</span>
<span class="sd">            list     =&gt;  list</span>
<span class="sd">            tuple    =&gt;  tuple</span>


<span class="sd">    Raises:</span>
<span class="sd">        PathError</span>

<span class="sd">        FileSysObjectsError</span>

<span class="sd">        TypeError</span>

<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">netpath</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;netpath&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">tpf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="n">RTE</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tpf</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tpf</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">tpf</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="s2">&quot;unescapepathx:Parameter tpf: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tpf</span><span class="p">))</span>

    <span class="n">_tsep</span><span class="p">,</span> <span class="n">_tpsep</span><span class="p">,</span> <span class="n">tpf</span><span class="p">,</span> <span class="n">_tpfn</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">tpf</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">netpath</span> <span class="ow">and</span> <span class="n">spath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">spath</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">spath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">PATHSCANNER_UNESC</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sub_unesc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tpf</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">spath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PATHSCANNER_UNESC</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sub_unesc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tpf</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">spath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spx</span> <span class="ow">in</span> <span class="n">spath</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">netpath</span> <span class="ow">and</span> <span class="n">spath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">spath</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">spath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">PATHSCANNER_UNESC</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sub_unesc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tpf</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">spx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">PATHSCANNER_UNESC</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sub_unesc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tpf</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">spx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;unescapepathx:requires (str | list | tuple), got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">spath</span><span class="p">))</span></div>

<div class="viewcode-block" id="splitpathx_win"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.splitpathx_win">[docs]</a><span class="k">def</span> <span class="nf">splitpathx_win</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split windows pathnames containing &#39;literal&#39;, &#39;glob&#39;, and &#39;re/regexpr&#39;.</span>
<span class="sd">    Serves the source platform windows and alike.</span>
<span class="sd">    For the call interface see *splitpathx()*</span>

<span class="sd">    Args:</span>
<span class="sd">        **p**:</span>
<span class="sd">            The path name to split.</span>

<span class="sd">        kargs:</span>
<span class="sd">            **apppre**:</span>
<span class="sd">                Application prefix.</span>

<span class="sd">                default := False</span>

<span class="sd">            **keepsep**:</span>
<span class="sd">                Keeps seprator, in particular the trailing.</span>

<span class="sd">                default := False</span>

<span class="sd">            **strip**:</span>
<span class="sd">                Strip separators, in particular the trailing.</span>

<span class="sd">                default := False</span>

<span class="sd">            **stripquote**:</span>
<span class="sd">                Strips *filesysobjects* triple-quotes.</span>

<span class="sd">                default := False</span>

<span class="sd">            **tpf**:</span>
<span class="sd">                Target platform. Defines some fine-tuning,</span>
<span class="sd">                e.g. for the file-URI, see *splitpathx*.</span>

<span class="sd">                default := current OS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The splitted path, else *[]*.</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_cur</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">apppre</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">keepsep</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keepsep&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">strip</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strip&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">stripquote</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stripquote&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">tpf</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="n">RTE_FILEURI</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;parameter tpf = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">)))</span>

    <span class="c1"># controls updir: /../.. != ../..</span>
    <span class="c1"># 0: no history</span>
    <span class="c1"># 1: leading chain of RELATIVE up-dirs, keep them all</span>
    <span class="c1"># 2: has a leading chain of RELATIVE up-dirs</span>
    <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">inclass</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">PATHSCANNER</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>  <span class="c1"># PATHSCANNER ASCII_SC_CTRL</span>
        <span class="n">_le</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">_isfirst</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">_islast</span> <span class="o">=</span> <span class="n">_le</span> <span class="o">==</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span>
        <span class="n">_charbefore</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">ASCII_SC_CTRL</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSSTART</span><span class="p">,):</span>
                <span class="n">inclass</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSEND</span><span class="p">,):</span>
                <span class="n">inclass</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span>

            <span class="k">elif</span> <span class="n">inclass</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DQUOTED</span><span class="p">,</span> <span class="n">SC_SQUOTED</span><span class="p">,):</span>
                <span class="k">if</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="c1">#continue</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SLASH</span><span class="p">:</span>  <span class="c1"># 1 * &#39;/&#39;</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>  <span class="c1"># if first - absolute</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">parts</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">_islast</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span> <span class="o">&gt;</span> <span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                            <span class="s1">r&#39;[.][/</span><span class="se">\\\\</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">):]):</span>
                        <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;^[/</span><span class="se">\\\\</span><span class="s1">]*$&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">:]):</span>
                        <span class="k">continue</span>

                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SEPP</span><span class="p">:</span>  <span class="c1"># n * &#39;/&#39; - always followed by a shlash</span>
                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))])</span>  <span class="c1"># @UnusedVariable</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_BSPAIR</span><span class="p">:</span>  <span class="c1"># pairs of &#39;\\&#39;</span>
                <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SLASHPREB</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))])</span>  <span class="c1"># @UnusedVariable</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SEPW</span><span class="p">:</span>  <span class="c1"># 1 * &#39;\\&#39;</span>
                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">_islast</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                    <span class="c1"># FIXME:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">strip</span> <span class="ow">or</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">or</span> <span class="n">_islast</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_PAPP</span><span class="p">,</span> <span class="n">SC_PDOM</span><span class="p">,</span> <span class="n">SC_WDOM</span><span class="p">,</span>
                       <span class="n">SC_FUNC</span><span class="p">,</span> <span class="n">SC_FNONLOCAL</span><span class="p">,):</span>  <span class="c1"># leading 2 * &#39;&#39; for &#39;\\&#39; or &#39;//&#39;</span>
                <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">SC_FNONLOCAL</span> <span class="ow">and</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI0</span><span class="p">,</span> <span class="s1">&#39;fileuri0&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">SC_FNONLOCAL</span> <span class="ow">and</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI4</span><span class="p">,</span> <span class="s1">&#39;fileuri4&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file:///&#39;</span><span class="p">)</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="k">elif</span> <span class="n">SC_FNONLOCAL</span> <span class="ow">and</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI5</span><span class="p">,</span> <span class="s1">&#39;fileuri5&#39;</span><span class="p">,</span> <span class="n">RTE_FILEURI</span><span class="p">,</span> <span class="s1">&#39;fileuri&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file:////&#39;</span><span class="p">)</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">SC_FUNC</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file:///&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_FMIN</span><span class="p">,):</span>
                <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI</span><span class="p">,</span> <span class="s1">&#39;fileuri&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI0</span><span class="p">,</span> <span class="s1">&#39;fileuri0&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file:&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_FABS</span><span class="p">,):</span>
                <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI0</span><span class="p">,</span> <span class="s1">&#39;fileuri0&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file:&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_FSHORT</span><span class="p">,):</span>
                <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DRIVENPSEP</span><span class="p">,</span> <span class="n">SC_DRIVENWSEP</span><span class="p">,):</span>  <span class="c1"># posix does not have drives</span>
                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>  <span class="c1"># keep drive-root</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))])</span>  <span class="c1"># @UnusedVariable</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_DRIVE</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_NULLDIR</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_UPDIR</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;..&#39;</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span> <span class="o">+</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">:</span><span class="n">_le</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;../&#39;</span> <span class="ow">or</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span> <span class="o">+</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">:</span><span class="n">_le</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;..&#39;</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># share/posix-app</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># absolute path</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># relative path</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;..&#39;</span><span class="p">:</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="k">continue</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DQUOTED</span><span class="p">,</span> <span class="n">SC_SQUOTED</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">stripquote</span><span class="p">:</span>
                    <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_x</span>
                <span class="k">continue</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span>

    <span class="k">if</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">parts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">keepsep</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">parts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">apppre</span> <span class="ow">and</span> <span class="n">parts</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;file:&#39;</span><span class="p">):</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">_get_lead_sep</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">_x</span> <span class="o">==</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI4</span><span class="p">,</span> <span class="n">RTE_FILEURI5</span><span class="p">,)</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">tpf</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">tpf</span> <span class="o">==</span> <span class="n">RTE_FILEURI0</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">RTE_FILEURI0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">RTE_FILEURI</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># does not recognize drives</span>
                <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="s2">&quot;file-uri requires absolute path, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">_x</span> <span class="o">==</span> <span class="s1">&#39;netapp&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI4</span><span class="p">,</span> <span class="n">RTE_FILEURI5</span><span class="p">,):</span>
                <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">tpf</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">RTE_FILEURI5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">RTE_FILEURI</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span></div>


<div class="viewcode-block" id="splitpathx_posix"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.splitpathx_posix">[docs]</a><span class="k">def</span> <span class="nf">splitpathx_posix</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split pathnames containing &#39;literal&#39;, &#39;glob&#39;, and &#39;re/regexpr&#39;.</span>
<span class="sd">    Serves the source platform POSIX and alike.</span>
<span class="sd">    For the call interface see *splitpathx()*</span>

<span class="sd">    Args:</span>
<span class="sd">        **p**:</span>
<span class="sd">            The path name to split.</span>

<span class="sd">        kargs:</span>
<span class="sd">            **apppre**:</span>
<span class="sd">                Application prefix.</span>

<span class="sd">                default := False</span>

<span class="sd">            **keepsep**:</span>
<span class="sd">                Keeps seprator, in particular the trailing.</span>

<span class="sd">                default := False</span>

<span class="sd">            **strip**:</span>
<span class="sd">                Strip separators, in particular the trailing.</span>

<span class="sd">                default := False</span>

<span class="sd">            **stripquote**:</span>
<span class="sd">                Strips *filesysobjects* triple-quotes.</span>

<span class="sd">                default := False</span>

<span class="sd">            **tpf**:</span>
<span class="sd">                Target platform. Defines some fine-tuning,</span>
<span class="sd">                e.g. for the file-URI, see *splitpathx*.</span>

<span class="sd">                default := current OS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The splitted path, else *[]*.</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_cur</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">apppre</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">keepsep</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keepsep&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">strip</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strip&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">stripquote</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stripquote&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">tpf</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="n">RTE_FILEURI</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;parameter tpf = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">)))</span>

    <span class="c1"># controls updir: /../.. != ../..</span>
    <span class="c1"># 0: no history</span>
    <span class="c1"># 1: leading chain of RELATIVE up-dirs, keep them all</span>
    <span class="c1"># 2: has a leading chain of RELATIVE up-dirs</span>
    <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">inclass</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">PATHSCANNER</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">lastindex</span>  <span class="c1"># PATHSCANNER ASCII_SC_CTRL</span>
        <span class="n">_le</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">_isfirst</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">_islast</span> <span class="o">=</span> <span class="n">_le</span> <span class="o">==</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span>
        <span class="n">_charbefore</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">ASCII_SC_CTRL</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSSTART</span><span class="p">,):</span>
                <span class="n">inclass</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_CHRCLSEND</span><span class="p">,):</span>
                <span class="n">inclass</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span>

            <span class="k">elif</span> <span class="n">inclass</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DQUOTED</span><span class="p">,</span> <span class="n">SC_SQUOTED</span><span class="p">,):</span>
                <span class="k">if</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="c1">#continue</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SLASH</span><span class="p">:</span>  <span class="c1"># 1 * &#39;/&#39;</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>  <span class="c1"># if first - absolute</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">parts</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">_islast</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">it</span><span class="o">.</span><span class="n">endpos</span> <span class="o">&gt;</span> <span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                            <span class="s1">r&#39;[.]/&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">it</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">g</span><span class="p">):]):</span>
                        <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">r&#39;^[/</span><span class="se">\\\\</span><span class="s1">]*$&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">:]):</span>
                        <span class="k">continue</span>

                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SEPP</span><span class="p">:</span>  <span class="c1"># n * &#39;/&#39; - always followed by a shlash</span>
                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))])</span>  <span class="c1"># @UnusedVariable</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_BSPAIR</span><span class="p">:</span>  <span class="c1"># pairs of &#39;\\&#39;</span>
                <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SLASHPREB</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))])</span>  <span class="c1"># @UnusedVariable</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_SEPW</span><span class="p">:</span>  <span class="c1"># 1 * &#39;\\&#39;</span>
                <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">_islast</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                    <span class="c1"># FIXME:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">strip</span> <span class="ow">or</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_charbefore</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">or</span> <span class="n">_islast</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_PAPP</span><span class="p">,</span> <span class="n">SC_PDOM</span><span class="p">,</span> <span class="n">SC_WDOM</span><span class="p">,</span>
                       <span class="n">SC_FUNC</span><span class="p">,</span> <span class="n">SC_FNONLOCAL</span><span class="p">,):</span>  <span class="c1"># leading 2 * &#39;&#39; for &#39;\\&#39; or &#39;//&#39;</span>
                <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">SC_FNONLOCAL</span> <span class="ow">and</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI0</span><span class="p">,</span> <span class="s1">&#39;fileuri0&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">SC_FNONLOCAL</span> <span class="ow">and</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI4</span><span class="p">,</span> <span class="s1">&#39;fileuri4&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file:///&#39;</span><span class="p">)</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="k">elif</span> <span class="n">SC_FNONLOCAL</span> <span class="ow">and</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI5</span><span class="p">,</span> <span class="s1">&#39;fileuri5&#39;</span><span class="p">,</span> <span class="n">RTE_FILEURI</span><span class="p">,</span> <span class="s1">&#39;fileuri&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file:////&#39;</span><span class="p">)</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">SC_FUNC</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_FMIN</span><span class="p">,):</span>
                <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI</span><span class="p">,</span> <span class="s1">&#39;fileuri&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI0</span><span class="p">,</span> <span class="s1">&#39;fileuri0&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file:&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_FABS</span><span class="p">,):</span>
                <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI0</span><span class="p">,</span> <span class="s1">&#39;fileuri0&#39;</span><span class="p">,):</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file:&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_FSHORT</span><span class="p">,):</span>
                <span class="k">if</span> <span class="n">apppre</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;file://&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DRIVENPSEP</span><span class="p">,</span> <span class="n">SC_DRIVENWSEP</span><span class="p">,):</span>  <span class="c1"># posix does not have drives</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>  <span class="c1"># keep drive-root</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))])</span>  <span class="c1"># @UnusedVariable</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_DRIVE</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_NULLDIR</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="n">SC_UPDIR</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_isfirst</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;..&#39;</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span> <span class="o">+</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">:</span><span class="n">_le</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;../&#39;</span> <span class="ow">or</span> \
                            <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_le</span> <span class="o">+</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">it</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">_le</span><span class="p">:</span><span class="n">_le</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;..&#39;</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># share/posix-app</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># absolute path</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># relative path</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;..&#39;</span><span class="p">:</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="k">continue</span>

            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">SC_DQUOTED</span><span class="p">,</span> <span class="n">SC_SQUOTED</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">stripquote</span><span class="p">:</span>
                    <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_x</span>
                <span class="k">continue</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span>

    <span class="k">if</span> <span class="n">strip</span> <span class="ow">and</span> <span class="n">parts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">keepsep</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">parts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">apppre</span> <span class="ow">and</span> <span class="n">parts</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;file:&#39;</span><span class="p">):</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">_get_lead_sep</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">_x</span> <span class="o">==</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI4</span><span class="p">,</span> <span class="n">RTE_FILEURI5</span><span class="p">,)</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">tpf</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">tpf</span> <span class="o">==</span> <span class="n">RTE_FILEURI0</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">RTE_FILEURI0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">RTE_FILEURI</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># does not recognize drives</span>
                <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="s2">&quot;file-uri requires absolute path, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">_x</span> <span class="o">==</span> <span class="s1">&#39;netapp&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">RTE_FILEURI4</span><span class="p">,</span> <span class="n">RTE_FILEURI5</span><span class="p">,):</span>
                <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">tpf</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">RTE_FILEURI5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_file_uri_scheme</span><span class="p">[</span><span class="n">RTE_FILEURI</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span></div>


<div class="viewcode-block" id="splitpathx"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.splitpathx">[docs]</a><span class="k">def</span> <span class="nf">splitpathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split pathnames into a list/tuple of items for each directory.</span>
<span class="sd">    For example ::</span>

<span class="sd">       In [15]: filesysobjects.paths.splitpathx(&quot;/a/b/c&quot;)</span>
<span class="sd">       Out[15]: (&#39;&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;)</span>

<span class="sd">       In [16]: filesysobjects.paths.splitpathx(&quot;x:/a/b/c&quot;)</span>
<span class="sd">       Out[16]: (&#39;x:&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;)</span>

<span class="sd">       In [17]: filesysobjects.paths.splitpathx(&quot;x:\\a\\b\\c&quot;)</span>
<span class="sd">       Out[17]: (&#39;x:&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;)</span>

<span class="sd">    For *URI*s and search paths refer to *splitapppathx*.</span>

<span class="sd">    Supports directory name types as &#39;literal&#39;, &#39;glob&#39;, and &#39;re/regexpr&#39;.</span>
<span class="sd">    Supports the same syntax elements as *normpathx*, while it is prepared</span>
<span class="sd">    to simple application of the built-in *join()* with *os.sep*.</span>

<span class="sd">    Is not aware of application tags except Network-Shares,</span>
<span class="sd">    Posix-Applications, and file-URI.</span>

<span class="sd">    **REMARK**:</span>
<span class="sd">        The intention is to replace the &#39;str.split()&#39; method</span>
<span class="sd">        for the split of the path parts, thus this is different to the</span>
<span class="sd">        method &#39;os.path.split()&#39;.</span>

<span class="sd">    Args:</span>

<span class="sd">        **spath**:</span>
<span class="sd">            Path to split.</span>

<span class="sd">        kw:</span>

<span class="sd">            **apppre**:</span>
<span class="sd">                Application prefix, when &#39;True&#39; the scheme is included,</span>
<span class="sd">                else dropped. ::</span>

<span class="sd">                   apppre=(True|False)</span>

<span class="sd">            **keepsep**:</span>
<span class="sd">                Modifies the behavior of &#39;strip&#39; parameter.</span>
<span class="sd">                If &#39;False&#39;, the trailing separator is dropped. ::</span>

<span class="sd">                   splitpathx(&#39;/a/b&#39;, keepsep=False)   =&gt; (&#39;&#39;, &#39;a&#39;, &#39;b&#39;)</span>
<span class="sd">                   splitpathx(&#39;/a/b/&#39;, keepsep=False)  =&gt; (&#39;&#39;, &#39;a&#39;, &#39;b&#39;)</span>

<span class="sd">                for &#39;True&#39; trailing separators are kept as directory</span>
<span class="sd">                marker::</span>

<span class="sd">                   splitpathx(&#39;/a/b&#39;, keepsep=True)    =&gt; (&#39;&#39;, &#39;a&#39;, &#39;b&#39;)</span>
<span class="sd">                   splitpathx(&#39;/a/b/&#39;, keepsep=True)   =&gt; (&#39;&#39;, &#39;a&#39;, &#39;b&#39;, &#39;&#39;)</span>

<span class="sd">            **pathsep**:</span>
<span class="sd">                Optional search path separator.</span>

<span class="sd">                    posix: &#39;:&#39;</span>

<span class="sd">                    win32: &#39;;&#39;</span>

<span class="sd">                default := os.pathsep</span>

<span class="sd">            **sep**:</span>
<span class="sd">                Optional path separator.</span>

<span class="sd">                    posix: &#39;/&#39;</span>

<span class="sd">                    win32: &#39;\\&#39;</span>

<span class="sd">                default := os.path.sep</span>

<span class="sd">            **strip**:</span>
<span class="sd">                Removes null-entries.</span>

<span class="sd">                default := False</span>

<span class="sd">            **stripquote**:</span>
<span class="sd">                Removes paired triple-quotes of protected/masked</span>
<span class="sd">                string sections. ::</span>

<span class="sd">                   &quot;/a/&#39;&#39;&#39;head:&#39;&#39;&#39;/c&quot; =&gt; &quot;/a/head:/c&quot;</span>

<span class="sd">                default := False</span>

<span class="sd">            **spf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to the API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">            **tpf**:</span>
<span class="sd">                Target platform. Even though the splitted form of a resource path</span>
<span class="sd">                is basically canonical, some details of the specifications for</span>
<span class="sd">                slightly variations requires the granular fine-tuning. Thus defines</span>
<span class="sd">                in case of ambiguity the *scheme* for *apppre=True*. Accepts the</span>
<span class="sd">                following values only. ::</span>

<span class="sd">                   tpf := (</span>
<span class="sd">                        RTE_FILEURI0 | &#39;fileuri0&#39;  # RFC8089 - minimal</span>
<span class="sd">                      | RTE_FILEURI4 | &#39;fileuri4&#39;  # RFC8089 - 4-slash UNC/POSIX-app</span>
<span class="sd">                      | RTE_FILEURI5 | &#39;fileuri5&#39;  # RFC8089 - 5-slash UNC/POSIX-app</span>
<span class="sd">                      | RTE_FILEURI  | &#39;fileuri&#39;   # RFC8089 - canonical</span>
<span class="sd">                   )</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list containing the path split into it&#39;s components. The list</span>
<span class="sd">        is prepared to be concatenated by *join()*.</span>

<span class="sd">        The interface is aware of the *os.path.sep* character, but a</span>
<span class="sd">        present regular expression may span multiple path components,</span>
<span class="sd">        which have to be handled dynamically when applying the path</span>
<span class="sd">        pattern e.g. by *findpattern*.</span>

<span class="sd">    Raises:</span>
<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spf</span> <span class="o">=</span> <span class="n">rte2num</span><span class="p">[</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">,</span> <span class="n">RTE_FILEURI</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileSysObjectsError</span><span class="p">(</span><span class="s2">&quot;parameter error: spf =&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">spf</span> <span class="o">&amp;</span> <span class="n">RTE_WIN32</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">splitpathx_win</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">splitpathx_posix</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="normpathx"><a class="viewcode-back" href="../../paths.html#filesysobjects.paths.normpathx">[docs]</a><span class="k">def</span> <span class="nf">normpathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Normalize paths, similar to &#39;os.path.normpath()&#39; - with</span>
<span class="sd">    optional extensions paths with basic application schemes</span>
<span class="sd">    and search paths, dos-drives, and the split of paths into</span>
<span class="sd">    directories. The various representations could be converted</span>
<span class="sd">    on-the-fly. ::</span>

<span class="sd">        smb, cifs, file, http/https, UNC, POSIX-network apps</span>

<span class="sd">    For advanced processing of application schemes refer to</span>
<span class="sd">    *normapppathx()* and &#39;splitapppathx()&#39;. The path could</span>
<span class="sd">    include regular expressions *re* and *glob*, literals</span>
<span class="sd">    and masked parts.</span>

<span class="sd">    * regular expressions</span>

<span class="sd">      The supported regular expressions are native Python regular</span>
<span class="sd">      expressions as supported by &#39;re&#39; with support of expressions</span>
<span class="sd">      spanning multiple directories.</span>

<span class="sd">    * globs</span>

<span class="sd">      Standard module *glob*.</span>

<span class="sd">    * literals:</span>

<span class="sd">      Any literal path.</span>

<span class="sd">    Regular expressions and globs could be masked as quoted strings,</span>
<span class="sd">    which are kept unchanged.</span>

<span class="sd">    The *normpathx* provides the features as simple interface for the</span>
<span class="sd">    normalization across multiple platforms. The companion interface</span>
<span class="sd">    provide various features, e.g. the *escapepathx* and *unescapepathx*</span>
<span class="sd">    of path names including *re* and *glob*.</span>


<span class="sd">    Args:</span>
<span class="sd">        **spath**:</span>
<span class="sd">            A single path entry - no valid &#39;os.pathsep&#39;. In case of</span>
<span class="sd">            required search path including semantic &#39;os.pathsep&#39;</span>
<span class="sd">            use &#39;splitapppathx()&#39;.</span>

<span class="sd">        kargs:</span>

<span class="sd">            **apppre**:</span>
<span class="sd">                Application prefix.</span>

<span class="sd">                default:=False</span>

<span class="sd">            **keepsep**:</span>
<span class="sd">                Keeps significant seperators, in particular</span>
<span class="sd">                the trailing path separator &#39;sep&#39;, and the</span>
<span class="sd">                trailing search path &#39;pathseparator&#39;.</span>

<span class="sd">            **strip**:</span>
<span class="sd">                Strips redundancies from path names, ::</span>

<span class="sd">                &quot;a/.//./b/c/../&quot; =&gt; &quot;a/b&quot;</span>

<span class="sd">                see related &#39;keepsep&#39; ::</span>

<span class="sd">                &quot;a/.//./b/c/../&quot; =&gt; &quot;a/b/&quot;</span>

<span class="sd">                default:=True</span>

<span class="sd">            **stripquote**:</span>
<span class="sd">                Removes paired triple-quotes of protected/masked</span>
<span class="sd">                string sections. ::</span>

<span class="sd">                   &quot;/a/&#39;&#39;&#39;head:&#39;&#39;&#39;/c&quot; =&gt; &quot;/a/head:/c&quot;</span>

<span class="sd">                default := False</span>

<span class="sd">            **spf**:</span>
<span class="sd">                Source platform, defines the input syntax domain.</span>
<span class="sd">                For the syntax refer to API in the manual at :ref:`spf &lt;OPTS_SPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.getspf() &lt;paths.html#getspf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">            **tpf**:</span>
<span class="sd">                Target platform, defines the output syntax domain.</span>
<span class="sd">                For the syntax refer to the API in the manual at :ref:`tpf &lt;OPTS_TPF&gt;`.</span>

<span class="sd">                For additi0onal details refer to</span>
<span class="sd">                :ref:`tpf and spf &lt;TPF_AND_SPF&gt;`,</span>
<span class="sd">                `paths.gettpf() &lt;paths.html#gettpf&gt;`_,</span>
<span class="sd">                :ref:`normapppathx() &lt;def_normapppathx&gt;`,</span>
<span class="sd">                `normpathx() &lt;paths.html#normpathx&gt;`_.</span>

<span class="sd">            **pathsep**:</span>
<span class="sd">                Changes path separator for the source platform. ::</span>

<span class="sd">                   pathsep := (</span>
<span class="sd">                         (: | ;)         # replaces by &#39;:&#39; or &#39;;&#39;</span>
<span class="sd">                       | &lt;keyword&gt;</span>
<span class="sd">                       | &lt;#enum&gt;</span>
<span class="sd">                   )</span>


<span class="sd">    Returns:</span>
<span class="sd">        Normalized path.</span>

<span class="sd">    Raises:</span>
<span class="sd">        PathError</span>

<span class="sd">        pass-through</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">strip</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strip&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">tpf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tpf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">apppre</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;apppre&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># target platform</span>
    <span class="c1">#</span>
    <span class="c1"># use system interfaces</span>
    <span class="k">if</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">RTE_LOCAL</span><span class="p">,):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;cnp&#39;</span><span class="p">,</span> <span class="n">RTE_CNP</span><span class="p">,):</span>
        <span class="k">return</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">tpf</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;cnw&#39;</span><span class="p">,</span> <span class="n">RTE_CNW</span><span class="p">,):</span>
        <span class="k">return</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span>

    <span class="n">_tsep</span><span class="p">,</span> <span class="n">_tpsep</span><span class="p">,</span> <span class="n">tpf</span><span class="p">,</span> <span class="n">_tpfn</span><span class="p">,</span> <span class="n">_apre</span> <span class="o">=</span> <span class="n">gettpf</span><span class="p">(</span><span class="n">tpf</span><span class="p">,</span> <span class="n">apppre</span><span class="o">=</span><span class="n">apppre</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># sourceplatform</span>
    <span class="c1">#</span>
    <span class="c1"># recognized pathsep, empty is no replacement</span>
    <span class="n">spf</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spf&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">_sep</span><span class="p">,</span> <span class="n">_psep</span><span class="p">,</span> <span class="n">spf</span><span class="p">,</span> <span class="n">_spfn</span> <span class="o">=</span> <span class="n">getspf</span><span class="p">(</span><span class="n">spf</span><span class="p">)</span>

    <span class="c1"># recognized pathsep, empty or False is no replacement</span>
    <span class="n">_p</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pathsep&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_p</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_psep</span> <span class="o">=</span> <span class="n">rte_map</span><span class="p">[</span><span class="n">_p</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="s2">&quot;unknown pathseparator: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pathsep&#39;</span><span class="p">)))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">sub_path_calls</span><span class="p">[</span><span class="n">tpf</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PathError</span><span class="p">(</span><span class="s2">&quot;Platform callback: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tpf</span><span class="p">))</span>

    <span class="n">kw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;apppre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">apppre</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;keepsep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keepsep&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;stripquote&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stripquote&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[],)</span>
    <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_m</span> <span class="o">=</span> <span class="n">_NULLDIRS</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">_m</span> <span class="o">=</span> <span class="n">_NULLDIRS</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">escapepathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="c1">#         except sre_constants.error:</span>
<span class="c1">#             _m = _NULLDIRS.match(escapepathx(spath, force=True))</span>

        <span class="k">if</span> <span class="n">_m</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;tpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tpfn</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;pathsep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_psep</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;sep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_sep</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;strip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strip</span>
            <span class="k">return</span> <span class="n">_tsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">splitpathx</span><span class="p">(</span><span class="n">spath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PATHSCANNER</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_spfn</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span> <span class="n">_psep</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">),</span> <span class="n">spath</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_psep</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PATHSCANNER</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_spfn</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">),</span> <span class="n">spath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PATHSCANNER</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_spfn</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span> <span class="n">_psep</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">),</span> <span class="n">spath</span><span class="p">)</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/pyfilesysobjects-64x64.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">filesysobjects 0.1.34 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../filesysobjects.html" >filesysobjects</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2018, Arno-Can Uestuensoez.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>